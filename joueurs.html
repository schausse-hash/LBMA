<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Joueurs - LBMA</title>
    <link rel="icon" type="image/jpeg" href="logo-lbma.jpg">
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Oswald:wght@400;600;700&family=Work+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{--primary:#1E3A5F;--accent:#CC0000;--gold:#D4AF37;--white:#FDFBF7;--cream:#F5F1E8;--dark:#1A1A1A;--coach:#28a745;--admin-ligue:#ffc107;--aigles:#FF8C00;--condors:#124FB2;--ducs:#006400;--faucons:#CC0000;--harfangs:#929292;--vautours:#333366}
        body{font-family:'Work Sans',sans-serif;background:var(--cream);color:var(--dark)}
        
        /* Header */
        .page-header{margin-top:80px;background:linear-gradient(135deg,var(--primary) 0%,#2D5A8A 100%);color:var(--white);padding:3rem 2rem;text-align:center}
        .page-header h1{font-family:'Bebas Neue',sans-serif;font-size:clamp(2rem,6vw,3.5rem);letter-spacing:.1em}
        .page-header p{font-family:'Oswald',sans-serif;font-size:1.2rem;opacity:.9;margin-top:.5rem}
        
        .container{max-width:1200px;margin:0 auto;padding:2rem}
        
        /* LÃ©gende */
        .legend{background:var(--white);border:3px solid var(--dark);padding:1.5rem;margin-bottom:2rem}
        .legend h3{font-family:'Bebas Neue',sans-serif;color:var(--primary);margin-bottom:1rem}
        .legend-items{display:flex;flex-wrap:wrap;gap:1.5rem}
        .legend-item{display:flex;align-items:center;gap:.5rem}
        .cote-badge{width:30px;height:30px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;color:white;font-size:.9rem}
        .cote-1{background:#f44336}.cote-2{background:#FF9800}.cote-3{background:#FFC107;color:#333}.cote-4{background:#2e7d32;color:#ffffff}.cote-5{background:#0d47a1;color:#ffffff}
        .role-badge{padding:.3rem .6rem;border-radius:3px;font-size:.75rem;font-weight:600}
        .role-coach{background:var(--coach);color:white}
        .role-admin{background:var(--admin-ligue);color:#333}
        .role-coachadmin{background:linear-gradient(135deg,var(--coach) 50%,var(--admin-ligue) 50%);color:white}
        .role-joueur{background:var(--cream);color:var(--dark)}
        .role-lanceur-a{background:#CC0000;color:white}
        .role-coachlanceur{background:linear-gradient(135deg,var(--coach) 50%,#CC0000 50%);color:white}
        .equipe-badge{padding:.2rem .45rem;font-family:'Oswald',sans-serif;font-size:.72rem;font-weight:700;border-radius:3px;letter-spacing:.03em;white-space:nowrap}
        .eq-AIGLES{background:var(--aigles);color:white}
        .eq-CONDORS{background:var(--condors);color:white}
        .eq-DUCS{background:var(--ducs);color:white}
        .eq-FAUCONS{background:var(--faucons);color:white}
        .eq-HARFANGS{background:var(--harfangs);color:white}
        .eq-VAUTOURS{background:var(--vautours);color:white}
        
        /* Filters */
        .filters{background:var(--white);border:3px solid var(--dark);padding:1.5rem;margin-bottom:2rem;display:flex;flex-wrap:wrap;gap:1rem;align-items:center}
        .filters label{font-family:'Oswald',sans-serif;color:var(--primary)}
        .filters select,.filters input{padding:.5rem;border:2px solid var(--dark);font-size:1rem}
        .filters input[type="text"]{flex:1;min-width:200px}
        
        /* Season Selector */
        .season-selector{background:var(--white);border:3px solid var(--dark);padding:1.5rem;margin-bottom:2rem;display:flex;align-items:center;justify-content:center;gap:1rem;flex-wrap:wrap}
        .season-selector label{font-family:'Bebas Neue',sans-serif;font-size:1.5rem;color:var(--primary)}
        .season-selector select{padding:.75rem 2rem;font-family:'Oswald',sans-serif;font-size:1.2rem;border:3px solid var(--dark);background:var(--cream);cursor:pointer}
        .season-selector select:hover{background:var(--gold)}
        .archive-badge{background:var(--gold);color:var(--dark);padding:.5rem 1rem;font-family:'Oswald',sans-serif;font-size:.9rem;display:none}
        .archive-badge.visible{display:inline-block}
        
        /* Stats */
        .stats-bar{display:flex;flex-wrap:wrap;gap:1rem;margin-bottom:2rem}
        .stat-box{background:var(--white);border:3px solid var(--dark);padding:1rem 1.5rem;text-align:center}
        .stat-box .number{font-family:'Bebas Neue',sans-serif;font-size:2rem;color:var(--primary)}
        .stat-box .label{font-family:'Oswald',sans-serif;font-size:.85rem;color:#666}
        
        /* Table */
        .joueurs-table{width:100%;border-collapse:collapse;background:var(--white);border:3px solid var(--dark)}
        .joueurs-table th{background:var(--primary);color:white;padding:1rem;text-align:left;font-family:'Oswald',sans-serif;position:sticky;top:80px}
        .joueurs-table th.sortable{cursor:pointer}
        .joueurs-table th.sortable:hover{background:#2D5A8A}
        .joueurs-table td{padding:.75rem 1rem;border-bottom:1px solid var(--cream)}
        .joueurs-table tr:hover{background:var(--cream)}
        .joueurs-table tr.coach{background:rgba(40,167,69,0.1)}
        .joueurs-table tr.admin{background:rgba(255,193,7,0.1)}
        .joueurs-table tr.coachadmin{background:linear-gradient(90deg,rgba(40,167,69,0.1) 0%,rgba(255,193,7,0.1) 100%)}
        
        .player-name{font-weight:600;display:flex;align-items:center;gap:.5rem}
        .player-cote{width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;color:white;font-size:.9rem}
        
        @media(max-width:768px){
            .joueurs-table{font-size:.85rem}
            .joueurs-table th,.joueurs-table td{padding:.5rem}
        }

        /* Bouton Imprimer */
        .print-btn{display:inline-flex;align-items:center;gap:.5rem;padding:.6rem 1.5rem;font-family:'Oswald',sans-serif;font-size:.95rem;background:var(--primary);color:white;border:2px solid var(--dark);cursor:pointer;transition:.3s;text-transform:uppercase}
        .print-btn:hover{background:var(--gold);color:var(--dark)}

        /* === STYLES IMPRESSION PDF === */
        @media print{
            *{-webkit-print-color-adjust:exact!important;print-color-adjust:exact!important;color-adjust:exact!important}
            nav,.hamburger,footer,.season-selector,.legend,.filters,.stats-bar,.print-btn,.archive-badge,.no-print{display:none!important}
            body{background:white!important;font-size:9pt}
            .page-header{margin-top:0!important;padding:1rem!important;background:var(--primary)!important}
            .page-header h1{font-size:1.5rem!important}
            .page-header p{font-size:.9rem!important}
            .container{padding:.5rem!important;max-width:100%!important}
            .joueurs-table{border-width:1px!important}
            .joueurs-table th{position:static!important;padding:.4rem .5rem!important;font-size:.8rem!important}
            .joueurs-table td{padding:.3rem .5rem!important;font-size:.8rem!important}
            .joueurs-table tr{page-break-inside:avoid}
            .player-cote{width:24px!important;height:24px!important;font-size:.75rem!important}
            @page{size:letter portrait;margin:1cm}
        }


            /* === NAV STANDARD LBMA === */
        nav{position:fixed;top:0;left:0;right:0;z-index:1000;background:var(--white);box-shadow:0 2px 20px rgba(0,0,0,.1)}
        nav .nav-container{max-width:1400px;margin:0 auto;padding:.75rem 2rem;display:flex;justify-content:space-between;align-items:center}
        .logo{display:flex;align-items:center;gap:.75rem;text-decoration:none}
        .logo img{height:55px}
        nav ul{display:flex;list-style:none;gap:.5rem}
        nav li{position:relative}
        nav a{text-decoration:none;color:var(--dark);font-weight:600;text-transform:uppercase;font-size:.85rem;padding:.5rem 1rem;display:block;transition:.3s}
        nav a:hover{color:var(--primary);background:var(--cream)}
        .dropdown-content{display:none;position:absolute;top:100%;left:0;background:var(--white);min-width:220px;box-shadow:0 8px 16px rgba(0,0,0,.1);border:2px solid var(--dark);z-index:1001}
        .dropdown-content a{padding:.75rem 1rem;border-bottom:1px solid var(--cream);font-size:.8rem}
        .dropdown:hover .dropdown-content{display:block}
        .dropdown>a::after{content:' \25BC';font-size:.6rem}
        .hamburger{display:none;font-size:2rem;cursor:pointer;padding:.5rem;color:var(--dark)}
        /* === FOOTER STANDARD LBMA === */
        footer{background:var(--dark);color:var(--white);padding:3rem 2rem}
        .footer-social{display:flex;gap:.5rem;flex-wrap:wrap}
        .social-link{display:inline-flex;align-items:center;gap:.5rem;background:rgba(255,255,255,.1);padding:.6rem 1.2rem;border-radius:5px;color:white;text-decoration:none;transition:.3s}
        .social-link:hover{background:var(--gold);color:var(--dark)}
        .footer-bottom{max-width:1400px;margin:1.5rem auto 0;padding-top:1.5rem;border-top:1px solid rgba(255,255,255,.2);text-align:center;opacity:.7;font-size:.85rem}
        .dropdown.open .dropdown-content{display:block!important}
        @media(max-width:768px){
            .hamburger{display:block}
            nav ul{display:none;position:absolute;top:100%;left:0;right:0;background:var(--white);flex-direction:column;padding:1rem;box-shadow:0 8px 16px rgba(0,0,0,.1)}
            nav ul.open{display:flex}
            .dropdown-content{position:static;box-shadow:none;border:none;border-left:3px solid var(--primary);margin-left:1rem}
            .dropdown:hover .dropdown-content{display:none}
            .dropdown.open .dropdown-content{display:block}
        }
    </style>
</head>
<body>
    <nav>
        <div class="nav-container">
            <a href="index.html" class="logo"><img src="logo-lbma.jpg" alt="LBMA"></a>
            <div class="hamburger" onclick="document.querySelector('nav ul').classList.toggle('open')">&#9776;</div>
            <ul>
                <li><a href="index.html">Accueil</a></li>
                <li><a href="equipes.html">Ã‰quipes</a></li>
                <li><a href="joueurs.html" style="color:var(--primary);font-weight:700">Joueurs</a></li>
                <li><a href="calendrier.html">Calendrier</a></li>
                <li class="dropdown">
                    <a href="#">Statistiques</a>
                    <div class="dropdown-content">
                        <a href="classement-equipes.html">ğŸ† Classement</a>
                        <a href="stats-frappeurs.html">âš¾ Frappeurs</a>
                        <a href="stats-lanceurs.html">ğŸ¯ Lanceurs</a>
                        <a href="stats-series.html">ğŸ† SÃ©ries Ã‰liminatoires</a>
                    </div>
                </li>
                <li class="dropdown">
                    <a href="#">Archives</a>
                    <div class="dropdown-content">
                        <a href="archives-frappeurs.html">ğŸ“Š Stats Frappeurs par AnnÃ©e</a>
                        <a href="frappeurs-carriere.html">â­ Frappeurs - CarriÃ¨re</a>
                        <a href="frappeurs-records.html">ğŸ† Frappeurs - Records</a>
                        <a href="archives-lanceurs.html">ğŸ“Š Stats Lanceurs par AnnÃ©e</a>
                        <a href="lanceurs-carriere.html">â­ Lanceurs - CarriÃ¨re</a>
                        <a href="lanceurs-records.html">ğŸ† Lanceurs - Records</a>
                        <a href="classement-equipes.html">ğŸ“ˆ Classements Historiques</a>
                        <a href="temple-renommee.html">ğŸ›ï¸ Temple de la RenommÃ©e</a>
                        <a href="archives.html">ğŸ“š Archives ComplÃ¨tes</a>
                    </div>
                </li>
                <li><a href="contact.html">Direction</a></li>
                <li><a href="admin.html" style="color:var(--accent)">Admin</a></li>
            </ul>
        </div>
    </nav>

    <div class="page-header">
        <h1>ğŸ‘¥ JOUEURS LBMA</h1>
        <p>Liste des joueurs - Saison <span id="saisonDisplay">2025</span></p>
    </div>

    <div class="container">
        <!-- SÃ©lecteur de saison -->
        <div class="season-selector">
            <label>ğŸ“… SAISON :</label>
            <select id="seasonSelect" onchange="changeSeason()">
                <option value="2026">2026 (En cours)</option>
                <option value="2025">2025</option>
                <option value="2024">2024</option>
                <option value="2023">2023</option>
                <option value="2022">2022</option>
                <option value="2021">2021</option>
                <option value="2020">2020</option>
            </select>
            <span class="archive-badge" id="archiveBadge">ğŸ“š ARCHIVE</span>
            <button class="print-btn" onclick="window.print()">ğŸ–¨ï¸ Imprimer PDF</button>
        </div>
        
        <!-- LÃ©gende -->
        <div class="legend">
            <h3>ğŸ“– LÃ©gende</h3>
            <div class="legend-items">
                <div class="legend-item"><span class="cote-badge cote-1">1</span>niveau</div>
                <div class="legend-item"><span class="cote-badge cote-2">2</span>niveau</div>
                <div class="legend-item"><span class="cote-badge cote-3">3</span>niveau</div>
                <div class="legend-item"><span class="cote-badge cote-4">4</span>niveau</div>
                <div class="legend-item"><span class="cote-badge cote-5">5</span>niveau</div>
                <div class="legend-item"><span class="role-badge role-joueur">âš¾ Joueur</span></div>
                <div class="legend-item"><span class="role-badge role-lanceur-a">ğŸ¯ Lanceur A</span></div>
                <div class="legend-item"><span class="role-badge role-coach">ğŸ‘” Coach</span></div>
                <div class="legend-item"><span class="role-badge role-coachlanceur">ğŸ‘”ğŸ¯ Coach + Lanceur A</span></div>
                <div class="legend-item"><span class="role-badge role-admin">âš™ï¸ Admin Ligue</span></div>
                <div class="legend-item"><span class="role-badge role-coachadmin">ğŸ‘”âš™ï¸ Coach + Admin</span></div>
            </div>
        </div>
        
        <!-- Filtres -->
        <div class="filters">
            <label>ğŸ” Rechercher:</label>
            <input type="text" id="searchInput" placeholder="Nom du joueur...">
            <label>Cote:</label>
            <select id="filterCote">
                <option value="">Toutes</option>
                <option value="1"> Niveau 1</option>
                <option value="2">Niveau 2</option>
                <option value="3">Niveau 3</option>
                <option value="4">Niveau 4</option>
                <option value="5">Niveau 5</option>
            </select>
            <label>RÃ´le:</label>
            <select id="filterRole">
                <option value="">Tous</option>
                <option value="joueur">âš¾ Joueurs</option>
                <option value="lanceur_a">ğŸ¯ Lanceur A</option>
                <option value="coach">ğŸ‘” Coachs</option>
                <option value="coachlanceur_a">ğŸ‘”ğŸ¯ Coach + Lanceur A</option>
                <option value="admin">âš™ï¸ Admins Ligue</option>
                <option value="coachadmin">ğŸ‘”âš™ï¸ Coach + Admin</option>
            </select>
        </div>
        
        <!-- Stats -->
        <div class="stats-bar">
            <div class="stat-box"><div class="number" id="totalJoueurs">0</div><div class="label">Joueurs</div></div>
            <div class="stat-box"><div class="number" id="totalCoachs">0</div><div class="label">Coachs</div></div>
            <div class="stat-box"><div class="number" id="totalAdmins">0</div><div class="label">Admins</div></div>
            <div class="stat-box"><div class="number" id="moyenneCote">0</div><div class="label">Cote Moyenne</div></div>
            <div class="stat-box" style="background:var(--cream);border-color:#ccc"><div class="number" style="color:#666;font-size:1.5rem">32</div><div class="label" style="font-size:.7rem;color:#888">Cible/Ã‰quipe</div></div>
        </div>
        
        <!-- Table -->
        <table class="joueurs-table">
            <thead>
                <tr>
                    <th class="sortable" onclick="sortTable('nom')">Nom â†•</th>
                    <th class="sortable" onclick="sortTable('cote')">Cote â†•</th>
                    <th>Ã‰quipe</th>
                    <th>RÃ´le</th>
                </tr>
            </thead>
            <tbody id="joueursTableBody"></tbody>
        </table>
    </div>

    <footer>
        <div class="footer-grid" style="max-width:1400px;margin:0 auto;display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:2rem">
            <div>
                <div style="display:flex;align-items:center;gap:1rem;margin-bottom:1rem">
                    <img src="logo-lbma.jpg" alt="LBMA" style="height:50px;background:white;padding:5px;border-radius:5px">
                    <div>
                        <div style="font-family:'Bebas Neue',sans-serif;font-size:1.5rem">LBMA</div>
                        <div style="opacity:.7;font-size:.9rem">Depuis 1976</div>
                    </div>
                </div>
                <div class="footer-social" style="margin-top:1rem">
                    <a href="https://www.facebook.com/groups/2400013274" target="_blank" class="social-link">ğŸ“˜ Facebook</a>
                    <a href="https://www.marqueur.com/baseball/mbr/tools/blg/index.php?nyx=1154" target="_blank" class="social-link">ğŸ“Š Marqueur.com</a>
                </div>
            </div>
            <div>
                <h4 style="font-family:'Oswald',sans-serif;color:var(--gold);margin-bottom:1rem">ğŸ“Š Statistiques 2026</h4>
                <ul style="list-style:none">
                    <li><a href="classement-equipes.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Classement</a></li>
                    <li><a href="stats-frappeurs.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Frappeurs</a></li>
                    <li><a href="stats-lanceurs.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Lanceurs</a></li>
                </ul>
            </div>
            <div>
                <h4 style="font-family:'Oswald',sans-serif;color:var(--gold);margin-bottom:1rem">ğŸ“š Archives</h4>
                <ul style="list-style:none">
                    <li><a href="archives-frappeurs.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Stats Frappeurs par AnnÃ©e</a></li>
                    <li><a href="frappeurs-carriere.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Frappeurs - CarriÃ¨re</a></li>
                    <li><a href="archives-lanceurs.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Stats Lanceurs par AnnÃ©e</a></li>
                    <li><a href="lanceurs-carriere.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Lanceurs - CarriÃ¨re</a></li>
                    <li><a href="classement-equipes.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Classements Historiques</a></li>
                    <li><a href="temple-renommee.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Temple de la RenommÃ©e</a></li>
                </ul>
            </div>
            <div>
                <h4 style="font-family:'Oswald',sans-serif;color:var(--gold);margin-bottom:1rem">âš¾ La Ligue</h4>
                <ul style="list-style:none">
                    <li><a href="equipes.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Ã‰quipes 2026</a></li>
                    <li><a href="calendrier.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Calendrier</a></li>
                    <li><a href="reglements.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">RÃ¨glements</a></li>
                    <li><a href="contact.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Direction</a></li>
                    <li><a href="liens-utiles.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Liens Utiles</a></li>
                    <li><a href="revue-presse.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">MÃ©dias & Entrevues</a></li>
                    <li><a href="nous-contacter.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Nous Contacter</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">Â© 2026 Ligue de Balle Molle Amicale (LBMA) - Tous droits rÃ©servÃ©s</div>
    </footer>

    <script>
        let joueursData = [];
        let picksMap = {}; // nom (lowercase) â†’ Ã©quipe (uppercase)
        let sortField = 'nom';
        let sortAsc = true;
        let currentSeason = '2026';
        const CURRENT_SEASON = '2026';
        const availableSeasons = ['2026', '2025', '2024', '2023', '2022', '2021', '2020'];

        // AbrÃ©viations Ã©quipes
        const EQ_ABBR = { AIGLES:'AI', CONDORS:'CO', DUCS:'DU', FAUCONS:'FA', HARFANGS:'HA', VAUTOURS:'VA' };

        // Supabase config
        var SB_URL = 'https://xgyskiatppgaeaamjhxr.supabase.co';
        var SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhneXNraWF0cHBnYWVhYW1qaHhyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA0OTgxNTQsImV4cCI6MjA4NjA3NDE1NH0.67KCcUWlJij-scDoCUvZpkiCle5-mHVmy-inRk96Tac';

        async function sbFetch(path) {
            var res = await fetch(SB_URL + '/rest/v1/' + path, {
                headers: { 'apikey': SB_KEY, 'Authorization': 'Bearer ' + SB_KEY, 'Range': '0-9999' }
            });
            return res.ok ? res.json() : [];
        }

        async function init() {
            const urlParams = new URLSearchParams(window.location.search);
            const seasonParam = urlParams.get('saison');
            if (seasonParam && availableSeasons.includes(seasonParam)) {
                currentSeason = seasonParam;
                document.getElementById('seasonSelect').value = currentSeason;
            }
            await loadSeason(currentSeason);
        }

        async function loadSeason(season) {
            currentSeason = season;
            picksMap = {};

            try {
                // Essayer joueurs_liste d'abord (saisons rÃ©centes avec Supabase)
                var rows = await sbFetch('joueurs_liste?saison=eq.' + season + '&order=nom.asc');
                if (rows.length > 0) {
                    joueursData = rows;
                } else {
                    // Fallback : chercher dans equipes_saison pour les archives
                    var eqRows = await sbFetch('equipes_saison?saison=eq.' + season + '&order=joueur_nom.asc');
                    if (eqRows.length > 0) {
                        // Convertir equipes_saison â†’ format joueurs_liste
                        // DÃ©doublonner par nom (un joueur peut apparaÃ®tre dans une seule Ã©quipe)
                        var seen = {};
                        joueursData = [];
                        eqRows.forEach(function(r) {
                            var nom = r.joueur_nom;
                            if (!nom || seen[nom]) return;
                            seen[nom] = true;
                            joueursData.push({
                                nom: nom,
                                cote: r.joueur_cote || 3,
                                role: r.is_coach ? 'coach' : 'joueur',
                                equipe_archive: r.equipe // garder l'Ã©quipe pour l'affichage
                            });
                        });
                        // Remplir picksMap depuis equipes_saison directement
                        eqRows.forEach(function(r) {
                            if (r.joueur_nom && r.equipe) {
                                picksMap[r.joueur_nom.trim().toLowerCase()] = r.equipe.trim().toUpperCase();
                            }
                        });
                    } else {
                        // Dernier recours : lire equipes-XXXX.json et extraire les joueurs
                        try {
                            var response = await fetch('equipes-' + season + '.json');
                            var data = await response.json();
                            joueursData = [];
                            (data.equipes || []).forEach(function(eq) {
                                (eq.joueurs || []).forEach(function(j) {
                                    joueursData.push({
                                        nom: j.nom,
                                        cote: j.cote || 3,
                                        role: j.isCoach ? 'coach' : 'joueur'
                                    });
                                    // Remplir picksMap avec l'Ã©quipe
                                    picksMap[j.nom.trim().toLowerCase()] = eq.id.trim().toUpperCase();
                                });
                            });
                            // Trier par nom
                            joueursData.sort(function(a,b){ return a.nom.localeCompare(b.nom); });
                        } catch(e) {
                            joueursData = [];
                        }
                    }
                }

                // Charger les picks du repÃªchage (saisons Supabase seulement)
                if (picksMap && Object.keys(picksMap).length === 0) {
                    try {
                        var picks = await sbFetch('repechage_picks?saison=eq.' + season + '&select=joueur_nom,equipe');
                        picks.forEach(function(p) {
                            if (p.joueur_nom && p.equipe) {
                                picksMap[p.joueur_nom.trim().toLowerCase()] = p.equipe.trim().toUpperCase();
                            }
                        });
                    } catch(e) { /* picks optionnel */ }
                }

                document.getElementById('saisonDisplay').textContent = season;
                document.getElementById('archiveBadge').classList.toggle('visible', season !== CURRENT_SEASON);

                updateStats();
                renderTable();
            } catch (error) {
                console.error('Erreur:', error);
                document.getElementById('joueursTableBody').innerHTML = '<tr><td colspan="4">DonnÃ©es non disponibles pour cette saison</td></tr>';
            }
        }

        function changeSeason() {
            const season = document.getElementById('seasonSelect').value;
            loadSeason(season);
            
            // Mettre Ã  jour l'URL sans recharger la page
            const url = new URL(window.location);
            if (season === CURRENT_SEASON) {
                url.searchParams.delete('saison');
            } else {
                url.searchParams.set('saison', season);
            }
            window.history.pushState({}, '', url);
        }

        function updateStats() {
            // Coachs = coach + coachadmin
            const coachs = joueursData.filter(j => j.role === 'coach' || j.role === 'coachadmin').length;
            // Admins = admin + coachadmin
            const admins = joueursData.filter(j => j.role === 'admin' || j.role === 'coachadmin').length;
            const totalCote = joueursData.reduce((sum, j) => sum + j.cote, 0);
            const moyenne = joueursData.length > 0 ? (totalCote / joueursData.length).toFixed(1) : '0';
            
            document.getElementById('totalJoueurs').textContent = joueursData.length;
            document.getElementById('totalCoachs').textContent = coachs;
            document.getElementById('totalAdmins').textContent = admins;
            document.getElementById('moyenneCote').textContent = moyenne;
        }

        function renderTable() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const filterCote = document.getElementById('filterCote').value;
            const filterRole = document.getElementById('filterRole').value;
            
            let filtered = joueursData.filter(j => {
                if (search && !j.nom.toLowerCase().includes(search)) return false;
                if (filterCote && j.cote != filterCote) return false;
                if (filterRole && j.role !== filterRole) return false;
                return true;
            });
            
            // Sort
            filtered.sort((a, b) => {
                let valA = a[sortField];
                let valB = b[sortField];
                if (typeof valA === 'string') {
                    valA = valA.toLowerCase();
                    valB = valB.toLowerCase();
                }
                if (valA < valB) return sortAsc ? -1 : 1;
                if (valA > valB) return sortAsc ? 1 : -1;
                return 0;
            });
            
            const tbody = document.getElementById('joueursTableBody');
            tbody.innerHTML = filtered.map(j => {
                const roleClass = j.role === 'coach' ? 'coach' : (j.role === 'admin' ? 'admin' : (j.role === 'coachadmin' ? 'coachadmin' : ''));
                let roleBadge = '<span class="role-badge role-joueur">âš¾ Joueur</span>';
                if (j.role === 'lanceur_a') roleBadge = '<span class="role-badge role-lanceur-a">ğŸ¯ Lanceur A</span>';
                else if (j.role === 'coach') roleBadge = '<span class="role-badge role-coach">ğŸ‘” Coach</span>';
                else if (j.role === 'coachlanceur_a') roleBadge = '<span class="role-badge role-coachlanceur">ğŸ‘”ğŸ¯ Coach+Lanceur A</span>';
                else if (j.role === 'admin') roleBadge = '<span class="role-badge role-admin">âš™ï¸ Admin</span>';
                else if (j.role === 'coachadmin') roleBadge = '<span class="role-badge role-coachadmin">ğŸ‘”âš™ï¸ Coach+Admin</span>';

                const equipe = picksMap[j.nom.trim().toLowerCase()] || '';
                const abbr = equipe ? (EQ_ABBR[equipe] || equipe.substring(0,2)) : '';
                const equipeBadge = equipe
                    ? '<span class="equipe-badge eq-' + equipe + '" title="' + equipe.charAt(0) + equipe.slice(1).toLowerCase() + '">' + abbr + '</span>'
                    : '<span style="color:#ccc;font-size:.8rem">â€”</span>';

                return `
                    <tr class="${roleClass}">
                        <td class="player-name">${j.nom}</td>
                        <td><span class="player-cote cote-${j.cote}">${j.cote}</span></td>
                        <td>${equipeBadge}</td>
                        <td>${roleBadge}</td>
                    </tr>
                `;
            }).join('');
        }

        function sortTable(field) {
            if (sortField === field) {
                sortAsc = !sortAsc;
            } else {
                sortField = field;
                sortAsc = true;
            }
            renderTable();
        }

        // Event listeners
        document.getElementById('searchInput').addEventListener('input', renderTable);
        document.getElementById('filterCote').addEventListener('change', renderTable);
        document.getElementById('filterRole').addEventListener('change', renderTable);

        init();
    </script>

    <script>
    /* === MOBILE NAV STANDARD LBMA === */
    (function() {
        var isTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;

        document.querySelectorAll('nav .dropdown > a').forEach(function(a) {
            a.addEventListener('click', function(e) {
                if (isTouch || window.innerWidth <= 768) {
                    e.preventDefault();
                    var parent = this.parentElement;
                    document.querySelectorAll('nav .dropdown').forEach(function(d) {
                        if (d !== parent) d.classList.remove('open');
                    });
                    parent.classList.toggle('open');
                }
            });
        });

        document.addEventListener('click', function(e) {
            if (!e.target.closest('nav')) {
                document.querySelector('nav ul')?.classList.remove('open');
                document.querySelectorAll('nav .dropdown').forEach(function(d) {
                    d.classList.remove('open');
                });
            }
        });
    })();
    </script>
<script src="lbma-analytics.js"></script>
</body>
</html>
