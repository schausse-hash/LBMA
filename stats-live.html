<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üî¥ STATS LIVE - LBMA 2026</title>
    <link rel="icon" type="image/jpeg" href="logo-lbma.jpg">
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Oswald:wght@400;600;700&family=Work+Sans:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{
            --primary:#1E3A5F;--accent:#CC0000;--gold:#D4AF37;--white:#FDFBF7;--cream:#F5F1E8;--dark:#1A1A1A;
            --aigles:#FF8001;--condors:#124FB2;--ducs:#006400;--faucons:#CC0000;--harfangs:#929292;--vautours:#FFFF00;
            --success:#28a745;--danger:#dc3545;--warning:#ffc107
        }
        body{font-family:'Work Sans',sans-serif;background:var(--dark);color:var(--white);min-height:100vh}
        
        /* Header */
        .header{background:linear-gradient(135deg,var(--primary) 0%,#0d2137 100%);padding:1rem 2rem;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem;border-bottom:3px solid var(--gold)}
        .header-left{display:flex;align-items:center;gap:1rem}
        .header img{height:50px;background:white;padding:3px;border-radius:5px}
        .header h1{font-family:'Bebas Neue',sans-serif;font-size:1.8rem;letter-spacing:.1em}
        .live-badge{background:var(--accent);color:white;padding:.5rem 1rem;font-family:'Oswald',sans-serif;animation:pulse 1.5s infinite;display:flex;align-items:center;gap:.5rem}
        .live-dot{width:10px;height:10px;background:white;border-radius:50%;animation:blink 1s infinite}
        @keyframes pulse{0%,100%{opacity:1}50%{opacity:.7}}
        @keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}
        
        /* Tabs */
        .main-tabs{display:flex;background:var(--dark);border-bottom:3px solid var(--gold)}
        .main-tab{padding:1rem 2rem;font-family:'Oswald',sans-serif;font-size:1.1rem;cursor:pointer;border:none;background:transparent;color:var(--white);opacity:.7;transition:.3s}
        .main-tab:hover{opacity:1}
        .main-tab.active{background:var(--primary);opacity:1;border-bottom:3px solid var(--gold);margin-bottom:-3px}
        
        .container{max-width:1600px;margin:0 auto;padding:1rem}
        .tab-content{display:none}
        .tab-content.active{display:block}
        
        /* Match Setup */
        .match-setup{background:var(--primary);padding:1.5rem;margin-bottom:1rem;border:2px solid var(--gold)}
        .match-setup h2{font-family:'Bebas Neue',sans-serif;color:var(--gold);margin-bottom:1rem}
        .setup-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;align-items:end}
        .form-group{display:flex;flex-direction:column;gap:.5rem}
        .form-group label{font-family:'Oswald',sans-serif;font-size:.85rem;text-transform:uppercase}
        .form-group select,.form-group input{padding:.75rem;border:2px solid var(--gold);background:var(--dark);color:white;font-size:1rem}
        .btn{padding:.75rem 1.5rem;font-family:'Oswald',sans-serif;border:none;cursor:pointer;transition:.3s;text-transform:uppercase}
        .btn-success{background:var(--success);color:white}
        .btn-danger{background:var(--danger);color:white}
        .btn-warning{background:var(--warning);color:var(--dark)}
        .btn-primary{background:var(--gold);color:var(--dark)}
        .btn:hover{transform:scale(1.05)}
        
        /* Scoreboard */
        .scoreboard{display:grid;grid-template-columns:1fr auto 1fr;gap:2rem;background:linear-gradient(135deg,#1a1a1a,#2d2d2d);padding:2rem;margin-bottom:1rem;border:3px solid var(--gold);align-items:center}
        .team-score{text-align:center}
        .team-score .team-name{font-family:'Bebas Neue',sans-serif;font-size:2rem;margin-bottom:.5rem}
        .team-score .score{font-family:'Bebas Neue',sans-serif;font-size:5rem;color:var(--gold)}
        .score-vs{font-family:'Bebas Neue',sans-serif;font-size:2rem;color:var(--gold)}
        .match-info{text-align:center;font-family:'Oswald',sans-serif}
        
        /* Quick Stats Entry */
        .stats-entry{display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-bottom:1rem}
        .team-entry{background:var(--cream);color:var(--dark);border:3px solid var(--dark);overflow:hidden}
        .team-entry-header{padding:1rem;color:white;font-family:'Bebas Neue',sans-serif;font-size:1.3rem;display:flex;justify-content:space-between}
        .team-entry-body{padding:1rem;max-height:500px;overflow-y:auto}
        
        /* Player Stats Row */
        .player-stats-row{display:grid;grid-template-columns:150px repeat(10,1fr) auto;gap:.25rem;padding:.5rem;border-bottom:1px solid #ddd;align-items:center;font-size:.85rem}
        .player-stats-row:hover{background:rgba(0,0,0,.05)}
        .player-stats-row.header{background:var(--primary);color:white;font-family:'Oswald',sans-serif;font-size:.75rem;position:sticky;top:0}
        .player-stats-row input{width:100%;padding:.25rem;border:1px solid #ccc;text-align:center;font-size:.85rem}
        .player-stats-row input:focus{border-color:var(--primary);outline:none}
        .player-stats-row .player-name{font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
        .player-stats-row .moy{font-weight:bold;color:var(--primary)}
        .quick-btn{padding:.15rem .4rem;font-size:.7rem;border:none;cursor:pointer;margin:0 .1rem}
        .quick-btn.hit{background:var(--success);color:white}
        .quick-btn.out{background:var(--danger);color:white}
        
        /* Pitcher Stats */
        .pitcher-section{background:var(--accent);color:white;padding:1rem;margin-top:1rem}
        .pitcher-section h3{font-family:'Oswald',sans-serif;margin-bottom:.5rem}
        .pitcher-stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:1rem}
        .pitcher-stat{text-align:center;background:rgba(255,255,255,.1);padding:.75rem}
        .pitcher-stat .value{font-family:'Bebas Neue',sans-serif;font-size:2rem}
        .pitcher-stat .label{font-size:.8rem;opacity:.8}
        
        /* Standings Tab */
        .standings-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(400px,1fr));gap:1rem}
        .standings-card{background:var(--white);color:var(--dark);border:3px solid var(--dark)}
        .standings-card h3{background:var(--primary);color:white;padding:1rem;font-family:'Bebas Neue',sans-serif}
        .standings-table{width:100%;border-collapse:collapse}
        .standings-table th{background:var(--cream);padding:.75rem;text-align:left;font-family:'Oswald',sans-serif;font-size:.8rem}
        .standings-table td{padding:.5rem .75rem;border-bottom:1px solid var(--cream)}
        .standings-table tr:hover{background:var(--cream)}
        
        /* Leaders Tab */
        .leaders-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:1rem}
        .leader-card{background:var(--white);color:var(--dark);border:3px solid var(--dark)}
        .leader-card h3{background:var(--gold);color:var(--dark);padding:1rem;font-family:'Bebas Neue',sans-serif;display:flex;justify-content:space-between}
        .leader-list{padding:.5rem}
        .leader-item{display:flex;justify-content:space-between;padding:.75rem;border-bottom:1px solid var(--cream)}
        .leader-item:first-child{background:rgba(212,175,55,.2)}
        .leader-item .rank{font-family:'Bebas Neue',sans-serif;font-size:1.2rem;color:var(--primary);width:30px}
        .leader-item .name{flex:1}
        .leader-item .value{font-family:'Oswald',sans-serif;font-weight:bold;color:var(--primary)}
        
        /* Games Log */
        .games-log{background:var(--white);color:var(--dark);border:3px solid var(--dark);margin-top:1rem}
        .games-log h3{background:var(--primary);color:white;padding:1rem;font-family:'Bebas Neue',sans-serif}
        .games-table{width:100%;border-collapse:collapse}
        .games-table th{background:var(--cream);padding:.75rem;text-align:left;font-family:'Oswald',sans-serif}
        .games-table td{padding:.75rem;border-bottom:1px solid var(--cream)}
        
        /* Toast */
        .toast{position:fixed;top:80px;right:20px;padding:1rem 2rem;border-radius:5px;color:white;font-weight:bold;z-index:3000;animation:slideIn .3s ease}
        .toast-success{background:var(--success)}
        .toast-danger{background:var(--danger)}
        @keyframes slideIn{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}
        
        /* Responsive */
        @media(max-width:1024px){
            .stats-entry{grid-template-columns:1fr}
            .scoreboard{grid-template-columns:1fr;text-align:center}
            .score-vs{padding:1rem 0}
            .player-stats-row{grid-template-columns:120px repeat(6,1fr) auto;font-size:.75rem}
            .player-stats-row.header span:nth-child(n+8){display:none}
            .player-stats-row input:nth-child(n+8){display:none}
        }
    </style>
</head>
<body>
    <!-- HEADER -->
    <header class="header">
        <div class="header-left">
            <img src="logo-lbma.jpg" alt="LBMA">
            <div>
                <h1>üìä STATISTIQUES LIVE 2026</h1>
            </div>
        </div>
        <div style="display:flex;gap:1rem;align-items:center">
            <div class="live-badge"><span class="live-dot"></span> SAISON EN COURS</div>
            <a href="index.html" class="btn btn-primary" style="text-decoration:none">üè† Accueil</a>
        </div>
    </header>

    <!-- MAIN TABS -->
    <div class="main-tabs">
        <button class="main-tab active" onclick="switchMainTab('match',this)">‚öæ Saisie Match</button>
        <button class="main-tab" onclick="switchMainTab('standings',this)">üèÜ Classements</button>
        <button class="main-tab" onclick="switchMainTab('leaders',this)">‚≠ê Meneurs</button>
        <button class="main-tab" onclick="switchMainTab('players',this)">üë• Stats Joueurs</button>
        <button class="main-tab" onclick="switchMainTab('pitchers',this)">üéØ Stats Lanceurs</button>
    </div>

    <div class="container">
        <!-- TAB: MATCH -->
        <div id="match-tab" class="tab-content active">
            <!-- Match Setup -->
            <div class="match-setup">
                <h2>‚öæ CONFIGURATION DU MATCH</h2>
                <div class="setup-grid">
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" id="matchDate" value="">
                    </div>
                    <div class="form-group">
                        <label>√âquipe Visiteur</label>
                        <select id="teamAway">
                            <option value="AIGLES">Aigles</option>
                            <option value="CONDORS">Condors</option>
                            <option value="DUCS">Ducs</option>
                            <option value="FAUCONS">Faucons</option>
                            <option value="HARFANGS">Harfangs</option>
                            <option value="VAUTOURS">Vautours</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>√âquipe Local</label>
                        <select id="teamHome">
                            <option value="AIGLES">Aigles</option>
                            <option value="CONDORS" selected>Condors</option>
                            <option value="DUCS">Ducs</option>
                            <option value="FAUCONS">Faucons</option>
                            <option value="HARFANGS">Harfangs</option>
                            <option value="VAUTOURS">Vautours</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Lanceur Visiteur</label>
                        <select id="pitcherAway"></select>
                    </div>
                    <div class="form-group">
                        <label>Lanceur Local</label>
                        <select id="pitcherHome"></select>
                    </div>
                    <button class="btn btn-success" onclick="startMatch()">‚ñ∂Ô∏è D√©marrer Match</button>
                </div>
            </div>

            <!-- Scoreboard -->
            <div class="scoreboard" id="scoreboard" style="display:none">
                <div class="team-score">
                    <div class="team-name" id="awayTeamName">VISITEUR</div>
                    <div class="score" id="awayScore">0</div>
                </div>
                <div class="match-info">
                    <div class="score-vs">VS</div>
                    <div id="matchDateDisplay"></div>
                    <div style="margin-top:1rem">
                        <button class="btn btn-warning" onclick="endMatch()">üèÅ Terminer Match</button>
                    </div>
                </div>
                <div class="team-score">
                    <div class="team-name" id="homeTeamName">LOCAL</div>
                    <div class="score" id="homeScore">0</div>
                </div>
            </div>

            <!-- Stats Entry -->
            <div class="stats-entry" id="statsEntry" style="display:none">
                <!-- Away Team -->
                <div class="team-entry">
                    <div class="team-entry-header" id="awayHeader" style="background:var(--primary)">
                        <span>ü¶Ö VISITEUR</span>
                        <span>PC: <span id="awayPC">0</span></span>
                    </div>
                    <div class="team-entry-body">
                        <div class="player-stats-row header">
                            <span>Joueur</span>
                            <span>AB</span>
                            <span>CS</span>
                            <span>1B</span>
                            <span>2B</span>
                            <span>3B</span>
                            <span>CC</span>
                            <span>PC</span>
                            <span>PP</span>
                            <span>BB</span>
                            <span>MOY</span>
                            <span>+/-</span>
                        </div>
                        <div id="awayPlayers"></div>
                    </div>
                    <div class="pitcher-section">
                        <h3>üéØ Lanceur: <span id="awayPitcherName">-</span></h3>
                        <div class="pitcher-stats">
                            <div class="pitcher-stat"><div class="value" id="awayPitcherPC">0</div><div class="label">PC</div></div>
                            <div class="pitcher-stat"><div class="value" id="awayPitcherCS">0</div><div class="label">CS</div></div>
                            <div class="pitcher-stat"><div class="value" id="awayPitcherBB">0</div><div class="label">BB</div></div>
                            <div class="pitcher-stat"><div class="value" id="awayPitcherRET">0</div><div class="label">RET</div></div>
                        </div>
                    </div>
                </div>

                <!-- Home Team -->
                <div class="team-entry">
                    <div class="team-entry-header" id="homeHeader" style="background:var(--primary)">
                        <span>ü¶Ö LOCAL</span>
                        <span>PC: <span id="homePC">0</span></span>
                    </div>
                    <div class="team-entry-body">
                        <div class="player-stats-row header">
                            <span>Joueur</span>
                            <span>AB</span>
                            <span>CS</span>
                            <span>1B</span>
                            <span>2B</span>
                            <span>3B</span>
                            <span>CC</span>
                            <span>PC</span>
                            <span>PP</span>
                            <span>BB</span>
                            <span>MOY</span>
                            <span>+/-</span>
                        </div>
                        <div id="homePlayers"></div>
                    </div>
                    <div class="pitcher-section">
                        <h3>üéØ Lanceur: <span id="homePitcherName">-</span></h3>
                        <div class="pitcher-stats">
                            <div class="pitcher-stat"><div class="value" id="homePitcherPC">0</div><div class="label">PC</div></div>
                            <div class="pitcher-stat"><div class="value" id="homePitcherCS">0</div><div class="label">CS</div></div>
                            <div class="pitcher-stat"><div class="value" id="homePitcherBB">0</div><div class="label">BB</div></div>
                            <div class="pitcher-stat"><div class="value" id="homePitcherRET">0</div><div class="label">RET</div></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Games -->
            <div class="games-log">
                <h3>üìÖ MATCHS R√âCENTS</h3>
                <table class="games-table">
                    <thead><tr><th>Date</th><th>Visiteur</th><th>Score</th><th>Local</th><th>Actions</th></tr></thead>
                    <tbody id="recentGames"></tbody>
                </table>
            </div>
        </div>

        <!-- TAB: STANDINGS -->
        <div id="standings-tab" class="tab-content">
            <h2 style="font-family:'Bebas Neue',sans-serif;color:var(--gold);margin-bottom:1rem">üèÜ CLASSEMENT SAISON 2026</h2>
            <div class="standings-card">
                <table class="standings-table">
                    <thead>
                        <tr><th>#</th><th>√âquipe</th><th>PJ</th><th>V</th><th>D</th><th>N</th><th>PP</th><th>PC</th><th>DIFF</th><th>PTS</th></tr>
                    </thead>
                    <tbody id="standingsTable"></tbody>
                </table>
            </div>
        </div>

        <!-- TAB: LEADERS -->
        <div id="leaders-tab" class="tab-content">
            <h2 style="font-family:'Bebas Neue',sans-serif;color:var(--gold);margin-bottom:1rem">‚≠ê MENEURS 2026</h2>
            <div class="leaders-grid">
                <div class="leader-card">
                    <h3>üéØ Moyenne (MOY)</h3>
                    <div class="leader-list" id="leadersMoy"></div>
                </div>
                <div class="leader-card">
                    <h3>üí• Coups S√ªrs (CS)</h3>
                    <div class="leader-list" id="leadersCS"></div>
                </div>
                <div class="leader-card">
                    <h3>üè† Circuits (CC)</h3>
                    <div class="leader-list" id="leadersCC"></div>
                </div>
                <div class="leader-card">
                    <h3>üèÉ Points Compt√©s (PC)</h3>
                    <div class="leader-list" id="leadersPC"></div>
                </div>
                <div class="leader-card">
                    <h3>üí™ Points Produits (PP)</h3>
                    <div class="leader-list" id="leadersPP"></div>
                </div>
                <div class="leader-card">
                    <h3>üéØ Victoires Lanceur (V)</h3>
                    <div class="leader-list" id="leadersWins"></div>
                </div>
            </div>
        </div>

        <!-- TAB: PLAYERS -->
        <div id="players-tab" class="tab-content">
            <h2 style="font-family:'Bebas Neue',sans-serif;color:var(--gold);margin-bottom:1rem">üë• STATISTIQUES FRAPPEURS 2026</h2>
            <div class="form-group" style="margin-bottom:1rem;max-width:300px">
                <select id="filterTeamPlayers" onchange="renderPlayersStats()" style="width:100%;padding:.75rem;border:2px solid var(--gold);background:var(--dark);color:white">
                    <option value="">Toutes les √©quipes</option>
                    <option value="AIGLES">Aigles</option>
                    <option value="CONDORS">Condors</option>
                    <option value="DUCS">Ducs</option>
                    <option value="FAUCONS">Faucons</option>
                    <option value="HARFANGS">Harfangs</option>
                    <option value="VAUTOURS">Vautours</option>
                </select>
            </div>
            <div class="standings-card">
                <table class="standings-table">
                    <thead>
                        <tr><th>#</th><th>Joueur</th><th>√âQ</th><th>PJ</th><th>AB</th><th>CS</th><th>1B</th><th>2B</th><th>3B</th><th>CC</th><th>PC</th><th>PP</th><th>BB</th><th>MOY</th></tr>
                    </thead>
                    <tbody id="playersStatsTable"></tbody>
                </table>
            </div>
        </div>

        <!-- TAB: PITCHERS -->
        <div id="pitchers-tab" class="tab-content">
            <h2 style="font-family:'Bebas Neue',sans-serif;color:var(--gold);margin-bottom:1rem">üéØ STATISTIQUES LANCEURS 2026</h2>
            <div class="standings-card">
                <table class="standings-table">
                    <thead>
                        <tr><th>#</th><th>Lanceur</th><th>√âQ</th><th>PJ</th><th>V</th><th>D</th><th>N</th><th>PC</th><th>CS</th><th>BB</th><th>RET</th><th>%V</th></tr>
                    </thead>
                    <tbody id="pitchersStatsTable"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // ========================================
        // DATA STORAGE
        // ========================================
        const STORAGE_KEYS = {
            players: 'lbma_season_players_2026',
            pitchers: 'lbma_season_pitchers_2026',
            teams: 'lbma_season_teams_2026',
            games: 'lbma_season_games_2026'
        };

        let seasonData = {
            players: {},  // {playerId: {pj,ab,cs,1b,2b,3b,cc,pc,pp,bb}}
            pitchers: {}, // {pitcherId: {pj,v,d,n,pc,cs,bb,ret}}
            teams: {},    // {teamName: {pj,v,d,n,pp,pc}}
            games: []     // [{date,away,home,scoreAway,scoreHome,stats}]
        };

        let currentMatch = null;
        const teamColors = {
            AIGLES:'#FF8001',CONDORS:'#124FB2',DUCS:'#006400',
            FAUCONS:'#CC0000',HARFANGS:'#929292',VAUTOURS:'#FFFF00'
        };

        // Players from roster
        const roster = {
            AIGLES:[{id:1,nom:"M√©nabo, Marc"},{id:2,nom:"Jasmin-Riel, Danick"},{id:3,nom:"Taddeo, Luke"},{id:4,nom:"Bureau, Robert"},{id:5,nom:"Beaudoin, St√©phane"},{id:6,nom:"S√©n√©cal, G√©rald"},{id:7,nom:"Garcia, Mathieu"},{id:8,nom:"Guerrera, Joe"},{id:9,nom:"Colati, Michael"},{id:10,nom:"Resler, Eric"}],
            CONDORS:[{id:11,nom:"Chauss√©, Serge"},{id:12,nom:"Longtin, Sylvain"},{id:13,nom:"Dorrington, Kevin"},{id:14,nom:"Carballada, Sacha"},{id:15,nom:"Lafreni√®re, √âric"},{id:16,nom:"St-Onge Lachapelle, F."},{id:17,nom:"David, Daniel"},{id:18,nom:"Latour, Jonathan"},{id:19,nom:"Borges, Quinn"},{id:20,nom:"Saint-Georges, Derek"}],
            DUCS:[{id:21,nom:"Noel, Jean-Christophe"},{id:22,nom:"Robillard, Hugo"},{id:23,nom:"Beaudry, Steve"},{id:24,nom:"Trempe, Sasha"},{id:25,nom:"Lariv√©e, St√©phane"},{id:26,nom:"Garcia, Edgar"},{id:27,nom:"Massamiri, Antony"},{id:28,nom:"Chartrand, Patrick"},{id:29,nom:"Forgues, Sylvain"},{id:30,nom:"Plante, Michel"}],
            FAUCONS:[{id:31,nom:"H√©tu, F√©lix"},{id:32,nom:"Monette, David"},{id:33,nom:"Ouellet-Dor√©, Mathieu"},{id:34,nom:"Jean-Lachapelle, J."},{id:35,nom:"St-Martin, Andr√©"},{id:36,nom:"Laverdi√®re, Philippe"},{id:37,nom:"Boivin, Carl-Olivier"},{id:38,nom:"Doyon, Guyllaume"},{id:39,nom:"Turcot, S√©bastien"},{id:40,nom:"Saint-Georges, Sylvain"}],
            HARFANGS:[{id:41,nom:"Vaillancourt, Olivier"},{id:42,nom:"Lamontagne, Sylvain"},{id:43,nom:"Dorrington, Jason"},{id:44,nom:"Stabile, John"},{id:45,nom:"Santo, Joe"},{id:46,nom:"Heppell, St√©phane"},{id:47,nom:"De Michele, Giovanni"},{id:48,nom:"Marchand, S√©bastien"},{id:49,nom:"Bonin, Pierre"},{id:50,nom:"Roberge, Vincent"}],
            VAUTOURS:[{id:51,nom:"Francoeur, Mathieu"},{id:52,nom:"Collard, √âric"},{id:53,nom:"Th√©riault, J√©r√©my"},{id:54,nom:"Ciarlo, Gino"},{id:55,nom:"Proulx, St√©phane"},{id:56,nom:"Lambert, Martin"},{id:57,nom:"St-Onge, Bruno"},{id:58,nom:"Charbonneau, Daniel"},{id:59,nom:"Poulin, Christian"},{id:60,nom:"Michaud, Jean-David"}]
        };

        // ========================================
        // INIT
        // ========================================
        function init() {
            loadSeasonData();
            document.getElementById('matchDate').value = new Date().toISOString().split('T')[0];
            updatePitcherSelects();
            renderRecentGames();
            renderStandings();
            renderLeaders();
            renderPlayersStats();
            renderPitchersStats();
            
            // Team select change handlers
            document.getElementById('teamAway').addEventListener('change', updatePitcherSelects);
            document.getElementById('teamHome').addEventListener('change', updatePitcherSelects);
        }

        function loadSeasonData() {
            Object.keys(STORAGE_KEYS).forEach(key => {
                const saved = localStorage.getItem(STORAGE_KEYS[key]);
                if (saved) seasonData[key] = JSON.parse(saved);
            });
            
            // Init teams if empty
            if (Object.keys(seasonData.teams).length === 0) {
                ['AIGLES','CONDORS','DUCS','FAUCONS','HARFANGS','VAUTOURS'].forEach(t => {
                    seasonData.teams[t] = {pj:0,v:0,d:0,n:0,pp:0,pc:0};
                });
            }
        }

        function saveSeasonData() {
            Object.keys(STORAGE_KEYS).forEach(key => {
                localStorage.setItem(STORAGE_KEYS[key], JSON.stringify(seasonData[key]));
            });
        }

        // ========================================
        // TABS
        // ========================================
        function switchMainTab(tab, btn) {
            document.querySelectorAll('.main-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            btn.classList.add('active');
            document.getElementById(tab + '-tab').classList.add('active');
            
            if (tab === 'standings') renderStandings();
            if (tab === 'leaders') renderLeaders();
            if (tab === 'players') renderPlayersStats();
            if (tab === 'pitchers') renderPitchersStats();
        }

        // ========================================
        // MATCH MANAGEMENT
        // ========================================
        function updatePitcherSelects() {
            const away = document.getElementById('teamAway').value;
            const home = document.getElementById('teamHome').value;
            
            const awaySelect = document.getElementById('pitcherAway');
            const homeSelect = document.getElementById('pitcherHome');
            
            awaySelect.innerHTML = roster[away].map(p => `<option value="${p.id}">${p.nom}</option>`).join('');
            homeSelect.innerHTML = roster[home].map(p => `<option value="${p.id}">${p.nom}</option>`).join('');
        }

        function startMatch() {
            const away = document.getElementById('teamAway').value;
            const home = document.getElementById('teamHome').value;
            const date = document.getElementById('matchDate').value;
            const pitcherAwayId = document.getElementById('pitcherAway').value;
            const pitcherHomeId = document.getElementById('pitcherHome').value;

            if (away === home) {
                showToast('‚ö†Ô∏è Les deux √©quipes doivent √™tre diff√©rentes!', 'danger');
                return;
            }

            currentMatch = {
                date, away, home,
                pitcherAway: parseInt(pitcherAwayId),
                pitcherHome: parseInt(pitcherHomeId),
                awayStats: {},
                homeStats: {},
                awayPitcher: {pc:0,cs:0,bb:0,ret:0},
                homePitcher: {pc:0,cs:0,bb:0,ret:0}
            };

            // Init player stats for match
            roster[away].forEach(p => {
                currentMatch.awayStats[p.id] = {ab:0,cs:0,b1:0,b2:0,b3:0,cc:0,pc:0,pp:0,bb:0};
            });
            roster[home].forEach(p => {
                currentMatch.homeStats[p.id] = {ab:0,cs:0,b1:0,b2:0,b3:0,cc:0,pc:0,pp:0,bb:0};
            });

            // Update UI
            document.getElementById('scoreboard').style.display = 'grid';
            document.getElementById('statsEntry').style.display = 'grid';
            document.getElementById('awayTeamName').textContent = away;
            document.getElementById('homeTeamName').textContent = home;
            document.getElementById('matchDateDisplay').textContent = date;
            document.getElementById('awayHeader').style.background = teamColors[away];
            document.getElementById('homeHeader').style.background = teamColors[home];
            document.getElementById('awayHeader').querySelector('span').textContent = 'ü¶Ö ' + away;
            document.getElementById('homeHeader').querySelector('span').textContent = 'ü¶Ö ' + home;

            const pitcherAwayName = roster[away].find(p => p.id == pitcherAwayId)?.nom || '-';
            const pitcherHomeName = roster[home].find(p => p.id == pitcherHomeId)?.nom || '-';
            document.getElementById('awayPitcherName').textContent = pitcherAwayName;
            document.getElementById('homePitcherName').textContent = pitcherHomeName;

            renderMatchPlayers();
            showToast('‚öæ Match d√©marr√©!', 'success');
        }

        function renderMatchPlayers() {
            if (!currentMatch) return;

            ['away', 'home'].forEach(side => {
                const team = side === 'away' ? currentMatch.away : currentMatch.home;
                const container = document.getElementById(side + 'Players');
                const stats = side === 'away' ? currentMatch.awayStats : currentMatch.homeStats;

                container.innerHTML = roster[team].map(p => {
                    const s = stats[p.id];
                    const moy = s.ab > 0 ? (s.cs / s.ab).toFixed(3) : '.000';
                    return `
                        <div class="player-stats-row" data-id="${p.id}" data-side="${side}">
                            <span class="player-name">${p.nom}</span>
                            <input type="number" value="${s.ab}" min="0" onchange="updateStat(${p.id},'${side}','ab',this.value)">
                            <input type="number" value="${s.cs}" min="0" onchange="updateStat(${p.id},'${side}','cs',this.value)">
                            <input type="number" value="${s.b1}" min="0" onchange="updateStat(${p.id},'${side}','b1',this.value)">
                            <input type="number" value="${s.b2}" min="0" onchange="updateStat(${p.id},'${side}','b2',this.value)">
                            <input type="number" value="${s.b3}" min="0" onchange="updateStat(${p.id},'${side}','b3',this.value)">
                            <input type="number" value="${s.cc}" min="0" onchange="updateStat(${p.id},'${side}','cc',this.value)">
                            <input type="number" value="${s.pc}" min="0" onchange="updateStat(${p.id},'${side}','pc',this.value)">
                            <input type="number" value="${s.pp}" min="0" onchange="updateStat(${p.id},'${side}','pp',this.value)">
                            <input type="number" value="${s.bb}" min="0" onchange="updateStat(${p.id},'${side}','bb',this.value)">
                            <span class="moy">${moy}</span>
                            <span>
                                <button class="quick-btn hit" onclick="quickHit(${p.id},'${side}')">+CS</button>
                                <button class="quick-btn out" onclick="quickOut(${p.id},'${side}')">+AB</button>
                            </span>
                        </div>
                    `;
                }).join('');
            });

            updateScores();
        }

        function updateStat(playerId, side, stat, value) {
            const stats = side === 'away' ? currentMatch.awayStats : currentMatch.homeStats;
            stats[playerId][stat] = parseInt(value) || 0;
            updateScores();
            renderMatchPlayers();
        }

        function quickHit(playerId, side) {
            const stats = side === 'away' ? currentMatch.awayStats : currentMatch.homeStats;
            stats[playerId].ab++;
            stats[playerId].cs++;
            stats[playerId].b1++;
            updateScores();
            renderMatchPlayers();
        }

        function quickOut(playerId, side) {
            const stats = side === 'away' ? currentMatch.awayStats : currentMatch.homeStats;
            stats[playerId].ab++;
            updateScores();
            renderMatchPlayers();
        }

        function updateScores() {
            if (!currentMatch) return;

            let awayPC = 0, homePC = 0;
            Object.values(currentMatch.awayStats).forEach(s => awayPC += s.pc);
            Object.values(currentMatch.homeStats).forEach(s => homePC += s.pc);

            document.getElementById('awayScore').textContent = awayPC;
            document.getElementById('homeScore').textContent = homePC;
            document.getElementById('awayPC').textContent = awayPC;
            document.getElementById('homePC').textContent = homePC;

            // Update pitcher stats (opponent's runs)
            currentMatch.homePitcher.pc = awayPC;
            currentMatch.awayPitcher.pc = homePC;
            
            let awayCS=0, homeCS=0, awayBB=0, homeBB=0;
            Object.values(currentMatch.awayStats).forEach(s => { awayCS += s.cs; awayBB += s.bb; });
            Object.values(currentMatch.homeStats).forEach(s => { homeCS += s.cs; homeBB += s.bb; });
            
            currentMatch.homePitcher.cs = awayCS;
            currentMatch.awayPitcher.cs = homeCS;
            currentMatch.homePitcher.bb = awayBB;
            currentMatch.awayPitcher.bb = homeBB;

            document.getElementById('awayPitcherPC').textContent = currentMatch.awayPitcher.pc;
            document.getElementById('awayPitcherCS').textContent = currentMatch.awayPitcher.cs;
            document.getElementById('awayPitcherBB').textContent = currentMatch.awayPitcher.bb;
            document.getElementById('homePitcherPC').textContent = currentMatch.homePitcher.pc;
            document.getElementById('homePitcherCS').textContent = currentMatch.homePitcher.cs;
            document.getElementById('homePitcherBB').textContent = currentMatch.homePitcher.bb;
        }

        function endMatch() {
            if (!currentMatch) return;
            if (!confirm('üèÅ Terminer et sauvegarder ce match?')) return;

            let awayPC = 0, homePC = 0;
            Object.values(currentMatch.awayStats).forEach(s => awayPC += s.pc);
            Object.values(currentMatch.homeStats).forEach(s => homePC += s.pc);

            // Update season player stats
            Object.entries(currentMatch.awayStats).forEach(([id, s]) => {
                if (!seasonData.players[id]) seasonData.players[id] = {pj:0,ab:0,cs:0,b1:0,b2:0,b3:0,cc:0,pc:0,pp:0,bb:0,team:currentMatch.away};
                const p = seasonData.players[id];
                p.pj++; p.ab+=s.ab; p.cs+=s.cs; p.b1+=s.b1; p.b2+=s.b2; p.b3+=s.b3; p.cc+=s.cc; p.pc+=s.pc; p.pp+=s.pp; p.bb+=s.bb;
            });
            Object.entries(currentMatch.homeStats).forEach(([id, s]) => {
                if (!seasonData.players[id]) seasonData.players[id] = {pj:0,ab:0,cs:0,b1:0,b2:0,b3:0,cc:0,pc:0,pp:0,bb:0,team:currentMatch.home};
                const p = seasonData.players[id];
                p.pj++; p.ab+=s.ab; p.cs+=s.cs; p.b1+=s.b1; p.b2+=s.b2; p.b3+=s.b3; p.cc+=s.cc; p.pc+=s.pc; p.pp+=s.pp; p.bb+=s.bb;
            });

            // Update pitcher stats
            const awayPitcherId = currentMatch.pitcherAway;
            const homePitcherId = currentMatch.pitcherHome;
            
            if (!seasonData.pitchers[awayPitcherId]) seasonData.pitchers[awayPitcherId] = {pj:0,v:0,d:0,n:0,pc:0,cs:0,bb:0,ret:0,team:currentMatch.away};
            if (!seasonData.pitchers[homePitcherId]) seasonData.pitchers[homePitcherId] = {pj:0,v:0,d:0,n:0,pc:0,cs:0,bb:0,ret:0,team:currentMatch.home};
            
            seasonData.pitchers[awayPitcherId].pj++;
            seasonData.pitchers[homePitcherId].pj++;
            seasonData.pitchers[awayPitcherId].pc += currentMatch.awayPitcher.pc;
            seasonData.pitchers[homePitcherId].pc += currentMatch.homePitcher.pc;
            seasonData.pitchers[awayPitcherId].cs += currentMatch.awayPitcher.cs;
            seasonData.pitchers[homePitcherId].cs += currentMatch.homePitcher.cs;
            seasonData.pitchers[awayPitcherId].bb += currentMatch.awayPitcher.bb;
            seasonData.pitchers[homePitcherId].bb += currentMatch.homePitcher.bb;

            // Determine winner
            if (awayPC > homePC) {
                seasonData.pitchers[awayPitcherId].v++;
                seasonData.pitchers[homePitcherId].d++;
                seasonData.teams[currentMatch.away].v++;
                seasonData.teams[currentMatch.home].d++;
            } else if (homePC > awayPC) {
                seasonData.pitchers[homePitcherId].v++;
                seasonData.pitchers[awayPitcherId].d++;
                seasonData.teams[currentMatch.home].v++;
                seasonData.teams[currentMatch.away].d++;
            } else {
                seasonData.pitchers[awayPitcherId].n++;
                seasonData.pitchers[homePitcherId].n++;
                seasonData.teams[currentMatch.away].n++;
                seasonData.teams[currentMatch.home].n++;
            }

            // Update team stats
            seasonData.teams[currentMatch.away].pj++;
            seasonData.teams[currentMatch.home].pj++;
            seasonData.teams[currentMatch.away].pp += awayPC;
            seasonData.teams[currentMatch.away].pc += homePC;
            seasonData.teams[currentMatch.home].pp += homePC;
            seasonData.teams[currentMatch.home].pc += awayPC;

            // Save game
            seasonData.games.unshift({
                date: currentMatch.date,
                away: currentMatch.away,
                home: currentMatch.home,
                scoreAway: awayPC,
                scoreHome: homePC
            });

            saveSeasonData();
            
            // Reset UI
            currentMatch = null;
            document.getElementById('scoreboard').style.display = 'none';
            document.getElementById('statsEntry').style.display = 'none';
            
            renderRecentGames();
            renderStandings();
            renderLeaders();
            renderPlayersStats();
            renderPitchersStats();

            showToast('üèÅ Match termin√© et sauvegard√©!', 'success');
        }

        // ========================================
        // STANDINGS
        // ========================================
        function renderStandings() {
            const table = document.getElementById('standingsTable');
            const teams = Object.entries(seasonData.teams)
                .map(([name, t]) => ({name, ...t, pts: t.v*2 + t.n, diff: t.pp - t.pc}))
                .sort((a,b) => b.pts - a.pts || b.diff - a.diff);

            table.innerHTML = teams.map((t, i) => `
                <tr>
                    <td><strong>${i+1}</strong></td>
                    <td style="color:${teamColors[t.name]}"><strong>${t.name}</strong></td>
                    <td>${t.pj}</td>
                    <td><strong>${t.v}</strong></td>
                    <td>${t.d}</td>
                    <td>${t.n}</td>
                    <td>${t.pp}</td>
                    <td>${t.pc}</td>
                    <td style="color:${t.diff>=0?'green':'red'}">${t.diff>=0?'+':''}${t.diff}</td>
                    <td><strong>${t.pts}</strong></td>
                </tr>
            `).join('');
        }

        // ========================================
        // LEADERS
        // ========================================
        function renderLeaders() {
            const allPlayers = [];
            Object.entries(seasonData.players).forEach(([id, p]) => {
                const playerInfo = Object.values(roster).flat().find(r => r.id == id);
                if (playerInfo && p.ab > 0) {
                    allPlayers.push({id, nom: playerInfo.nom, team: p.team, ...p, moy: p.cs/p.ab});
                }
            });

            // MOY leaders
            const moyLeaders = [...allPlayers].filter(p => p.ab >= 10).sort((a,b) => b.moy - a.moy).slice(0,10);
            document.getElementById('leadersMoy').innerHTML = moyLeaders.map((p,i) => `
                <div class="leader-item"><span class="rank">${i+1}</span><span class="name">${p.nom} <small style="color:#999">(${p.team})</small></span><span class="value">${p.moy.toFixed(3)}</span></div>
            `).join('') || '<p style="padding:1rem;color:#999">Pas assez de donn√©es</p>';

            // CS leaders
            const csLeaders = [...allPlayers].sort((a,b) => b.cs - a.cs).slice(0,10);
            document.getElementById('leadersCS').innerHTML = csLeaders.map((p,i) => `
                <div class="leader-item"><span class="rank">${i+1}</span><span class="name">${p.nom}</span><span class="value">${p.cs}</span></div>
            `).join('') || '<p style="padding:1rem;color:#999">Pas assez de donn√©es</p>';

            // CC leaders
            const ccLeaders = [...allPlayers].sort((a,b) => b.cc - a.cc).slice(0,10);
            document.getElementById('leadersCC').innerHTML = ccLeaders.map((p,i) => `
                <div class="leader-item"><span class="rank">${i+1}</span><span class="name">${p.nom}</span><span class="value">${p.cc}</span></div>
            `).join('') || '<p style="padding:1rem;color:#999">Pas assez de donn√©es</p>';

            // PC leaders
            const pcLeaders = [...allPlayers].sort((a,b) => b.pc - a.pc).slice(0,10);
            document.getElementById('leadersPC').innerHTML = pcLeaders.map((p,i) => `
                <div class="leader-item"><span class="rank">${i+1}</span><span class="name">${p.nom}</span><span class="value">${p.pc}</span></div>
            `).join('') || '<p style="padding:1rem;color:#999">Pas assez de donn√©es</p>';

            // PP leaders
            const ppLeaders = [...allPlayers].sort((a,b) => b.pp - a.pp).slice(0,10);
            document.getElementById('leadersPP').innerHTML = ppLeaders.map((p,i) => `
                <div class="leader-item"><span class="rank">${i+1}</span><span class="name">${p.nom}</span><span class="value">${p.pp}</span></div>
            `).join('') || '<p style="padding:1rem;color:#999">Pas assez de donn√©es</p>';

            // Pitcher wins
            const pitchers = [];
            Object.entries(seasonData.pitchers).forEach(([id, p]) => {
                const info = Object.values(roster).flat().find(r => r.id == id);
                if (info) pitchers.push({id, nom: info.nom, team: p.team, ...p});
            });
            const winsLeaders = pitchers.sort((a,b) => b.v - a.v).slice(0,10);
            document.getElementById('leadersWins').innerHTML = winsLeaders.map((p,i) => `
                <div class="leader-item"><span class="rank">${i+1}</span><span class="name">${p.nom}</span><span class="value">${p.v}-${p.d}</span></div>
            `).join('') || '<p style="padding:1rem;color:#999">Pas assez de donn√©es</p>';
        }

        // ========================================
        // PLAYERS STATS
        // ========================================
        function renderPlayersStats() {
            const filter = document.getElementById('filterTeamPlayers')?.value || '';
            const table = document.getElementById('playersStatsTable');
            
            const allPlayers = [];
            Object.entries(seasonData.players).forEach(([id, p]) => {
                const info = Object.values(roster).flat().find(r => r.id == id);
                if (info && (!filter || p.team === filter)) {
                    allPlayers.push({id, nom: info.nom, ...p, moy: p.ab > 0 ? p.cs/p.ab : 0});
                }
            });

            allPlayers.sort((a,b) => b.moy - a.moy);

            table.innerHTML = allPlayers.map((p, i) => `
                <tr>
                    <td>${i+1}</td>
                    <td><strong>${p.nom}</strong></td>
                    <td style="color:${teamColors[p.team]}">${p.team}</td>
                    <td>${p.pj}</td>
                    <td>${p.ab}</td>
                    <td><strong>${p.cs}</strong></td>
                    <td>${p.b1}</td>
                    <td>${p.b2}</td>
                    <td>${p.b3}</td>
                    <td>${p.cc}</td>
                    <td>${p.pc}</td>
                    <td>${p.pp}</td>
                    <td>${p.bb}</td>
                    <td><strong>${p.moy.toFixed(3)}</strong></td>
                </tr>
            `).join('') || '<tr><td colspan="14" style="text-align:center;padding:2rem">Aucune statistique encore</td></tr>';
        }

        // ========================================
        // PITCHERS STATS
        // ========================================
        function renderPitchersStats() {
            const table = document.getElementById('pitchersStatsTable');
            
            const allPitchers = [];
            Object.entries(seasonData.pitchers).forEach(([id, p]) => {
                const info = Object.values(roster).flat().find(r => r.id == id);
                if (info) {
                    const winPct = (p.v + p.d) > 0 ? (p.v / (p.v + p.d) * 100) : 0;
                    allPitchers.push({id, nom: info.nom, ...p, winPct});
                }
            });

            allPitchers.sort((a,b) => b.v - a.v);

            table.innerHTML = allPitchers.map((p, i) => `
                <tr>
                    <td>${i+1}</td>
                    <td><strong>${p.nom}</strong></td>
                    <td style="color:${teamColors[p.team]}">${p.team}</td>
                    <td>${p.pj}</td>
                    <td><strong>${p.v}</strong></td>
                    <td>${p.d}</td>
                    <td>${p.n}</td>
                    <td>${p.pc}</td>
                    <td>${p.cs}</td>
                    <td>${p.bb}</td>
                    <td>${p.ret}</td>
                    <td><strong>${p.winPct.toFixed(1)}%</strong></td>
                </tr>
            `).join('') || '<tr><td colspan="12" style="text-align:center;padding:2rem">Aucune statistique encore</td></tr>';
        }

        // ========================================
        // RECENT GAMES
        // ========================================
        function renderRecentGames() {
            const tbody = document.getElementById('recentGames');
            if (seasonData.games.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;padding:2rem">Aucun match jou√©</td></tr>';
                return;
            }

            tbody.innerHTML = seasonData.games.slice(0, 10).map(g => `
                <tr>
                    <td>${g.date}</td>
                    <td style="color:${teamColors[g.away]}">${g.away}</td>
                    <td><strong>${g.scoreAway} - ${g.scoreHome}</strong></td>
                    <td style="color:${teamColors[g.home]}">${g.home}</td>
                    <td><button class="btn btn-danger" style="padding:.25rem .5rem;font-size:.8rem" onclick="deleteGame('${g.date}','${g.away}','${g.home}')">üóëÔ∏è</button></td>
                </tr>
            `).join('');
        }

        function deleteGame(date, away, home) {
            if (!confirm(`Supprimer le match ${away} vs ${home} du ${date}?`)) return;
            seasonData.games = seasonData.games.filter(g => !(g.date === date && g.away === away && g.home === home));
            saveSeasonData();
            renderRecentGames();
            showToast('üóëÔ∏è Match supprim√©', 'danger');
        }

        // ========================================
        // TOAST
        // ========================================
        function showToast(msg, type='success') {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.textContent = msg;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        // Init
        init();
    </script>
</body>
</html>
