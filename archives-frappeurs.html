<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Archives Frappeurs - LBMA 1976-2025</title>
    <link rel="icon" type="image/jpeg" href="logo-lbma.jpg">
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Oswald:wght@400;600;700&family=Work+Sans:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{--primary:#1E3A5F;--accent:#CC0000;--gold:#D4AF37;--white:#FDFBF7;--cream:#F5F1E8;--dark:#1A1A1A;--grass:#2D5016;--dirt:#8B6F47}
        body{font-family:'Work Sans',sans-serif;background:var(--cream);color:var(--dark)}
        .page-header{margin-top:80px;background:linear-gradient(135deg,var(--primary) 0%,#2D5A8A 100%);color:var(--white);padding:3rem 2rem;text-align:center;position:relative}
        .page-header::before{content:'';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:300px;height:300px;background:url('logo-lbma.jpg') no-repeat center;background-size:contain;opacity:.1}
        .page-header h1{font-family:'Bebas Neue',sans-serif;font-size:clamp(2rem,6vw,3.5rem);letter-spacing:.1em;position:relative}
        .page-header p{font-family:'Oswald',sans-serif;font-size:1.2rem;position:relative;margin-top:.5rem}
        .container{max-width:1400px;margin:0 auto;padding:2rem}
        
        /* Controls */
        .controls{background:var(--white);border:3px solid var(--dark);padding:1.5rem;margin-bottom:2rem;display:flex;gap:1rem;flex-wrap:wrap;align-items:flex-end}
        .control-group{display:flex;flex-direction:column;gap:.5rem}
        .control-group label{font-family:'Oswald',sans-serif;text-transform:uppercase;font-size:.85rem;color:var(--primary)}
        .control-group select{padding:.75rem 1.5rem;border:2px solid var(--dark);font-size:1rem;background:var(--cream);min-width:200px;cursor:pointer}
        .control-group select:focus{outline:none;border-color:var(--primary)}
        .btn{padding:.75rem 1.5rem;font-family:'Oswald',sans-serif;border:2px solid var(--dark);cursor:pointer;transition:.3s;text-transform:uppercase;background:var(--primary);color:white}
        .btn:hover{opacity:.9}
        .btn-secondary{background:var(--cream);color:var(--dark)}
        
        /* Tabs */
        .tabs{display:flex;gap:0;margin-bottom:0}
        .tab-btn{padding:1rem 2rem;background:var(--cream);border:3px solid var(--dark);border-bottom:none;font-family:'Oswald',sans-serif;font-size:1rem;cursor:pointer;transition:.3s;margin-right:-3px}
        .tab-btn.active{background:var(--primary);color:white}
        .tab-content{display:none;background:var(--white);border:3px solid var(--dark);padding:2rem}
        .tab-content.active{display:block}
        
        /* Stats Table */
        .stats-table{width:100%;border-collapse:collapse;font-size:.9rem}
        .stats-table th{background:var(--primary);color:white;padding:.75rem .5rem;text-align:center;font-family:'Oswald',sans-serif;text-transform:uppercase;font-size:.8rem;position:sticky;top:0}
        .stats-table td{padding:.5rem;text-align:center;border-bottom:1px solid var(--cream)}
        .stats-table tr:hover{background:rgba(30,58,95,.05)}
        .stats-table .player-name{text-align:left;font-weight:600;white-space:nowrap}
        .stats-table .highlight{background:rgba(212,175,55,.2)}
        .stats-table .not-played{color:#999;font-style:italic}
        
        /* Player Card */
        .player-card{background:var(--white);border:3px solid var(--dark);margin-bottom:2rem}
        .player-card-header{background:var(--primary);color:white;padding:1.5rem;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem}
        .player-card-header h2{font-family:'Bebas Neue',sans-serif;font-size:2rem;letter-spacing:.05em}
        .player-card-header .stats-summary{display:flex;gap:2rem}
        .player-card-header .stat{text-align:center}
        .player-card-header .stat-value{font-family:'Bebas Neue',sans-serif;font-size:2rem;color:var(--gold)}
        .player-card-header .stat-label{font-size:.8rem;opacity:.8}
        .player-card-body{padding:1.5rem;max-height:500px;overflow-y:auto}
        
        /* Totals Row */
        .totals-row{background:var(--primary);color:white;font-weight:bold}
        .totals-row td{padding:.75rem .5rem}
        
        /* Year badge */
        .year-badge{display:inline-block;padding:.25rem .5rem;background:var(--gold);color:var(--dark);font-family:'Oswald',sans-serif;font-size:.85rem;border-radius:3px}
        
        /* Legend */
        .legend{background:var(--cream);border:2px solid var(--dark);padding:1rem;margin-top:1rem;font-size:.85rem}
        .legend h4{font-family:'Oswald',sans-serif;color:var(--primary);margin-bottom:.5rem}
        .legend-grid{display:flex;flex-wrap:wrap;gap:1rem}
        .legend-item{display:flex;align-items:center;gap:.25rem}
        
        /* Responsive */
        @media(max-width:768px){
            .controls{flex-direction:column}
            .control-group select{width:100%}
            .stats-table{font-size:.75rem}
            .stats-table th,.stats-table td{padding:.3rem}
            .player-card-header{flex-direction:column;text-align:center}
        }
    .social-links{display:flex;gap:1rem;margin-top:1rem;flex-wrap:wrap}.social-link{display:flex;align-items:center;gap:.5rem;background:rgba(255,255,255,.1);padding:.5rem 1rem;border-radius:5px;color:white;text-decoration:none;transition:.3s}.social-link:hover{background:var(--gold);color:var(--dark)}.social-link svg{width:20px;height:20px;fill:currentColor}.footer-content{max-width:1200px;margin:0 auto;display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;gap:2rem}
        .footer-links{display:flex;gap:1rem;flex-wrap:wrap}
        .footer-link{color:var(--gold);text-decoration:none;padding:.5rem 1rem;border:1px solid var(--gold);transition:.3s;font-family:'Oswald',sans-serif}
        .footer-link:hover{background:var(--gold);color:var(--dark)}
        .footer-social{display:flex;gap:.5rem;flex-wrap:wrap}
        .social-link{display:inline-flex;align-items:center;gap:.5rem;background:rgba(255,255,255,.1);padding:.6rem 1.2rem;border-radius:5px;color:white;text-decoration:none;transition:.3s}
        .social-link:hover{background:var(--gold);color:var(--dark)}
        .footer-bottom{max-width:1200px;margin:1.5rem auto 0;padding-top:1.5rem;border-top:1px solid rgba(255,255,255,.2);text-align:center;opacity:.7;font-size:.85rem}

            /* === NAV STANDARD LBMA === */
        nav{position:fixed;top:0;left:0;right:0;z-index:1000;background:var(--white);box-shadow:0 2px 20px rgba(0,0,0,.1)}
        nav .nav-container{max-width:1400px;margin:0 auto;padding:.75rem 2rem;display:flex;justify-content:space-between;align-items:center}
        .logo{display:flex;align-items:center;gap:.75rem;text-decoration:none}
        .logo img{height:55px}
        nav ul{display:flex;list-style:none;gap:.5rem}
        nav li{position:relative}
        nav a{text-decoration:none;color:var(--dark);font-weight:600;text-transform:uppercase;font-size:.85rem;padding:.5rem 1rem;display:block;transition:.3s}
        nav a:hover{color:var(--primary);background:var(--cream)}
        .dropdown-content{display:none;position:absolute;top:100%;left:0;background:var(--white);min-width:220px;box-shadow:0 8px 16px rgba(0,0,0,.1);border:2px solid var(--dark);z-index:1001}
        .dropdown-content a{padding:.75rem 1rem;border-bottom:1px solid var(--cream);font-size:.8rem}
        .dropdown:hover .dropdown-content{display:block}
        .dropdown>a::after{content:' \25BC';font-size:.6rem}
        .hamburger{display:none;font-size:2rem;cursor:pointer;padding:.5rem;color:var(--dark)}
        /* === FOOTER STANDARD LBMA === */
        footer{background:var(--dark);color:var(--white);padding:3rem 2rem}
        .footer-social{display:flex;gap:.5rem;flex-wrap:wrap}
        .social-link{display:inline-flex;align-items:center;gap:.5rem;background:rgba(255,255,255,.1);padding:.6rem 1.2rem;border-radius:5px;color:white;text-decoration:none;transition:.3s}
        .social-link:hover{background:var(--gold);color:var(--dark)}
        .footer-bottom{max-width:1400px;margin:1.5rem auto 0;padding-top:1.5rem;border-top:1px solid rgba(255,255,255,.2);text-align:center;opacity:.7;font-size:.85rem}
        .dropdown.open .dropdown-content{display:block!important}
        @media(max-width:768px){
            .hamburger{display:block}
            nav ul{display:none;position:absolute;top:100%;left:0;right:0;background:var(--white);flex-direction:column;padding:1rem;box-shadow:0 8px 16px rgba(0,0,0,.1)}
            nav ul.open{display:flex}
            .dropdown-content{position:static;box-shadow:none;border:none;border-left:3px solid var(--primary);margin-left:1rem}
            .dropdown:hover .dropdown-content{display:none}
            .dropdown.open .dropdown-content{display:block}
        }
    </style>
</head>
<body>
    <nav>
        <div class="nav-container">
            <a href="index.html" class="logo"><img src="logo-lbma.jpg" alt="LBMA"></a>
            <div class="hamburger" onclick="document.querySelector('nav ul').classList.toggle('open')">&#9776;</div>
            <ul>
                <li><a href="index.html">Accueil</a></li>
                <li><a href="equipes.html">√âquipes</a></li>
                <li><a href="joueurs.html">Joueurs</a></li>
                <li><a href="calendrier.html">Calendrier</a></li>
                <li class="dropdown">
                    <a href="#">Statistiques</a>
                    <div class="dropdown-content">
                        <a href="classement-equipes.html">üèÜ Classement</a>
                        <a href="stats-frappeurs.html">‚öæ Frappeurs</a>
                        <a href="stats-lanceurs.html">üéØ Lanceurs</a>
                    </div>
                </li>
                <li class="dropdown">
                    <a href="#" style="color:var(--primary);font-weight:700">Archives</a>
                    <div class="dropdown-content">
                        <a href="archives-frappeurs.html">üìä Stats Frappeurs par Ann√©e</a>
                        <a href="frappeurs-carriere.html">‚≠ê Frappeurs - Carri√®re</a>
                        <a href="frappeurs-records.html">üèÜ Frappeurs - Records</a>
                        <a href="archives-lanceurs.html">üìä Stats Lanceurs par Ann√©e</a>
                        <a href="lanceurs-carriere.html">‚≠ê Lanceurs - Carri√®re</a>
                        <a href="lanceurs-records.html">üèÜ Lanceurs - Records</a>
                        <a href="classement-equipes.html">üìà Classements Historiques</a>
                        <a href="temple-renommee.html">üèõÔ∏è Temple de la Renomm√©e</a>
                        <a href="archives.html">üìö Archives Compl√®tes</a>
                    </div>
                </li>
                <li><a href="contact.html">Direction</a></li>
                <li><a href="admin.html" style="color:var(--accent)">Admin</a></li>
            </ul>
        </div>
    </nav>

    <div class="page-header">
        <h1>üìä Archives des Frappeurs</h1>
        <p>Historique des statistiques individuelles ‚Ä¢ 1976-2025</p>
    </div>

    <div class="container">
        <!-- CONTROLS -->
        <div class="controls">
            <div class="control-group">
                <label>üìÖ Ann√©e</label>
                <select id="yearSelect" onchange="loadYearStats()">
                    <option value="">-- S√©lectionner une ann√©e --</option>
                </select>
            </div>
            <div class="control-group">
                <label>üë§ Joueur (Fiche individuelle)</label>
                <select id="playerSelect" onchange="loadPlayerCard()">
                    <option value="">-- Choisir un joueur --</option>
                </select>
            </div>
            <button class="btn btn-secondary" onclick="resetView()">üîÑ R√©initialiser</button>
        </div>

        <!-- TABS -->
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('year',this)">üìÖ Stats par Ann√©e</button>
            <button class="tab-btn" onclick="switchTab('player',this)">üë§ Fiche Joueur</button>
        </div>

        <!-- TAB: YEAR STATS -->
        <div id="year-tab" class="tab-content active">
            <div id="yearStatsContainer">
                <p style="text-align:center;padding:3rem;color:#666">
                    <span style="font-size:3rem">üìÖ</span><br><br>
                    S√©lectionnez une ann√©e pour voir les statistiques
                </p>
            </div>
        </div>

        <!-- TAB: PLAYER CARD -->
        <div id="player-tab" class="tab-content">
            <div id="playerCardContainer">
                <p style="text-align:center;padding:3rem;color:#666">
                    <span style="font-size:3rem">üë§</span><br><br>
                    S√©lectionnez un joueur pour voir sa fiche compl√®te
                </p>
            </div>
        </div>

        <!-- LEGEND -->
        <div class="legend">
            <h4>üìñ L√©gende des Statistiques</h4>
            <div class="legend-grid">
                <span class="legend-item"><strong>PJ</strong>=Parties jou√©es</span>
                <span class="legend-item"><strong>AB</strong>=Au b√¢ton</span>
                <span class="legend-item"><strong>CS</strong>=Coups s√ªrs</span>
                <span class="legend-item"><strong>1B</strong>=Simples</span>
                <span class="legend-item"><strong>2B</strong>=Doubles</span>
                <span class="legend-item"><strong>3B</strong>=Triples</span>
                <span class="legend-item"><strong>CC</strong>=Coups de circuit</span>
                <span class="legend-item"><strong>PC</strong>=Points compt√©s</span>
                <span class="legend-item"><strong>PP</strong>=Points produits</span>
                <span class="legend-item"><strong>SAC</strong>=Sacrifices</span>
                <span class="legend-item"><strong>BB</strong>=Buts sur balles</span>
                <span class="legend-item"><strong>RB</strong>=Retraits au b√¢ton</span>
                <span class="legend-item"><strong>MOY</strong>=Moyenne</span>
                <span class="legend-item"><strong>OBP</strong>=Pr√©sence sur les buts</span>
                <span class="legend-item"><strong>SLG</strong>=Moyenne de puissance</span>
                <span class="legend-item"><strong>√âQ</strong>=√âquipe</span>
                <span class="legend-item"><strong>Cote</strong>=Cote du joueur</span>
            </div>
        </div>
    </div>

    <script>

        /*
         * CALCUL AUTOMATIQUE DES MOYENNES
         * ================================
         * Frappeurs: MOY = CS / AB (Coups S√ªrs / Au B√¢ton)
         * Source: Supabase (avec fallback JSON local)
         * Colonnes Supabase: simples, doubles, triples, cc, pc, pp, sac, bb, rb, moy
         */

        const SUPABASE_URL = 'https://xgyskiatppgaeaamjhxr.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhneXNraWF0cHBnYWVhYW1qaHhyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA0OTgxNTQsImV4cCI6MjA4NjA3NDE1NH0.67KCcUWlJij-scDoCUvZpkiCle5-mHVmy-inRk96Tac';

        let allData = {};
        let years = [];
        let allPlayers = [];
        let dataSource = 'json'; // 'supabase' ou 'json'

        // Normaliser les donn√©es Supabase vers le format attendu par le HTML
        function normalizePlayer(p) {
            return {
                nom: p.nom,
                equipe: p.equipe || '',
                cote: p.cote || '',
                pj: p.pj || 0,
                ab: p.ab || 0,
                cs: p.cs || 0,
                '1b': p.simples || p['1b'] || 0,
                '2b': p.doubles || p['2b'] || 0,
                '3b': p.triples || p['3b'] || 0,
                cc: p.cc || 0,
                pc: p.pc || p.r || 0,
                pp: p.pp || p.rbi || 0,
                sac: p.sac || 0,
                bb: p.bb || 0,
                rb: p.rb || p.k || 0,
                moy: p.moy || 0
            };
        }

        // Charger depuis Supabase
        async function loadFromSupabase() {
            const url = `${SUPABASE_URL}/rest/v1/frappeurs_saison?select=*&order=saison.desc,moy.desc&limit=3000`;
            const response = await fetch(url, {
                headers: {
                    'apikey': SUPABASE_ANON_KEY,
                    'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                    'Range': '0-2999'
                }
            });
            if (!response.ok) throw new Error(`HTTP ${response.status}`);
            const rows = await response.json();
            if (!rows || rows.length === 0) throw new Error('Aucune donn√©e re√ßue');
            console.log(`Supabase: ${rows.length} lignes re√ßues`);
            
            // Grouper par saison
            const grouped = {};
            rows.forEach(row => {
                const saison = row.saison;
                if (!grouped[saison]) grouped[saison] = [];
                grouped[saison].push(normalizePlayer(row));
            });
            return grouped;
        }

        // Load data
        async function init() {
            try {
                // Essayer Supabase d'abord
                allData = await loadFromSupabase();
                dataSource = 'supabase';
                console.log('‚úÖ Donn√©es charg√©es depuis Supabase');
            } catch (err) {
                console.warn('Supabase indisponible, chargement du JSON local...', err);
                try {
                    const response = await fetch('frappeurs-data.json');
                    const jsonData = await response.json();
                    // Normaliser les donn√©es JSON aussi
                    allData = {};
                    Object.keys(jsonData).forEach(year => {
                        allData[year] = jsonData[year].map(normalizePlayer);
                    });
                    dataSource = 'json';
                } catch (e) {
                    console.error('Erreur chargement donn√©es:', e);
                    return;
                }
            }

            years = Object.keys(allData).sort((a,b) => b-a);
            
            // Populate year select
            const yearSelect = document.getElementById('yearSelect');
            years.forEach(year => {
                yearSelect.innerHTML += `<option value="${year}">${year}</option>`;
            });

            // Extract all unique players
            const playerMap = new Map();
            years.forEach(year => {
                allData[year].forEach(p => {
                    const key = p.nom.toUpperCase();
                    if (!playerMap.has(key)) {
                        playerMap.set(key, p.nom);
                    } else {
                        const existing = playerMap.get(key);
                        if (existing === existing.toUpperCase() && p.nom !== p.nom.toUpperCase()) {
                            playerMap.set(key, p.nom);
                        }
                    }
                });
            });
            allPlayers = Array.from(playerMap.values()).sort();

            // Populate player select
            const playerSelect = document.getElementById('playerSelect');
            allPlayers.forEach(player => {
                playerSelect.innerHTML += `<option value="${player}">${player}</option>`;
            });

            console.log(`Loaded ${years.length} years, ${allPlayers.length} players (source: ${dataSource})`);
        }

        function switchTab(tab, el) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
            document.getElementById(tab + '-tab').classList.add('active');
        }

        // Calculs OBP et SLG
        function calcOBP(p) {
            const cs = p.cs || 0;
            const bb = p.bb || 0;
            const sac = p.sac || 0;
            const ab = p.ab || 0;
            const denom = ab + bb + sac;
            return denom > 0 ? (cs + bb) / denom : 0;
        }
        function calcSLG(p) {
            const b1 = p['1b'] || p.b1 || 0;
            const b2 = p['2b'] || p.b2 || 0;
            const b3 = p['3b'] || p.b3 || 0;
            const cc = p.cc || 0;
            const ab = p.ab || 0;
            return ab > 0 ? (b1 + b2*2 + b3*3 + cc*4) / ab : 0;
        }

        function loadYearStats() {
            const year = document.getElementById('yearSelect').value;
            if (!year) return;

            const container = document.getElementById('yearStatsContainer');
            const data = allData[year];
            
            if (!data || data.length === 0) {
                container.innerHTML = '<p style="text-align:center;padding:2rem">Aucune donn√©e pour cette ann√©e</p>';
                return;
            }

            // S√©parer: ‚â•8 PJ (classement) et <8 PJ (en bas)
            const qualified = [...data].filter(p => (p.pj || 0) >= 8);
            const unqualified = [...data].filter(p => (p.pj || 0) < 8);

            // Sort by average (descending)
            qualified.sort((a,b) => {
                const moyA = a.ab > 0 ? a.cs / a.ab : 0;
                const moyB = b.ab > 0 ? b.cs / b.ab : 0;
                return moyB - moyA;
            });
            unqualified.sort((a,b) => {
                const moyA = a.ab > 0 ? a.cs / a.ab : 0;
                const moyB = b.ab > 0 ? b.cs / b.ab : 0;
                return moyB - moyA;
            });

            let html = `
                <h3 style="font-family:'Oswald',sans-serif;color:var(--primary);margin-bottom:.5rem">
                    <span class="year-badge">${year}</span> Statistiques des Frappeurs (${data.length} joueurs)
                </h3>
                <p style="color:var(--accent);font-size:.85rem;margin-bottom:1rem">Un joueur doit avoir un minimum de 8 parties jou√©es pour faire partie de ce classement</p>
                <div style="overflow-x:auto">
                <table class="stats-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th style="text-align:left">Nom</th>
                            <th>√âQ</th>
                            <th>Cote</th>
                            <th>PJ</th>
                            <th>AB</th>
                            <th>CS</th>
                            <th>1B</th>
                            <th>2B</th>
                            <th>3B</th>
                            <th>CC</th>
                            <th>PC</th>
                            <th>PP</th>
                            <th>SAC</th>
                            <th>BB</th>
                            <th>RB</th>
                            <th>MOY</th>
                            <th>OBP</th>
                            <th>SLG</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            // Joueurs qualifi√©s (‚â•8 PJ)
            qualified.forEach((p, i) => {
                const moy = p.ab > 0 ? (p.cs / p.ab).toFixed(3) : '.000';
                const obp = calcOBP(p).toFixed(3);
                const slg = calcSLG(p).toFixed(3);
                const isTop10 = i < 10;
                html += `
                    <tr class="${isTop10 ? 'highlight' : ''}">
                        <td>${i + 1}</td>
                        <td class="player-name">${p.nom}</td>
                        <td>${p.equipe || '-'}</td>
                        <td>${p.cote || '-'}</td>
                        <td>${p.pj || 0}</td>
                        <td>${p.ab || 0}</td>
                        <td><strong>${p.cs || 0}</strong></td>
                        <td>${p['1b'] || 0}</td>
                        <td>${p['2b'] || 0}</td>
                        <td>${p['3b'] || 0}</td>
                        <td>${p.cc || 0}</td>
                        <td>${p.pc || 0}</td>
                        <td>${p.pp || 0}</td>
                        <td>${p.sac || 0}</td>
                        <td>${p.bb || 0}</td>
                        <td>${p.rb || 0}</td>
                        <td><strong>${moy}</strong></td>
                        <td>${obp}</td>
                        <td>${slg}</td>
                    </tr>
                `;
            });

            // S√©parateur si joueurs non qualifi√©s
            if (unqualified.length > 0) {
                html += `
                    <tr style="background:var(--cream);border-top:3px solid var(--dark)">
                        <td colspan="19" style="text-align:center;padding:.75rem;font-family:'Oswald',sans-serif;color:var(--accent)">
                            ‚ñº Moins de 8 parties jou√©es (${unqualified.length} joueurs) ‚ñº
                        </td>
                    </tr>
                `;
                unqualified.forEach((p, i) => {
                    const moy = p.ab > 0 ? (p.cs / p.ab).toFixed(3) : '.000';
                    const obp = calcOBP(p).toFixed(3);
                    const slg = calcSLG(p).toFixed(3);
                    html += `
                        <tr style="opacity:.7">
                            <td>${i + 1}</td>
                            <td class="player-name">${p.nom}</td>
                            <td>${p.equipe || '-'}</td>
                            <td>${p.cote || '-'}</td>
                            <td>${p.pj || 0}</td>
                            <td>${p.ab || 0}</td>
                            <td><strong>${p.cs || 0}</strong></td>
                            <td>${p['1b'] || 0}</td>
                            <td>${p['2b'] || 0}</td>
                            <td>${p['3b'] || 0}</td>
                            <td>${p.cc || 0}</td>
                            <td>${p.pc || 0}</td>
                            <td>${p.pp || 0}</td>
                            <td>${p.sac || 0}</td>
                            <td>${p.bb || 0}</td>
                            <td>${p.rb || 0}</td>
                            <td><strong>${moy}</strong></td>
                            <td>${obp}</td>
                            <td>${slg}</td>
                        </tr>
                    `;
                });
            }

            html += '</tbody></table></div>';
            container.innerHTML = html;

            // Switch to year tab
            switchTab('year', document.querySelector('.tab-btn'));
        }

        function loadPlayerCard() {
            const playerName = document.getElementById('playerSelect').value;
            if (!playerName) return;

            const container = document.getElementById('playerCardContainer');
            
            // Collect all years for this player
            const playerYears = [];
            let totals = { pj:0, ab:0, cs:0, b1:0, b2:0, b3:0, cc:0, pc:0, pp:0, sac:0, bb:0, rb:0 };
            let seasonsPlayed = 0;

            // Go through all years from most recent to oldest
            years.forEach(year => {
                const yearData = allData[year];
                const playerData = yearData ? yearData.find(p => p.nom.toUpperCase() === playerName.toUpperCase()) : null;
                
                if (playerData) {
                    seasonsPlayed++;
                    playerYears.push({
                        year: year,
                        played: true,
                        data: playerData
                    });
                    // Add to totals
                    totals.pj += playerData.pj || 0;
                    totals.ab += playerData.ab || 0;
                    totals.cs += playerData.cs || 0;
                    totals.b1 += playerData['1b'] || 0;
                    totals.b2 += playerData['2b'] || 0;
                    totals.b3 += playerData['3b'] || 0;
                    totals.cc += playerData.cc || 0;
                    totals.pc += playerData.pc || 0;
                    totals.pp += playerData.pp || 0;
                    totals.sac += playerData.sac || 0;
                    totals.bb += playerData.bb || 0;
                    totals.rb += playerData.rb || 0;
                } else {
                    playerYears.push({
                        year: year,
                        played: false,
                        data: null
                    });
                }
            });

            const careerAvg = totals.ab > 0 ? (totals.cs / totals.ab).toFixed(3) : '.000';
            const firstYear = playerYears.filter(y => y.played).pop()?.year || '-';
            const lastYear = playerYears.filter(y => y.played)[0]?.year || '-';

            let html = `
                <div class="player-card">
                    <div class="player-card-header">
                        <div>
                            <h2>üë§ ${playerName}</h2>
                            <p style="opacity:.8">${firstYear} - ${lastYear}</p>
                        </div>
                        <div class="stats-summary">
                            <div class="stat">
                                <div class="stat-value">${seasonsPlayed}</div>
                                <div class="stat-label">Saisons</div>
                            </div>
                            <div class="stat">
                                <div class="stat-value">${totals.pj}</div>
                                <div class="stat-label">Parties</div>
                            </div>
                            <div class="stat">
                                <div class="stat-value">${totals.cs}</div>
                                <div class="stat-label">Coups S√ªrs</div>
                            </div>
                            <div class="stat">
                                <div class="stat-value">${careerAvg}</div>
                                <div class="stat-label">Moyenne</div>
                            </div>
                        </div>
                    </div>
                    <div class="player-card-body">
                        <table class="stats-table">
                            <thead>
                                <tr>
                                    <th>Ann√©e</th>
                                    <th>√âQ</th>
                                    <th>Cote</th>
                                    <th>PJ</th>
                                    <th>AB</th>
                                    <th>CS</th>
                                    <th>1B</th>
                                    <th>2B</th>
                                    <th>3B</th>
                                    <th>CC</th>
                                    <th>PC</th>
                                    <th>PP</th>
                                    <th>SAC</th>
                                    <th>BB</th>
                                    <th>RB</th>
                                    <th>MOY</th>
                                    <th>OBP</th>
                                    <th>SLG</th>                </tr>
                            </thead>
                            <tbody>
            `;

            playerYears.forEach(py => {
                if (py.played) {
                    const p = py.data;
                    const moy = p.ab > 0 ? (p.cs / p.ab).toFixed(3) : '.000';
                    const obp = calcOBP(p).toFixed(3);
                    const slg = calcSLG(p).toFixed(3);
                    html += `
                        <tr>
                            <td><strong>${py.year}</strong></td>
                            <td>${p.equipe || '-'}</td>
                            <td>${p.cote || '-'}</td>
                            <td>${p.pj || 0}</td>
                            <td>${p.ab || 0}</td>
                            <td><strong>${p.cs || 0}</strong></td>
                            <td>${p['1b'] || 0}</td>
                            <td>${p['2b'] || 0}</td>
                            <td>${p['3b'] || 0}</td>
                            <td>${p.cc || 0}</td>
                            <td>${p.pc || 0}</td>
                            <td>${p.pp || 0}</td>
                            <td>${p.sac || 0}</td>
                            <td>${p.bb || 0}</td>
                            <td>${p.rb || 0}</td>
                            <td><strong>${moy}</strong></td>
                            <td>${obp}</td>
                            <td>${slg}</td>
                        </tr>
                    `;
                } else {
                    html += `
                        <tr class="not-played">
                            <td>${py.year}</td>
                            <td colspan="17">N'A PAS JOU√â</td>
                        </tr>
                    `;
                }
            });

            // Totals row
            html += `
                        <tr class="totals-row">
                            <td>TOTAL</td>
                            <td>-</td>
                            <td>-</td>
                            <td>${totals.pj}</td>
                            <td>${totals.ab}</td>
                            <td>${totals.cs}</td>
                            <td>${totals.b1}</td>
                            <td>${totals.b2}</td>
                            <td>${totals.b3}</td>
                            <td>${totals.cc}</td>
                            <td>${totals.pc}</td>
                            <td>${totals.pp}</td>
                            <td>${totals.sac}</td>
                            <td>${totals.bb}</td>
                            <td>${totals.rb}</td>
                            <td>${careerAvg}</td>
                            <td>${calcOBP(totals).toFixed(3)}</td>
                            <td>${calcSLG(totals).toFixed(3)}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
            `;

            container.innerHTML = html;

            // Switch to player tab
            switchTab('player', document.querySelectorAll('.tab-btn')[1]);
        }

        function resetView() {
            document.getElementById('yearSelect').value = '';
            document.getElementById('playerSelect').value = '';
            document.getElementById('yearStatsContainer').innerHTML = `
                <p style="text-align:center;padding:3rem;color:#666">
                    <span style="font-size:3rem">üìÖ</span><br><br>
                    S√©lectionnez une ann√©e pour voir les statistiques
                </p>
            `;
            document.getElementById('playerCardContainer').innerHTML = `
                <p style="text-align:center;padding:3rem;color:#666">
                    <span style="font-size:3rem">üë§</span><br><br>
                    S√©lectionnez un joueur pour voir sa fiche compl√®te
                </p>
            `;
            switchTab('year', document.querySelector('.tab-btn'));
        }

        // Initialize
        init();
    </script>

    <footer>
        <div class="footer-grid" style="max-width:1400px;margin:0 auto;display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:2rem">
            <div>
                <div style="display:flex;align-items:center;gap:1rem;margin-bottom:1rem">
                    <img src="logo-lbma.jpg" alt="LBMA" style="height:50px;background:white;padding:5px;border-radius:5px">
                    <div>
                        <div style="font-family:'Bebas Neue',sans-serif;font-size:1.5rem">LBMA</div>
                        <div style="opacity:.7;font-size:.9rem">Depuis 1976</div>
                    </div>
                </div>
                <div class="footer-social" style="margin-top:1rem">
                    <a href="https://www.facebook.com/groups/292aborgnmom" target="_blank" class="social-link">üìò Facebook</a>
                    <a href="https://www.marqueur.com/league/lbma" target="_blank" class="social-link">üìä Marqueur.com</a>
                </div>
            </div>
            <div>
                <h4 style="font-family:'Oswald',sans-serif;color:var(--gold);margin-bottom:1rem">üìä Statistiques 2026</h4>
                <ul style="list-style:none">
                    <li><a href="classement-equipes.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Classement</a></li>
                    <li><a href="stats-frappeurs.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Frappeurs</a></li>
                    <li><a href="stats-lanceurs.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Lanceurs</a></li>
                </ul>
            </div>
            <div>
                <h4 style="font-family:'Oswald',sans-serif;color:var(--gold);margin-bottom:1rem">üìö Archives</h4>
                <ul style="list-style:none">
                    <li><a href="archives-frappeurs.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Stats Frappeurs par Ann√©e</a></li>
                    <li><a href="frappeurs-carriere.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Frappeurs - Carri√®re</a></li>
                    <li><a href="archives-lanceurs.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Stats Lanceurs par Ann√©e</a></li>
                    <li><a href="lanceurs-carriere.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Lanceurs - Carri√®re</a></li>
                    <li><a href="classement-equipes.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Classements Historiques</a></li>
                    <li><a href="temple-renommee.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Temple de la Renomm√©e</a></li>
                </ul>
            </div>
            <div>
                <h4 style="font-family:'Oswald',sans-serif;color:var(--gold);margin-bottom:1rem">‚öæ La Ligue</h4>
                <ul style="list-style:none">
                    <li><a href="equipes.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">√âquipes 2026</a></li>
                    <li><a href="calendrier.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Calendrier</a></li>
                    <li><a href="reglements.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">R√®glements</a></li>
                    <li><a href="contact.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Direction</a></li>
                    <li><a href="liens-utiles.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Liens Utiles</a></li>
                    <li><a href="revue-presse.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">M√©dias & Entrevues</a></li>
                    <li><a href="nous-contacter.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Nous Contacter</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">¬© 2026 Ligue de Balle Molle Amicale (LBMA) - Tous droits r√©serv√©s</div>
    </footer>

    <script>
    /* === MOBILE NAV STANDARD LBMA === */
    (function() {
        var isTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;

        document.querySelectorAll('nav .dropdown > a').forEach(function(a) {
            a.addEventListener('click', function(e) {
                if (isTouch || window.innerWidth <= 768) {
                    e.preventDefault();
                    var parent = this.parentElement;
                    document.querySelectorAll('nav .dropdown').forEach(function(d) {
                        if (d !== parent) d.classList.remove('open');
                    });
                    parent.classList.toggle('open');
                }
            });
        });

        document.addEventListener('click', function(e) {
            if (!e.target.closest('nav')) {
                document.querySelector('nav ul')?.classList.remove('open');
                document.querySelectorAll('nav .dropdown').forEach(function(d) {
                    d.classList.remove('open');
                });
            }
        });
    })();
    </script>
</body></html>
