<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendrier - LBMA</title>
    <link rel="icon" type="image/jpeg" href="logo-lbma.jpg">
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Oswald:wght@400;600;700&family=Work+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{--primary:#1E3A5F;--accent:#CC0000;--gold:#D4AF37;--white:#FDFBF7;--cream:#F5F1E8;--dark:#1A1A1A;
              --aigles:#FF8001;--condors:#0070C0;--ducs:#375623;--faucons:#FF0000;--harfangs:#A6A6A6;--vautours:#FFFF00}
        body{font-family:'Work Sans',sans-serif;background:var(--cream);color:var(--dark)}
        .page-header{margin-top:80px;background:linear-gradient(135deg,var(--primary) 0%,#2D5A8A 100%);color:var(--white);padding:3rem 2rem;text-align:center}
        .page-header h1{font-family:'Bebas Neue',sans-serif;font-size:clamp(2rem,6vw,3.5rem);letter-spacing:.1em}
        .page-header p{font-family:'Oswald',sans-serif;font-size:1.2rem;opacity:.9;margin-top:.5rem}
        .container{max-width:1200px;margin:0 auto;padding:2rem}
        .main-grid{display:grid;grid-template-columns:1fr 340px;gap:2rem;align-items:start}
        .info-box{background:var(--white);border:3px solid var(--dark);padding:1.5rem 2rem;margin-bottom:2rem;text-align:center}
        .info-box h2{font-family:'Bebas Neue',sans-serif;color:var(--primary);font-size:1.8rem;margin-bottom:.75rem}
        .info-box p{font-size:1rem;margin-bottom:.3rem}
        .info-box .highlight{color:var(--accent);font-weight:700;font-size:1.2rem}
        .next-game{background:linear-gradient(135deg,#1a1a1a 0%,#2D5A8A 100%);border:3px solid var(--gold);padding:1.5rem;margin-bottom:2rem;color:var(--white);position:relative;overflow:hidden}
        .next-game::before{content:'PROCHAIN MATCH';position:absolute;top:0;right:0;background:var(--gold);color:var(--dark);padding:.3rem 1rem;font-family:'Oswald',sans-serif;font-size:.75rem;font-weight:700}
        .next-game .ng-date{font-family:'Oswald',sans-serif;font-size:1rem;color:var(--gold);margin-bottom:.5rem}
        .next-game .ng-teams{display:flex;align-items:center;justify-content:center;gap:1rem}
        .next-game .ng-team{font-family:'Bebas Neue',sans-serif;font-size:clamp(1.4rem,4vw,2.2rem);text-align:center}
        .next-game .ng-vs{font-family:'Bebas Neue',sans-serif;font-size:1.5rem;color:var(--accent)}
        .next-game .ng-info{text-align:center;font-size:.85rem;margin-top:.5rem;opacity:.8}
        .filters{display:flex;gap:.75rem;flex-wrap:wrap;margin-bottom:1.5rem;align-items:center}
        .filter-btn{padding:.5rem 1rem;font-family:'Oswald',sans-serif;border:2px solid var(--dark);cursor:pointer;background:var(--white);font-size:.85rem;transition:.3s}
        .filter-btn.active{background:var(--primary);color:white;border-color:var(--primary)}
        .filter-btn:hover{background:var(--cream)}
        .month-section{margin-bottom:2rem}
        .month-title{font-family:'Bebas Neue',sans-serif;font-size:1.6rem;color:var(--primary);padding:.5rem 0;border-bottom:3px solid var(--primary);margin-bottom:1rem}
        .match-card{display:grid;grid-template-columns:30px 55px 1fr auto 1fr 110px 100px 60px 30px;align-items:center;padding:.75rem 1rem;background:var(--white);border:2px solid var(--dark);margin-bottom:.5rem;gap:.5rem;transition:.2s}
        .mc-num{font-family:'Oswald',sans-serif;font-size:.75rem;color:#888;text-align:center}
        .mc-lieu{font-size:.7rem;color:#666;text-align:center;font-family:'Oswald',sans-serif}
        .mc-sheet{text-align:center}
        .mc-sheet a{color:#5BA4E6;text-decoration:none;font-size:1.1rem;transition:.2s;display:inline-block}
        .mc-sheet a:hover{color:var(--primary);transform:scale(1.2)}
        .match-card:hover{box-shadow:0 2px 8px rgba(0,0,0,.1)}
        .match-card.is-next{border-color:var(--gold);border-width:3px;background:linear-gradient(90deg,rgba(212,175,55,.08),var(--white))}
        .match-card.is-final{opacity:.85}
        .mc-date{text-align:center;font-size:.75rem;line-height:1.3}
        .mc-date .day{font-family:'Oswald',sans-serif;font-size:.9rem;font-weight:700;color:var(--primary)}
        .mc-date .time{color:#888}
        .mc-team{font-family:'Oswald',sans-serif;font-size:1rem;font-weight:600;display:flex;align-items:center;gap:.4rem}
        .mc-team.away{justify-content:flex-end;text-align:right}
        .mc-team.home{text-align:left}
        .team-dot{width:10px;height:10px;border-radius:50%;display:inline-block;flex-shrink:0}
        .team-dot.AIGLES{background:var(--aigles)}.team-dot.CONDORS{background:var(--condors)}.team-dot.DUCS{background:var(--ducs)}
        .team-dot.FAUCONS{background:var(--faucons)}.team-dot.HARFANGS{background:var(--harfangs)}.team-dot.VAUTOURS{background:var(--vautours)}
        .mc-center{text-align:center;font-family:'Bebas Neue',sans-serif}
        .mc-center .vs{font-size:1rem;color:#999}
        .mc-center .score{font-size:1.4rem;color:var(--primary)}
        .mc-center .score .winner{color:var(--accent);font-weight:700}
        .mc-status{text-align:center;font-size:.7rem;font-family:'Oswald',sans-serif;text-transform:uppercase}
        .mc-status .badge{padding:.2rem .5rem;border-radius:3px}
        .badge-final{background:var(--primary);color:white}
        .badge-avenir{background:var(--cream);color:var(--dark);border:1px solid #ddd}
        .badge-en_cours{background:var(--accent);color:white;animation:pulse 1.5s infinite}
        .badge-reporte{background:var(--gold);color:var(--dark)}
        .badge-special{display:block;background:var(--gold);color:var(--dark);font-size:.6rem;padding:.1rem .3rem;margin-top:.2rem;border-radius:2px}
        @keyframes pulse{0%,100%{opacity:1}50%{opacity:.6}}
        .sidebar-box{background:var(--white);border:3px solid var(--dark);overflow:hidden;position:sticky;top:100px}
        .sidebar-header{background:var(--primary);color:white;padding:.75rem 1rem;font-family:'Bebas Neue',sans-serif;font-size:1.3rem;text-align:center}
        .standings-mini{width:100%;border-collapse:collapse}
        .standings-mini th{background:var(--cream);padding:.4rem .5rem;font-family:'Oswald',sans-serif;font-size:.7rem;text-transform:uppercase;border-bottom:2px solid var(--dark)}
        .standings-mini td{padding:.4rem .5rem;text-align:center;font-size:.8rem;border-bottom:1px solid var(--cream)}
        .standings-mini td:first-child{text-align:left;font-family:'Oswald',sans-serif;font-weight:600;padding-left:.75rem}
        .standings-mini tr:first-child td{background:rgba(212,175,55,.15)}
        .standings-mini tr:hover{background:rgba(30,58,95,.05)}
        .standings-note{padding:.5rem;text-align:center;font-size:.7rem;color:#888;background:var(--cream)}
        .series-section{background:var(--white);border:3px solid var(--gold);overflow:hidden;margin-top:2rem}
        .series-header{background:linear-gradient(135deg,var(--dark),#2D5A8A);color:var(--gold);padding:1rem;text-align:center;font-family:'Bebas Neue',sans-serif;font-size:1.5rem}
        .series-content{padding:1rem}
        .series-round{margin-bottom:1rem}
        .series-round-title{font-family:'Oswald',sans-serif;color:var(--primary);font-size:1rem;font-weight:700;padding:.3rem 0;border-bottom:2px solid var(--cream);margin-bottom:.5rem}
        .loading{text-align:center;padding:3rem;color:#888;font-family:'Oswald',sans-serif;font-size:1.2rem}
        .no-data{text-align:center;padding:2rem;color:#888}
        @media(max-width:900px){
            .main-grid{grid-template-columns:1fr}
            .sidebar-box{position:static}
            .match-card{grid-template-columns:25px 50px 1fr auto 1fr 80px 70px 50px 25px;font-size:.85rem}
        }
        @media(max-width:600px){
            .match-card{grid-template-columns:1fr;text-align:center;gap:.3rem;padding:.5rem}
            .mc-team.away,.mc-team.home{justify-content:center;text-align:center}
            .next-game .ng-teams{flex-direction:column;gap:.3rem}
        }

        /* Bouton Imprimer */
        .print-btn{display:inline-flex;align-items:center;gap:.5rem;padding:.6rem 1.5rem;font-family:'Oswald',sans-serif;font-size:.95rem;background:var(--primary);color:white;border:2px solid var(--dark);cursor:pointer;transition:.3s;text-transform:uppercase}
        .print-btn:hover{background:var(--gold);color:var(--dark)}

        /* Bouton export agenda global */
        .export-all-btn{display:inline-flex;align-items:center;gap:.5rem;padding:.6rem 1.5rem;font-family:'Oswald',sans-serif;font-size:.95rem;background:var(--accent);color:white;border:2px solid var(--dark);cursor:pointer;transition:.3s;text-transform:uppercase;text-decoration:none}
        .export-all-btn:hover{background:var(--gold);color:var(--dark)}

        /* Popup export par √©quipe */
        .team-export-popup{display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:var(--white);border:3px solid var(--dark);padding:1.5rem;z-index:2000;min-width:320px;max-width:400px;box-shadow:0 8px 32px rgba(0,0,0,.3)}
        .team-export-popup h3{font-family:'Bebas Neue',sans-serif;color:var(--primary);font-size:1.5rem;margin-bottom:.25rem}
        .team-export-popup p{font-size:.85rem;color:#666;margin-bottom:1rem}
        .team-export-grid{display:grid;grid-template-columns:1fr 1fr;gap:.5rem}
        .team-export-btn{display:flex;align-items:center;gap:.6rem;padding:.7rem .9rem;border:3px solid var(--dark);font-family:'Oswald',sans-serif;font-size:.9rem;font-weight:700;cursor:pointer;transition:.2s;color:var(--dark);background:var(--white)}
        .team-export-btn:hover{transform:scale(1.03);box-shadow:0 3px 10px rgba(0,0,0,.2)}
        .team-export-btn .tdot{width:14px;height:14px;border-radius:50%;flex-shrink:0}
        .team-export-popup-close{position:absolute;top:.5rem;right:.75rem;font-size:1.2rem;cursor:pointer;opacity:.5;background:none;border:none;font-family:'Oswald',sans-serif}
        .team-export-popup-close:hover{opacity:1}

        /* Boutons agenda par match */
        .mc-agenda{display:flex;gap:.25rem;align-items:center;justify-content:center}
        .agenda-btn{display:inline-flex;align-items:center;justify-content:center;width:24px;height:24px;border-radius:4px;font-size:.75rem;text-decoration:none;border:none;cursor:pointer;transition:.2s;opacity:.85}
        .agenda-btn:hover{opacity:1;transform:scale(1.15)}
        .agenda-btn.google{background:#4285F4;color:white}
        .agenda-btn.outlook{background:#0078D4;color:white}
        .agenda-btn.ics{background:#6c757d;color:white}
        .agenda-btn title{display:none}

        /* Popup agenda */
        .agenda-popup{display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:var(--white);border:3px solid var(--dark);padding:1.5rem;z-index:2000;min-width:280px;max-width:340px;box-shadow:0 8px 32px rgba(0,0,0,.3)}
        .agenda-popup h3{font-family:'Bebas Neue',sans-serif;color:var(--primary);font-size:1.4rem;margin-bottom:.25rem}
        .agenda-popup p{font-size:.85rem;color:#666;margin-bottom:1rem}
        .agenda-popup-btns{display:flex;flex-direction:column;gap:.5rem}
        .agenda-popup-btn{display:flex;align-items:center;gap:.75rem;padding:.75rem 1rem;border:2px solid var(--dark);text-decoration:none;font-family:'Oswald',sans-serif;font-size:.95rem;color:var(--dark);transition:.2s;cursor:pointer;background:var(--cream)}
        .agenda-popup-btn:hover{background:var(--primary);color:white;border-color:var(--primary)}
        .agenda-popup-btn .icon{font-size:1.2rem;width:24px;text-align:center}
        .agenda-overlay{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.5);z-index:1999}
        .agenda-popup-close{position:absolute;top:.5rem;right:.75rem;font-size:1.2rem;cursor:pointer;opacity:.5;background:none;border:none;font-family:'Oswald',sans-serif}
        .agenda-popup-close:hover{opacity:1}

        /* === STYLES IMPRESSION PDF === */
        @media print{
            *{-webkit-print-color-adjust:exact!important;print-color-adjust:exact!important;color-adjust:exact!important}
            nav,.hamburger,footer,.filters,.print-btn,.export-all-btn,#nextGameBanner,.mc-sheet,.mc-agenda,.agenda-popup,.agenda-overlay,.info-box,.sidebar-box,.series-section,.no-print{display:none!important}
            body{background:white!important;font-size:9pt}
            .page-header{margin-top:0!important;padding:1rem!important;background:var(--primary)!important}
            .page-header h1{font-size:1.5rem!important}
            .page-header p{font-size:.9rem!important}
            .container{padding:.5rem!important;max-width:100%!important}
            .main-grid{display:block!important}
            .month-title{font-size:1.1rem!important;margin-top:.5rem!important;margin-bottom:.3rem!important;padding:.2rem 0!important;border-bottom:2px solid var(--primary)!important}
            .match-card{grid-template-columns:25px 50px 1fr auto 1fr 80px 70px!important;padding:.3rem .5rem!important;margin-bottom:.2rem!important;border-width:1px!important;page-break-inside:avoid}
            .match-card.is-next{border-color:var(--gold)!important;border-width:2px!important}
            .mc-team{font-size:.8rem!important}
            .mc-date .day{font-size:.75rem!important}
            .mc-date .time{font-size:.65rem!important}
            .mc-num{font-size:.65rem!important}
            .mc-lieu{font-size:.6rem!important}
            .mc-status .badge{font-size:.6rem!important;padding:.1rem .3rem!important}
            .mc-center .score,.mc-center .vs{font-size:.9rem!important}
            .month-section{page-break-inside:avoid}
            @page{size:letter portrait;margin:1cm}
        }


            /* === NAV STANDARD LBMA === */
        nav{position:fixed;top:0;left:0;right:0;z-index:1000;background:var(--white);box-shadow:0 2px 20px rgba(0,0,0,.1)}
        nav .nav-container{max-width:1400px;margin:0 auto;padding:.75rem 2rem;display:flex;justify-content:space-between;align-items:center}
        .logo{display:flex;align-items:center;gap:.75rem;text-decoration:none}
        .logo img{height:55px}
        nav ul{display:flex;list-style:none;gap:.5rem}
        nav li{position:relative}
        nav a{text-decoration:none;color:var(--dark);font-weight:600;text-transform:uppercase;font-size:.85rem;padding:.5rem 1rem;display:block;transition:.3s}
        nav a:hover{color:var(--primary);background:var(--cream)}
        .dropdown-content{display:none;position:absolute;top:100%;left:0;background:var(--white);min-width:220px;box-shadow:0 8px 16px rgba(0,0,0,.1);border:2px solid var(--dark);z-index:1001}
        .dropdown-content a{padding:.75rem 1rem;border-bottom:1px solid var(--cream);font-size:.8rem}
        .dropdown:hover .dropdown-content{display:block}
        .dropdown>a::after{content:' \25BC';font-size:.6rem}
        .hamburger{display:none;font-size:2rem;cursor:pointer;padding:.5rem;color:var(--dark)}
        /* === FOOTER STANDARD LBMA === */
        footer{background:var(--dark);color:var(--white);padding:3rem 2rem}
        .footer-social{display:flex;gap:.5rem;flex-wrap:wrap}
        .social-link{display:inline-flex;align-items:center;gap:.5rem;background:rgba(255,255,255,.1);padding:.6rem 1.2rem;border-radius:5px;color:white;text-decoration:none;transition:.3s}
        .social-link:hover{background:var(--gold);color:var(--dark)}
        .footer-bottom{max-width:1400px;margin:1.5rem auto 0;padding-top:1.5rem;border-top:1px solid rgba(255,255,255,.2);text-align:center;opacity:.7;font-size:.85rem}
        .dropdown.open .dropdown-content{display:block!important}
        @media(max-width:768px){
            .hamburger{display:block}
            nav ul{display:none;position:absolute;top:100%;left:0;right:0;background:var(--white);flex-direction:column;padding:1rem;box-shadow:0 8px 16px rgba(0,0,0,.1)}
            nav ul.open{display:flex}
            .dropdown-content{position:static;box-shadow:none;border:none;border-left:3px solid var(--primary);margin-left:1rem}
            .dropdown:hover .dropdown-content{display:none}
            .dropdown.open .dropdown-content{display:block}
        }
    </style>
</head>
<body>
    <nav>
        <div class="nav-container">
            <a href="index.html" class="logo"><img src="logo-lbma.jpg" alt="LBMA"></a>
            <div class="hamburger" onclick="document.querySelector('nav ul').classList.toggle('open')">&#9776;</div>
            <ul>
                <li><a href="index.html">Accueil</a></li>
                <li><a href="equipes.html">√âquipes</a></li>
                <li><a href="joueurs.html">Joueurs</a></li>
                <li><a href="calendrier.html" style="color:var(--primary);font-weight:700">Calendrier</a></li>
                <li class="dropdown">
                    <a href="#">Statistiques</a>
                    <div class="dropdown-content">
                        <a href="classement-equipes.html">üèÜ Classement</a>
                        <a href="stats-frappeurs.html">‚öæ Frappeurs</a>
                        <a href="stats-lanceurs.html">üéØ Lanceurs</a>
                        <a href="stats-series.html">üèÜ S√©ries √âliminatoires</a>
                    </div>
                </li>
                <li class="dropdown">
                    <a href="#">Archives</a>
                    <div class="dropdown-content">
                        <a href="archives-frappeurs.html">üìä Stats Frappeurs par Ann√©e</a>
                        <a href="frappeurs-carriere.html">‚≠ê Frappeurs - Carri√®re</a>
                        <a href="frappeurs-records.html">üèÜ Frappeurs - Records</a>
                        <a href="archives-lanceurs.html">üìä Stats Lanceurs par Ann√©e</a>
                        <a href="lanceurs-carriere.html">‚≠ê Lanceurs - Carri√®re</a>
                        <a href="lanceurs-records.html">üèÜ Lanceurs - Records</a>
                        <a href="classement-equipes.html">üìà Classements Historiques</a>
                        <a href="temple-renommee.html">üèõÔ∏è Temple de la Renomm√©e</a>
                        <a href="archives.html">üìö Archives Compl√®tes</a>
                    </div>
                </li>
                <li><a href="contact.html">Direction</a></li>
                <li><a href="admin.html" style="color:var(--accent)">Admin</a></li>
            </ul>
        </div>
    </nav>

    <div class="page-header">
        <h1>&#128197; CALENDRIER 2026</h1>
        <p>51e saison de la LBMA</p>
    </div>

    <div class="container">
        <div class="info-box">
            <h2>&#127967; Informations de la Saison</h2>
            <p><strong>Terrains :</strong> Jarry 1, Auteuil</p>
            <p><strong>Matchs :</strong> Vendredi soir et samedi matin + jours f&eacute;ri&eacute;s</p>
            <p class="highlight">&#127881; Rep&ecirc;chage : 18 avril 2026 au Cerf Blanc</p>
        </div>

        <div id="nextGameBanner" style="display:none"></div>

        <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem;margin-bottom:1rem">
            <div class="filters" style="margin-bottom:0;flex:1">
                <span style="font-family:'Oswald',sans-serif;font-size:.9rem;color:var(--primary)">Filtrer :</span>
                <button class="filter-btn active" onclick="filterMonth('',this)">Tous</button>
                <button class="filter-btn" onclick="filterMonth('04',this)">Avril</button>
                <button class="filter-btn" onclick="filterMonth('05',this)">Mai</button>
                <button class="filter-btn" onclick="filterMonth('06',this)">Juin</button>
                <button class="filter-btn" onclick="filterMonth('07',this)">Juillet</button>
                <button class="filter-btn" onclick="filterMonth('08',this)">Ao&ucirc;t</button>
                <button class="filter-btn" onclick="filterMonth('09',this)">Sept</button>
            </div>
            <button class="print-btn" onclick="window.print()">üñ®Ô∏è Imprimer PDF</button>
            <button class="export-all-btn" onclick="exportAllIcs()">üìÖ Tout exporter</button>
            <button class="export-all-btn" style="background:var(--primary)" onclick="openTeamExportPopup()">‚öæ Exporter par √©quipe</button>
        </div>

        <div class="main-grid">
            <div>
                <div id="matchesContainer"><div class="loading">&#9918; Chargement du calendrier...</div></div>
                <div id="seriesContainer" style="display:none">
                    <div class="series-section">
                        <div class="series-header">&#127942; S&Eacute;RIES &Eacute;LIMINATOIRES 2026</div>
                        <div class="series-content" id="seriesContent"></div>
                    </div>
                </div>
            </div>
            <div>
                <div class="sidebar-box">
                    <div class="sidebar-header">&#128202; CLASSEMENT 2026</div>
                    <table class="standings-mini">
                        <thead>
                            <tr><th>&Eacute;quipe</th><th>PJ</th><th>V</th><th>D</th><th>N</th><th>PP</th><th>PC</th><th>PTS</th></tr>
                        </thead>
                        <tbody id="standingsBody">
                            <tr><td colspan="8" style="text-align:center;padding:1rem;color:#888">Chargement...</td></tr>
                        </tbody>
                    </table>
                    <div class="standings-note">V=2pts | N=1pt | Calcul&eacute; automatiquement</div>
                </div>
            </div>
        </div>

        <div class="info-box" style="margin-top:2rem">
            <h2>&#128202; Saison 2025 &mdash; R&eacute;sum&eacute;</h2>
            <p><span style="font-family:'Bebas Neue',sans-serif;font-size:1.8rem;color:var(--gold)">&#127942; CHAMPIONS 2025 : VAUTOURS &#127942;</span></p>
            <p style="color:#666;margin-top:.5rem">La saison 2025 s'est termin&eacute;e avec la victoire des Vautours en s&eacute;ries &eacute;liminatoires.<br>Un grand party du 50e anniversaire a r&eacute;uni plus de 170 personnes!</p>
        </div>
    </div>

    <!-- POPUP EXPORT PAR √âQUIPE -->
    <div class="agenda-overlay" id="teamExportOverlay" onclick="closeTeamExportPopup()"></div>
    <div class="team-export-popup" id="teamExportPopup">
        <button class="team-export-popup-close" onclick="closeTeamExportPopup()">‚úï</button>
        <h3>‚öæ Exporter mon √©quipe</h3>
        <p>Choisissez votre √©quipe pour t√©l√©charger un fichier .ics avec tous vos matchs √† venir.</p>
        <div class="team-export-grid" id="teamExportGrid"></div>
    </div>

    <!-- OVERLAY + POPUP AGENDA -->
    <div class="agenda-overlay" id="agendaOverlay" onclick="closeAgendaPopup()"></div>
    <div class="agenda-popup" id="agendaPopup">
        <button class="agenda-popup-close" onclick="closeAgendaPopup()">‚úï</button>
        <h3>üìÖ Ajouter √† mon agenda</h3>
        <p id="agendaMatchTitle" style="font-family:'Oswald',sans-serif;color:var(--primary);font-size:1rem;margin-bottom:.5rem"></p>
        <p id="agendaMatchInfo"></p>
        <div class="agenda-popup-btns">
            <a id="agendaGoogleBtn" href="#" target="_blank" class="agenda-popup-btn">
                <span class="icon">üóìÔ∏è</span> Google Calendar
            </a>
            <a id="agendaOutlookBtn" href="#" target="_blank" class="agenda-popup-btn">
                <span class="icon">üìò</span> Outlook Calendar
            </a>
            <a id="agendaIcsBtn" href="#" class="agenda-popup-btn" onclick="downloadIcsSingle(event)">
                <span class="icon">üì•</span> T√©l√©charger .ics (universel)
            </a>
        </div>
    </div>

    <footer>
        <div class="footer-grid" style="max-width:1400px;margin:0 auto;display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:2rem">
            <div>
                <div style="display:flex;align-items:center;gap:1rem;margin-bottom:1rem">
                    <img src="logo-lbma.jpg" alt="LBMA" style="height:50px;background:white;padding:5px;border-radius:5px">
                    <div>
                        <div style="font-family:'Bebas Neue',sans-serif;font-size:1.5rem">LBMA</div>
                        <div style="opacity:.7;font-size:.9rem">Depuis 1976</div>
                    </div>
                </div>
                <div class="footer-social" style="margin-top:1rem">
                    <a href="https://www.facebook.com/groups/2400013274" target="_blank" class="social-link">üìò Facebook</a>
                    <a href="https://www.marqueur.com/baseball/mbr/tools/blg/index.php?nyx=1154" target="_blank" class="social-link">üìä Marqueur.com</a>
                </div>
            </div>
            <div>
                <h4 style="font-family:'Oswald',sans-serif;color:var(--gold);margin-bottom:1rem">üìä Statistiques 2026</h4>
                <ul style="list-style:none">
                    <li><a href="classement-equipes.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Classement</a></li>
                    <li><a href="stats-frappeurs.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Frappeurs</a></li>
                    <li><a href="stats-lanceurs.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Lanceurs</a></li>
                </ul>
            </div>
            <div>
                <h4 style="font-family:'Oswald',sans-serif;color:var(--gold);margin-bottom:1rem">üìö Archives</h4>
                <ul style="list-style:none">
                    <li><a href="archives-frappeurs.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Stats Frappeurs par Ann√©e</a></li>
                    <li><a href="frappeurs-carriere.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Frappeurs - Carri√®re</a></li>
                    <li><a href="archives-lanceurs.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Stats Lanceurs par Ann√©e</a></li>
                    <li><a href="lanceurs-carriere.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Lanceurs - Carri√®re</a></li>
                    <li><a href="classement-equipes.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Classements Historiques</a></li>
                    <li><a href="temple-renommee.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Temple de la Renomm√©e</a></li>
                </ul>
            </div>
            <div>
                <h4 style="font-family:'Oswald',sans-serif;color:var(--gold);margin-bottom:1rem">‚öæ La Ligue</h4>
                <ul style="list-style:none">
                    <li><a href="equipes.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">√âquipes 2026</a></li>
                    <li><a href="calendrier.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Calendrier</a></li>
                    <li><a href="reglements.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">R√®glements</a></li>
                    <li><a href="contact.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Direction</a></li>
                    <li><a href="liens-utiles.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Liens Utiles</a></li>
                    <li><a href="revue-presse.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">M√©dias & Entrevues</a></li>
                    <li><a href="nous-contacter.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Nous Contacter</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">¬© 2026 Ligue de Balle Molle Amicale (LBMA) - Tous droits r√©serv√©s</div>
    </footer>

    <script>
        const SB_URL = 'https://xgyskiatppgaeaamjhxr.supabase.co';
        const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhneXNraWF0cHBnYWVhYW1qaHhyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA0OTgxNTQsImV4cCI6MjA4NjA3NDE1NH0.67KCcUWlJij-scDoCUvZpkiCle5-mHVmy-inRk96Tac';
        const SAISON = 2026;
        const EQUIPES = ['AIGLES','CONDORS','DUCS','FAUCONS','HARFANGS','VAUTOURS'];
        const TEAM_NAMES = {AIGLES:'Aigles',CONDORS:'Condors',DUCS:'Ducs',FAUCONS:'Faucons',HARFANGS:'Harfangs',VAUTOURS:'Vautours'};
        const MOIS_NOMS = {'04':'Avril','05':'Mai','06':'Juin','07':'Juillet','08':'Ao\u00fbt','09':'Septembre'};
        const JOURS_FR = {LUNDI:'Lun',MARDI:'Mar',MERCREDI:'Mer',JEUDI:'Jeu',VENDREDI:'Ven',SAMEDI:'Sam',DIMANCHE:'Dim'};

        let allGames = [];
        let allSeries = [];
        let currentFilter = '';

        async function sbFetch(path) {
            const res = await fetch(SB_URL + '/rest/v1/' + path, {
                headers: { 'apikey': SB_KEY, 'Authorization': 'Bearer ' + SB_KEY, 'Range': '0-999' }
            });
            return res.ok ? res.json() : [];
        }

        function heureToMinutes(h) {
            if (!h) return 0;
            var s = h.toUpperCase().replace('H',':').replace('h',':');
            var parts = s.split(':');
            return parseInt(parts[0]||0) * 60 + parseInt(parts[1]||0);
        }

        async function init() {
            try {
                allGames = await sbFetch('matchs_regulier?saison=eq.' + SAISON + '&order=date.asc,heure.asc');
                allSeries = await sbFetch('matchs_series?saison=eq.' + SAISON + '&order=date.asc,heure.asc');
            } catch(e) { allGames = []; allSeries = []; }
            // Tri correct par date puis heure (convertie en minutes)
            allGames.sort(function(a,b) {
                var dc = a.date.localeCompare(b.date);
                if (dc !== 0) return dc;
                return heureToMinutes(a.heure) - heureToMinutes(b.heure);
            });
            // Num√©roter les matchs de 1 √† 75
            allGames.forEach(function(g, i) { g._numero = i + 1; });
            renderNextGame();
            renderMatches();
            renderStandings();
            renderSeriesSection();
        }

        function renderNextGame() {
            var today = new Date().toISOString().split('T')[0];
            var upcoming = allGames.filter(function(g) { return g.date >= today && g.status === 'avenir'; });
            var banner = document.getElementById('nextGameBanner');
            if (upcoming.length === 0) { banner.style.display = 'none'; return; }
            var next = upcoming[0];
            var dateObj = new Date(next.date + 'T12:00:00');
            var opts = { weekday: 'long', day: 'numeric', month: 'long' };
            var dateStr = dateObj.toLocaleDateString('fr-CA', opts);
            dateStr = dateStr.charAt(0).toUpperCase() + dateStr.slice(1);
            banner.style.display = 'block';
            banner.innerHTML =
                '<div class="next-game">' +
                '<div class="ng-date">\ud83d\udcc5 ' + dateStr + ' \u2014 ' + next.heure + '</div>' +
                '<div class="ng-teams">' +
                '<div class="ng-team"><span class="team-dot ' + next.visiteur + '"></span> ' + (TEAM_NAMES[next.visiteur] || next.visiteur) + '</div>' +
                '<div class="ng-vs">VS</div>' +
                '<div class="ng-team">' + (TEAM_NAMES[next.local] || next.local) + ' <span class="team-dot ' + next.local + '"></span></div>' +
                '</div>' +
                '<div class="ng-info">\ud83d\udccd ' + next.endroit + (next.special ? ' \u2014 \ud83c\udf89 ' + next.special : '') + '</div>' +
                '</div>';
        }

        function filterMonth(m, el) {
            currentFilter = m;
            document.querySelectorAll('.filter-btn').forEach(function(b) { b.classList.remove('active'); });
            if (el) el.classList.add('active');
            renderMatches();
        }

        function renderMatches() {
            var container = document.getElementById('matchesContainer');
            var games = allGames.slice();
            if (currentFilter) games = games.filter(function(g) { return g.date.split('-')[1] === currentFilter; });

            if (games.length === 0) {
                container.innerHTML = '<div class="no-data">Aucune partie planifi\u00e9e' + (currentFilter ? ' pour ce mois' : '') + '. Le calendrier sera disponible apr\u00e8s le rep\u00eachage.</div>';
                return;
            }

            var today = new Date().toISOString().split('T')[0];
            var nextGame = allGames.find(function(g) { return g.date >= today && g.status === 'avenir'; });
            var nextId = nextGame ? nextGame.id : null;

            var months = {};
            games.forEach(function(g) {
                var m = g.date.split('-')[1];
                if (!months[m]) months[m] = [];
                months[m].push(g);
            });

            var html = '';
            Object.keys(months).sort().forEach(function(m) {
                html += '<div class="month-section">';
                html += '<div class="month-title">' + (MOIS_NOMS[m] || m) + '</div>';
                months[m].forEach(function(g) {
                    var isNext = g.id === nextId;
                    var isFinal = g.status === 'final';
                    var dateObj = new Date(g.date + 'T12:00:00');
                    var dayNum = dateObj.getDate();
                    var jourAbbr = JOURS_FR[g.jour] || (g.jour ? g.jour.substring(0, 3) : '');

                    var centerHtml;
                    if (isFinal && g.score_visiteur !== null && g.score_local !== null) {
                        var vWin = g.score_visiteur > g.score_local;
                        var lWin = g.score_local > g.score_visiteur;
                        centerHtml = '<div class="score"><span class="' + (vWin ? 'winner' : '') + '">' + g.score_visiteur + '</span> - <span class="' + (lWin ? 'winner' : '') + '">' + g.score_local + '</span></div>';
                    } else if (g.status === 'en_cours') {
                        centerHtml = '<div class="score" style="color:var(--accent)">EN COURS</div>';
                    } else {
                        centerHtml = '<div class="vs">VS</div>';
                    }

                    var badgeClass = 'badge-avenir', badgeText = '\u00c0 venir';
                    if (g.status === 'final') { badgeClass = 'badge-final'; badgeText = 'Final'; }
                    else if (g.status === 'en_cours') { badgeClass = 'badge-en_cours'; badgeText = '\u26be Live'; }
                    else if (g.status === 'reporte') { badgeClass = 'badge-reporte'; badgeText = 'Report\u00e9'; }
                    else if (g.status === 'annule') { badgeClass = 'badge-reporte'; badgeText = 'Annul\u00e9'; }

                    html += '<div class="match-card' + (isNext ? ' is-next' : '') + (isFinal ? ' is-final' : '') + '">' +
                        '<div class="mc-num">' + g._numero + '</div>' +
                        '<div class="mc-date"><div class="day">' + jourAbbr + ' ' + dayNum + '</div><div class="time">' + g.heure + '</div></div>' +
                        '<div class="mc-team away">' + (TEAM_NAMES[g.visiteur] || g.visiteur) + ' <span class="team-dot ' + g.visiteur + '"></span></div>' +
                        '<div class="mc-center">' + centerHtml + '</div>' +
                        '<div class="mc-team home"><span class="team-dot ' + g.local + '"></span> ' + (TEAM_NAMES[g.local] || g.local) + '</div>' +
                        '<div class="mc-lieu">' + (g.endroit || '') + '</div>' +
                        '<div class="mc-status"><span class="badge ' + badgeClass + '">' + badgeText + '</span>' +
                        (g.special ? '<span class="badge-special">' + g.special + '</span>' : '') +
                        '</div>' +
                        '<div class="mc-sheet"><a href="pointage.html?id=' + g.id + '" title="Feuille de pointage" onclick="return goPointage(this,'+g.id+')">üìã</a></div>' +
                        '<div class="mc-agenda"><button class="agenda-btn google" onclick="openAgendaPopup(' + g.id + ')" title="Ajouter √† l\'agenda">üìÖ</button></div>' +
                        '</div>';
                });
                html += '</div>';
            });

            container.innerHTML = html;
        }

        function renderStandings() {
            var stats = {};
            EQUIPES.forEach(function(eq) { stats[eq] = { pj:0, v:0, d:0, n:0, pp:0, pc:0 }; });

            allGames.filter(function(g) {
                return g.status === 'final' && g.score_visiteur !== null && g.score_local !== null;
            }).forEach(function(g) {
                var sv = g.score_visiteur, sl = g.score_local;
                var vis = g.visiteur, loc = g.local;
                if (!stats[vis] || !stats[loc]) return;
                stats[vis].pj++; stats[loc].pj++;
                stats[vis].pp += sv; stats[vis].pc += sl;
                stats[loc].pp += sl; stats[loc].pc += sv;
                if (sv > sl) { stats[vis].v++; stats[loc].d++; }
                else if (sl > sv) { stats[loc].v++; stats[vis].d++; }
                else { stats[vis].n++; stats[loc].n++; }
            });

            var sorted = EQUIPES.map(function(eq) {
                return { eq: eq, pj: stats[eq].pj, v: stats[eq].v, d: stats[eq].d, n: stats[eq].n, pp: stats[eq].pp, pc: stats[eq].pc, pts: stats[eq].v * 2 + stats[eq].n };
            }).sort(function(a, b) {
                return b.pts - a.pts || b.v - a.v || (b.pp - b.pc) - (a.pp - a.pc);
            });

            var body = document.getElementById('standingsBody');
            if (sorted.every(function(s) { return s.pj === 0; })) {
                body.innerHTML = '<tr><td colspan="8" style="text-align:center;padding:1rem;color:#888">Aucun match compl\u00e9t\u00e9</td></tr>';
                return;
            }
            body.innerHTML = sorted.map(function(s) {
                return '<tr>' +
                    '<td><span class="team-dot ' + s.eq + '" style="width:8px;height:8px;margin-right:4px;vertical-align:middle"></span>' + TEAM_NAMES[s.eq] + '</td>' +
                    '<td>' + s.pj + '</td><td>' + s.v + '</td><td>' + s.d + '</td><td>' + s.n + '</td>' +
                    '<td>' + s.pp + '</td><td>' + s.pc + '</td><td><strong>' + s.pts + '</strong></td>' +
                    '</tr>';
            }).join('');
        }

        function renderSeriesSection() {
            if (allSeries.length === 0) {
                document.getElementById('seriesContainer').style.display = 'none';
                return;
            }
            document.getElementById('seriesContainer').style.display = 'block';

            // Group by ronde then serie_id
            var order = ['QUART-DE-FINALE', 'DEMI-FINALE', 'FINALE'];
            var rondeNames = {'QUART-DE-FINALE':'Quart-de-finale (2 de 3)','DEMI-FINALE':'Demi-finale (2 de 3)','FINALE':'Grande Finale (3 de 5)'};
            var byRonde = {};
            allSeries.forEach(function(g) {
                if (!byRonde[g.ronde]) byRonde[g.ronde] = {};
                var sid = g.serie_id || 'AUTRE';
                if (!byRonde[g.ronde][sid]) byRonde[g.ronde][sid] = [];
                byRonde[g.ronde][sid].push(g);
            });

            var html = '';
            order.forEach(function(r) {
                if (!byRonde[r]) return;
                var winsNeeded = r === 'FINALE' ? 3 : 2;
                html += '<div class="series-round"><div class="series-round-title">' + (rondeNames[r]||r) + '</div>';

                Object.keys(byRonde[r]).sort().forEach(function(sid) {
                    var games = byRonde[r][sid];
                    games.sort(function(a,b){ return a.date.localeCompare(b.date) || (a.heure||'').localeCompare(b.heure||''); });

                    // Compute series score
                    var g1 = games.find(function(g){return g.no_match===1;}) || games[0];
                    var teamA = g1.visiteur, teamB = g1.local;
                    var wA=0, wB=0;
                    games.filter(function(g){return g.status==='final' && g.score_visiteur!==null;}).forEach(function(g){
                        if(g.score_visiteur>g.score_local){ if(g.visiteur===teamA) wA++; else wB++; }
                        else if(g.score_local>g.score_visiteur){ if(g.local===teamA) wA++; else wB++; }
                    });
                    var winner = wA>=winsNeeded ? teamA : (wB>=winsNeeded ? teamB : null);

                    html += '<div style="background:' + (winner ? 'rgba(76,175,80,.08)' : 'rgba(212,175,55,.05)') + ';border:1px solid ' + (winner ? '#4CAF50' : 'var(--gold)') + ';border-radius:4px;padding:.5rem .75rem;margin-bottom:.75rem">';
                    html += '<div style="font-family:Oswald,sans-serif;font-size:.85rem;color:var(--primary);margin-bottom:.4rem">' + sid + ' \u2014 <span class="team-dot ' + teamA + '"></span> ' + (TEAM_NAMES[teamA]||teamA) + ' <strong>' + wA + '</strong> - <strong>' + wB + '</strong> ' + (TEAM_NAMES[teamB]||teamB) + ' <span class="team-dot ' + teamB + '"></span>';
                    if(winner) html += ' <span style="color:#4CAF50;font-weight:700">\u2714 ' + (TEAM_NAMES[winner]||winner) + '</span>';
                    html += '</div>';

                    games.forEach(function(g) {
                        var isFinal = g.status === 'final';
                        var centerHtml;
                        if (isFinal && g.score_visiteur !== null) {
                            var vWin = g.score_visiteur > g.score_local;
                            var lWin = g.score_local > g.score_visiteur;
                            centerHtml = '<div class="score"><span class="' + (vWin?'winner':'') + '">' + g.score_visiteur + '</span> - <span class="' + (lWin?'winner':'') + '">' + g.score_local + '</span></div>';
                        } else {
                            centerHtml = '<div class="vs">VS</div>';
                        }
                        var dateObj = new Date(g.date + 'T12:00:00');
                        var badgeClass = isFinal ? 'badge-final' : (g.status==='reporte' ? 'badge-reporte' : 'badge-avenir');
                        var badgeText = isFinal ? 'Final' : (g.status==='reporte' ? 'Report\u00e9' : '\u00c0 venir');

                        html += '<div class="match-card' + (isFinal ? ' is-final' : '') + '" style="margin-bottom:.3rem">' +
                            '<div class="mc-date"><div class="day">M' + g.no_match + '</div><div class="time">' + g.heure + '</div></div>' +
                            '<div class="mc-team away">' + (TEAM_NAMES[g.visiteur]||g.visiteur) + ' <span class="team-dot ' + g.visiteur + '"></span></div>' +
                            '<div class="mc-center">' + centerHtml + '</div>' +
                            '<div class="mc-team home"><span class="team-dot ' + g.local + '"></span> ' + (TEAM_NAMES[g.local]||g.local) + '</div>' +
                            '<div class="mc-status"><span class="badge ' + badgeClass + '">' + badgeText + '</span></div></div>';
                    });
                    html += '</div>';
                });
                html += '</div>';
            });

            document.getElementById('seriesContent').innerHTML = html;
        }

        init();

        /* ==========================================
           FONCTIONS AGENDA
        ========================================== */

        var _agendaGame = null; // Match courant pour le popup

        function formatIcsDate(dateStr, heureStr, durationMin) {
            // dateStr: "2026-05-01", heureStr: "19h00" ou "19:00"
            var h = (heureStr || '12:00').toUpperCase().replace('H',':');
            var parts = h.split(':');
            var hh = parseInt(parts[0] || 12);
            var mm = parseInt(parts[1] || 0);
            var d = new Date(dateStr + 'T00:00:00');
            // Format: YYYYMMDDTHHmmss (local, pas UTC pour √©viter d√©calage)
            function pad(n){ return String(n).padStart(2,'0'); }
            var start = d.getFullYear() + pad(d.getMonth()+1) + pad(d.getDate()) + 'T' + pad(hh) + pad(mm) + '00';
            // Fin = start + durationMin
            var endMs = new Date(dateStr + 'T' + pad(hh) + ':' + pad(mm) + ':00').getTime() + (durationMin||90)*60000;
            var endD = new Date(endMs);
            var end = endD.getFullYear() + pad(endD.getMonth()+1) + pad(endD.getDate()) + 'T' + pad(endD.getHours()) + pad(endD.getMinutes()) + '00';
            return { start: start, end: end };
        }

        function makeGoogleUrl(g) {
            var dates = formatIcsDate(g.date, g.heure, 90);
            var title = encodeURIComponent('‚öæ LBMA ‚Äî ' + (TEAM_NAMES[g.visiteur]||g.visiteur) + ' @ ' + (TEAM_NAMES[g.local]||g.local));
            var details = encodeURIComponent('Match #' + g._numero + ' ‚Äî Saison LBMA 2026\nTerrain: ' + (g.endroit||'√Ä confirmer') + (g.special ? '\nüéâ ' + g.special : ''));
            var location = encodeURIComponent(g.endroit || 'Montr√©al, QC');
            return 'https://calendar.google.com/calendar/render?action=TEMPLATE&text=' + title +
                '&dates=' + dates.start + '/' + dates.end +
                '&details=' + details + '&location=' + location;
        }

        function makeOutlookUrl(g) {
            var dates = formatIcsDate(g.date, g.heure, 90);
            var title = encodeURIComponent('‚öæ LBMA ‚Äî ' + (TEAM_NAMES[g.visiteur]||g.visiteur) + ' @ ' + (TEAM_NAMES[g.local]||g.local));
            var body = encodeURIComponent('Match #' + g._numero + ' ‚Äî Saison LBMA 2026. Terrain: ' + (g.endroit||'√Ä confirmer'));
            var location = encodeURIComponent(g.endroit || 'Montr√©al, QC');
            // startdt format: 2026-05-01T19:00:00
            var sd = g.date + 'T' + dates.start.substring(9,11) + ':' + dates.start.substring(11,13) + ':00';
            var ed = g.date + 'T' + dates.end.substring(9,11) + ':' + dates.end.substring(11,13) + ':00';
            return 'https://outlook.live.com/calendar/0/deeplink/compose?subject=' + title +
                '&startdt=' + encodeURIComponent(sd) + '&enddt=' + encodeURIComponent(ed) +
                '&body=' + body + '&location=' + location + '&path=%2Fcalendar%2Faction%2Fcompose&rru=addevent';
        }

        function makeIcsContent(games) {
            var lines = [
                'BEGIN:VCALENDAR',
                'VERSION:2.0',
                'PRODID:-//LBMA//Calendrier 2026//FR',
                'CALSCALE:GREGORIAN',
                'METHOD:PUBLISH',
                'X-WR-CALNAME:LBMA 2026',
                'X-WR-TIMEZONE:America/Toronto'
            ];
            games.forEach(function(g) {
                var dates = formatIcsDate(g.date, g.heure, 90);
                var uid = 'lbma-2026-match-' + g.id + '@liguelbma.org';
                var title = 'LBMA ‚Äî ' + (TEAM_NAMES[g.visiteur]||g.visiteur) + ' @ ' + (TEAM_NAMES[g.local]||g.local);
                var desc = 'Match #' + g._numero + ' ‚Äî Saison LBMA 2026\\nTerrain: ' + (g.endroit||'√Ä confirmer') + (g.special ? '\\nüéâ ' + g.special : '');
                var now = new Date();
                function pad(n){ return String(n).padStart(2,'0'); }
                var stamp = now.getFullYear() + pad(now.getMonth()+1) + pad(now.getDate()) + 'T' + pad(now.getHours()) + pad(now.getMinutes()) + pad(now.getSeconds()) + 'Z';
                lines.push(
                    'BEGIN:VEVENT',
                    'UID:' + uid,
                    'DTSTAMP:' + stamp,
                    'DTSTART;TZID=America/Toronto:' + dates.start,
                    'DTEND;TZID=America/Toronto:' + dates.end,
                    'SUMMARY:' + title,
                    'DESCRIPTION:' + desc,
                    'LOCATION:' + (g.endroit || 'Montr√©al, QC'),
                    'STATUS:CONFIRMED',
                    'END:VEVENT'
                );
            });
            lines.push('END:VCALENDAR');
            return lines.join('\r\n');
        }

        function openAgendaPopup(matchId) {
            var g = allGames.find(function(x){ return x.id === matchId; });
            if (!g) return;
            _agendaGame = g;

            var dateObj = new Date(g.date + 'T12:00:00');
            var opts = { weekday:'long', day:'numeric', month:'long', year:'numeric' };
            var dateStr = dateObj.toLocaleDateString('fr-CA', opts);
            dateStr = dateStr.charAt(0).toUpperCase() + dateStr.slice(1);

            document.getElementById('agendaMatchTitle').textContent =
                (TEAM_NAMES[g.visiteur]||g.visiteur) + ' @ ' + (TEAM_NAMES[g.local]||g.local);
            document.getElementById('agendaMatchInfo').textContent =
                dateStr + ' ‚Äî ' + (g.heure||'') + ' | ' + (g.endroit||'');

            document.getElementById('agendaGoogleBtn').href = makeGoogleUrl(g);
            document.getElementById('agendaOutlookBtn').href = makeOutlookUrl(g);

            document.getElementById('agendaOverlay').style.display = 'block';
            document.getElementById('agendaPopup').style.display = 'block';
        }

        function closeAgendaPopup() {
            document.getElementById('agendaOverlay').style.display = 'none';
            document.getElementById('agendaPopup').style.display = 'none';
            _agendaGame = null;
        }

        function downloadIcsSingle(e) {
            e.preventDefault();
            if (!_agendaGame) return;
            var content = makeIcsContent([_agendaGame]);
            var blob = new Blob([content], { type: 'text/calendar;charset=utf-8' });
            var url = URL.createObjectURL(blob);
            var a = document.createElement('a');
            a.href = url;
            a.download = 'lbma-match-' + _agendaGame._numero + '.ics';
            a.click();
            URL.revokeObjectURL(url);
            closeAgendaPopup();
        }

        function exportAllIcs() {
            var avenir = allGames.filter(function(g){ return g.status !== 'final'; });
            var games = avenir.length > 0 ? avenir : allGames;
            if (games.length === 0) { alert('Aucun match dans le calendrier.'); return; }
            var content = makeIcsContent(games);
            var blob = new Blob([content], { type: 'text/calendar;charset=utf-8' });
            var url = URL.createObjectURL(blob);
            var a = document.createElement('a');
            a.href = url;
            a.download = 'lbma-calendrier-2026.ics';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Fermer popup avec Escape
        document.addEventListener('keydown', function(e){ if(e.key==='Escape'){ closeAgendaPopup(); closeTeamExportPopup(); } });

        /* ==========================================
           EXPORT PAR √âQUIPE
        ========================================== */
        var TEAM_COLORS = {
            AIGLES:'#FF8001', CONDORS:'#0070C0', DUCS:'#375623',
            FAUCONS:'#FF0000', HARFANGS:'#A6A6A6', VAUTOURS:'#FFFF00'
        };
        var TEAM_TEXT = {
            AIGLES:'#fff', CONDORS:'#fff', DUCS:'#fff',
            FAUCONS:'#fff', HARFANGS:'#fff', VAUTOURS:'#1A1A1A'
        };
        var TEAM_EMOJIS = {
            AIGLES:'ü¶Ö', CONDORS:'ü¶Ö', DUCS:'ü¶Ü',
            FAUCONS:'ü¶Ö', HARFANGS:'ü¶â', VAUTOURS:'ü¶Ö'
        };

        function openTeamExportPopup() {
            var grid = document.getElementById('teamExportGrid');
            var html = '';
            ['AIGLES','CONDORS','DUCS','FAUCONS','HARFANGS','VAUTOURS'].forEach(function(eq) {
                var bg = TEAM_COLORS[eq] || '#333';
                var txt = TEAM_TEXT[eq] || '#fff';
                var emoji = TEAM_EMOJIS[eq] || '‚öæ';
                html += '<button class="team-export-btn" onclick="exportTeamIcs(\'' + eq + '\')" style="background:' + bg + ';color:' + txt + ';border-color:' + bg + '">' +
                    '<span class="tdot" style="background:' + txt + ';opacity:.4"></span>' +
                    emoji + ' ' + (TEAM_NAMES[eq] || eq) +
                    '</button>';
            });
            grid.innerHTML = html;
            document.getElementById('teamExportOverlay').style.display = 'block';
            document.getElementById('teamExportPopup').style.display = 'block';
        }

        function closeTeamExportPopup() {
            document.getElementById('teamExportOverlay').style.display = 'none';
            document.getElementById('teamExportPopup').style.display = 'none';
        }

        function exportTeamIcs(equipe) {
            // Matchs √† venir o√π l'√©quipe joue (visiteur ou local)
            var games = allGames.filter(function(g) {
                return g.status !== 'final' && (g.visiteur === equipe || g.local === equipe);
            });
            if (games.length === 0) {
                alert('Aucun match √† venir pour les ' + (TEAM_NAMES[equipe] || equipe) + '.');
                return;
            }
            // G√©n√©rer le contenu ICS avec mention de l'√©quipe dans le titre
            var lines = [
                'BEGIN:VCALENDAR',
                'VERSION:2.0',
                'PRODID:-//LBMA//Calendrier ' + (TEAM_NAMES[equipe]||equipe) + ' 2026//FR',
                'CALSCALE:GREGORIAN',
                'METHOD:PUBLISH',
                'X-WR-CALNAME:LBMA 2026 ‚Äî ' + (TEAM_NAMES[equipe]||equipe),
                'X-WR-TIMEZONE:America/Toronto'
            ];
            games.forEach(function(g) {
                var dates = formatIcsDate(g.date, g.heure, 90);
                var uid = 'lbma-2026-match-' + g.id + '@liguelbma.org';
                var isHome = g.local === equipe;
                var opponent = isHome ? (TEAM_NAMES[g.visiteur]||g.visiteur) : (TEAM_NAMES[g.local]||g.local);
                var title = '‚öæ ' + (TEAM_NAMES[equipe]||equipe) + (isHome ? ' vs ' : ' @ ') + opponent;
                var desc = 'Match #' + g._numero + ' ‚Äî Saison LBMA 2026' +
                    '\\nTerrain: ' + (g.endroit||'√Ä confirmer') +
                    (isHome ? '\\nüè† Match √† domicile' : '\\n‚úàÔ∏è Match √† l\\'ext√©rieur') +
                    (g.special ? '\\nüéâ ' + g.special : '');
                function pad(n){ return String(n).padStart(2,'0'); }
                var now = new Date();
                var stamp = now.getFullYear() + pad(now.getMonth()+1) + pad(now.getDate()) + 'T' + pad(now.getHours()) + pad(now.getMinutes()) + pad(now.getSeconds()) + 'Z';
                lines.push(
                    'BEGIN:VEVENT',
                    'UID:' + uid,
                    'DTSTAMP:' + stamp,
                    'DTSTART;TZID=America/Toronto:' + dates.start,
                    'DTEND;TZID=America/Toronto:' + dates.end,
                    'SUMMARY:' + title,
                    'DESCRIPTION:' + desc,
                    'LOCATION:' + (g.endroit || 'Montr√©al, QC'),
                    'STATUS:CONFIRMED',
                    'END:VEVENT'
                );
            });
            lines.push('END:VCALENDAR');
            var content = lines.join('\r\n');
            var blob = new Blob([content], { type: 'text/calendar;charset=utf-8' });
            var url = URL.createObjectURL(blob);
            var a = document.createElement('a');
            a.href = url;
            a.download = 'lbma-2026-' + equipe.toLowerCase() + '.ics';
            a.click();
            URL.revokeObjectURL(url);
            closeTeamExportPopup();
        }
    </script>

    <script>
    /* === MOBILE NAV STANDARD LBMA === */
    (function() {
        var isTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;

        document.querySelectorAll('nav .dropdown > a').forEach(function(a) {
            a.addEventListener('click', function(e) {
                if (isTouch || window.innerWidth <= 768) {
                    e.preventDefault();
                    var parent = this.parentElement;
                    document.querySelectorAll('nav .dropdown').forEach(function(d) {
                        if (d !== parent) d.classList.remove('open');
                    });
                    parent.classList.toggle('open');
                }
            });
        });

        document.addEventListener('click', function(e) {
            if (!e.target.closest('nav')) {
                document.querySelector('nav ul')?.classList.remove('open');
                document.querySelectorAll('nav .dropdown').forEach(function(d) {
                    d.classList.remove('open');
                });
            }
        });
        function goPointage(el,matchId){
            var session=null;
            try{var s=localStorage.getItem('lbma_admin_session');if(s)session=JSON.parse(s);}catch(e){}
            var role=session&&session.expires>Date.now()?session.role:'';
            if(role==='superadmin'||role==='admin'||role==='marqueur'){
                el.href='pointage.html?id='+matchId;
                return true;
            }else{
                el.href='login.html?retour='+encodeURIComponent('pointage.html?id='+matchId);
                return true;
            }
        }
    })();
    </script>
<script src="lbma-analytics.js"></script>
</body>
</html>
