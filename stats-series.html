<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Statistiques des S√©ries - LBMA</title>
    <link rel="icon" type="image/jpeg" href="logo-lbma.jpg">
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Oswald:wght@400;600;700&family=Work+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{--primary:#1E3A5F;--accent:#CC0000;--gold:#D4AF37;--white:#FDFBF7;--cream:#F5F1E8;--dark:#1A1A1A}
        body{font-family:'Work Sans',sans-serif;background:var(--cream);color:var(--dark)}
        .page-header{margin-top:80px;background:linear-gradient(135deg,#8B0000 0%,#CC0000 50%,#8B0000 100%);color:var(--white);padding:3rem 2rem;text-align:center;position:relative}
        .page-header::before{content:'';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:300px;height:300px;background:url('logo-lbma.jpg') no-repeat center;background-size:contain;opacity:.1}
        .page-header h1{font-family:'Bebas Neue',sans-serif;font-size:clamp(2rem,6vw,3.5rem);letter-spacing:.1em;position:relative;text-shadow:3px 3px 0 rgba(0,0,0,.3)}
        .page-header p{font-family:'Oswald',sans-serif;font-size:1.2rem;position:relative;margin-top:.5rem}
        .container{max-width:1400px;margin:0 auto;padding:2rem}
        .controls{background:var(--white);border:3px solid var(--dark);padding:1.5rem;margin-bottom:2rem;display:flex;gap:1rem;flex-wrap:wrap;align-items:flex-end}
        .control-group{display:flex;flex-direction:column;gap:.5rem}
        .control-group label{font-family:'Oswald',sans-serif;text-transform:uppercase;font-size:.85rem;color:var(--primary)}
        .control-group select{padding:.75rem 1.5rem;border:2px solid var(--dark);font-size:1rem;background:var(--cream);min-width:180px;cursor:pointer}
        .control-group select:focus{outline:none;border-color:var(--primary)}
        .stat-nav{display:flex;gap:0;margin-bottom:2rem}
        .stat-nav a{padding:1rem 2.5rem;background:var(--cream);border:3px solid var(--dark);font-family:'Oswald',sans-serif;font-size:1.1rem;text-transform:uppercase;text-decoration:none;color:var(--dark);transition:.3s;margin-right:-3px}
        .stat-nav a.active{background:var(--accent);color:white;border-color:var(--accent)}
        .stat-nav a:hover:not(.active){background:var(--gold);color:var(--dark)}
        .section-tabs{display:flex;gap:0;margin-bottom:1.5rem}
        .section-tabs button{padding:.75rem 2rem;background:var(--cream);border:3px solid var(--dark);font-family:'Oswald',sans-serif;font-size:1rem;text-transform:uppercase;color:var(--dark);transition:.3s;margin-right:-3px;cursor:pointer}
        .section-tabs button.active{background:var(--primary);color:white}
        .section-tabs button:hover:not(.active){background:var(--gold);color:var(--dark)}
        .table-wrapper{overflow-x:auto;background:var(--white);border:3px solid var(--dark)}
        .stats-table{width:100%;border-collapse:collapse;font-size:.9rem}
        .stats-table th{background:var(--primary);color:white;padding:.75rem .5rem;text-align:center;font-family:'Oswald',sans-serif;text-transform:uppercase;font-size:.8rem;position:sticky;top:0;cursor:pointer;white-space:nowrap;user-select:none}
        .stats-table th:hover{background:#2D5A8A}
        .stats-table th.sorted-asc::after{content:' ‚ñ≤';font-size:.6rem}
        .stats-table th.sorted-desc::after{content:' ‚ñº';font-size:.6rem}
        .stats-table td{padding:.5rem;text-align:center;border-bottom:1px solid var(--cream)}
        .stats-table tr:hover{background:rgba(212,175,55,.15)}
        .stats-table .player-name{text-align:left;font-weight:600;white-space:nowrap;padding-left:1rem}
        .stats-table .team-col{text-align:left;font-size:.85rem}
        .stats-table .highlight{background:rgba(212,175,55,.2);font-weight:700}
        .stats-table .rank-col{font-family:'Oswald',sans-serif;color:var(--gold);font-weight:700;width:30px}
        .stats-summary{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:1rem;margin-bottom:2rem}
        .summary-card{background:var(--white);border:3px solid var(--dark);padding:1.5rem;text-align:center;position:relative}
        .summary-card::before{content:'';position:absolute;top:-3px;left:-3px;right:-3px;bottom:-3px;background:var(--accent);z-index:-1;transition:transform .3s}
        .summary-card:hover::before{transform:translate(4px,4px)}
        .summary-card .value{font-family:'Bebas Neue',sans-serif;font-size:2.5rem;color:var(--primary)}
        .summary-card .label{font-family:'Oswald',sans-serif;font-size:.85rem;text-transform:uppercase;opacity:.7}
        .loading{text-align:center;padding:3rem;font-family:'Oswald',sans-serif;font-size:1.2rem;color:var(--primary)}
        .loading::after{content:'';display:inline-block;width:20px;height:20px;border:3px solid var(--primary);border-top-color:transparent;border-radius:50%;animation:spin .8s linear infinite;margin-left:10px;vertical-align:middle}
        @keyframes spin{to{transform:rotate(360deg)}}
        .no-data{text-align:center;padding:3rem;color:#888;font-family:'Oswald',sans-serif;font-size:1.2rem}
        .legend{background:var(--cream);border:2px solid var(--dark);padding:1rem;margin-top:1rem;font-size:.8rem}
        .legend h4{font-family:'Oswald',sans-serif;color:var(--primary);margin-bottom:.5rem}
        .legend-grid{display:flex;flex-wrap:wrap;gap:.75rem}
        nav{position:fixed;top:0;left:0;right:0;z-index:1000;background:var(--white);box-shadow:0 2px 20px rgba(0,0,0,.1)}
        nav .nav-container{max-width:1400px;margin:0 auto;padding:.75rem 2rem;display:flex;justify-content:space-between;align-items:center}
        .logo{display:flex;align-items:center;gap:.75rem;text-decoration:none}
        .logo img{height:55px}
        nav ul{display:flex;list-style:none;gap:.5rem}
        nav li{position:relative}
        nav a{text-decoration:none;color:var(--dark);font-weight:600;text-transform:uppercase;font-size:.85rem;padding:.5rem 1rem;display:block;transition:.3s}
        nav a:hover{color:var(--primary);background:var(--cream)}
        .dropdown-content{display:none;position:absolute;top:100%;left:0;background:var(--white);min-width:220px;box-shadow:0 8px 16px rgba(0,0,0,.1);border:2px solid var(--dark);z-index:1001}
        .dropdown-content a{padding:.75rem 1rem;border-bottom:1px solid var(--cream);font-size:.8rem}
        .dropdown:hover .dropdown-content{display:block}
        .dropdown>a::after{content:' \25BC';font-size:.6rem}
        .hamburger{display:none;font-size:2rem;cursor:pointer;padding:.5rem;color:var(--dark)}
        footer{background:var(--dark);color:var(--white);padding:3rem 2rem}
        .footer-social{display:flex;gap:.5rem;flex-wrap:wrap}
        .social-link{display:inline-flex;align-items:center;gap:.5rem;background:rgba(255,255,255,.1);padding:.6rem 1.2rem;border-radius:5px;color:white;text-decoration:none;transition:.3s}
        .social-link:hover{background:var(--gold);color:var(--dark)}
        .footer-bottom{max-width:1400px;margin:1.5rem auto 0;padding-top:1.5rem;border-top:1px solid rgba(255,255,255,.2);text-align:center;opacity:.7;font-size:.85rem}
        .dropdown.open .dropdown-content{display:block!important}
        @media(max-width:768px){
            .hamburger{display:block}
            nav ul{display:none;position:absolute;top:100%;left:0;right:0;background:var(--white);flex-direction:column;padding:1rem;box-shadow:0 8px 16px rgba(0,0,0,.1)}
            nav ul.open{display:flex}
            .dropdown-content{position:static;box-shadow:none;border:none;border-left:3px solid var(--primary);margin-left:1rem}
            .dropdown:hover .dropdown-content{display:none}
            .dropdown.open .dropdown-content{display:block}
            .controls{flex-direction:column}
            .control-group select{width:100%}
            .stat-nav a{padding:.75rem 1rem;font-size:.9rem}
            .section-tabs button{padding:.5rem 1rem;font-size:.85rem}
            .stats-table{font-size:.75rem}
            .stats-table th,.stats-table td{padding:.3rem .2rem}
            .stats-summary{grid-template-columns:repeat(2,1fr)}
        }
    </style>
</head>
<body>
    <nav>
        <div class="nav-container">
            <a href="index.html" class="logo"><img src="logo-lbma.jpg" alt="LBMA"></a>
            <div class="hamburger" onclick="document.querySelector('nav ul').classList.toggle('open')">&#9776;</div>
            <ul>
                <li><a href="index.html">Accueil</a></li>
                <li><a href="equipes.html">√âquipes</a></li>
                <li><a href="joueurs.html">Joueurs</a></li>
                <li><a href="calendrier.html">Calendrier</a></li>
                <li class="dropdown">
                    <a href="#" style="color:var(--primary);font-weight:700">Statistiques</a>
                    <div class="dropdown-content">
                        <a href="classement-equipes.html">üèÜ Classement</a>
                        <a href="stats-frappeurs.html">‚öæ Frappeurs</a>
                        <a href="stats-lanceurs.html">üéØ Lanceurs</a>
                        <a href="stats-series.html" style="color:var(--accent);font-weight:700">üèÜ S√©ries √âliminatoires</a>
                    </div>
                </li>
                <li class="dropdown">
                    <a href="#">Archives</a>
                    <div class="dropdown-content">
                        <a href="archives-frappeurs.html">üìä Stats Frappeurs par Ann√©e</a>
                        <a href="frappeurs-carriere.html">‚≠ê Frappeurs - Carri√®re</a>
                        <a href="frappeurs-records.html">üèÜ Frappeurs - Records</a>
                        <a href="archives-lanceurs.html">üìä Stats Lanceurs par Ann√©e</a>
                        <a href="lanceurs-carriere.html">‚≠ê Lanceurs - Carri√®re</a>
                        <a href="lanceurs-records.html">üèÜ Lanceurs - Records</a>
                        <a href="classement-equipes.html">üìà Classements Historiques</a>
                        <a href="temple-renommee.html">üèõÔ∏è Temple de la Renomm√©e</a>
                        <a href="archives.html">üìö Archives Compl√®tes</a>
                    </div>
                </li>
                <li><a href="contact.html">Direction</a></li>
                <li><a href="admin.html" style="color:var(--accent)">Admin</a></li>
            </ul>
        </div>
    </nav>

    <section class="page-header">
        <h1>üèÜ S√©ries √âliminatoires</h1>
        <p>Saison <span id="headerSaison">2025</span></p>
    </section>

    <div class="container">
        <div class="stat-nav">
            <a href="stats-frappeurs.html">‚öæ Frappeurs (R√©guli√®re)</a>
            <a href="stats-lanceurs.html">üéØ Lanceurs (R√©guli√®re)</a>
            <a href="stats-series.html" class="active">üèÜ S√©ries</a>
        </div>

        <div class="controls">
            <div class="control-group">
                <label>Ann√©e des s√©ries</label>
                <select id="anneeSelect" onchange="loadStats()"></select>
            </div>
            <div class="control-group">
                <label>√âquipe</label>
                <select id="equipeSelect" onchange="filterTable()">
                    <option value="all">Toutes les √©quipes</option>
                </select>
            </div>
        </div>

        <div class="section-tabs">
            <button id="tabFrappeurs" class="active" onclick="changeSection('frappeurs')">‚öæ Frappeurs</button>
            <button id="tabLanceurs" onclick="changeSection('lanceurs')">üéØ Lanceurs</button>
        </div>

        <div class="stats-summary" id="summaryCards"></div>

        <div class="table-wrapper">
            <div class="loading" id="loading">Chargement des statistiques</div>
            <div class="no-data" id="noData" style="display:none">Aucune donn√©e pour cette saison.</div>
            <table class="stats-table" id="statsTable" style="display:none">
                <thead id="tableHead"></thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>

        <div class="legend" id="legendFrappeurs">
            <h4>L√©gende ‚Äî Frappeurs</h4>
            <div class="legend-grid">
                <span><strong>PJ</strong> Parties jou√©es</span>
                <span><strong>AB</strong> Au b√¢ton</span>
                <span><strong>CS</strong> Coups s√ªrs</span>
                <span><strong>1B</strong> Simples</span>
                <span><strong>2B</strong> Doubles</span>
                <span><strong>3B</strong> Triples</span>
                <span><strong>CC</strong> Coups de circuit</span>
                <span><strong>PC</strong> Points compt√©s</span>
                <span><strong>PP</strong> Points produits</span>
                <span><strong>BB</strong> Buts sur balles</span>
                <span><strong>RB</strong> Retraits au b√¢ton</span>
                <span><strong>SAC</strong> Sacrifices</span>
                <span><strong>MOY</strong> Moyenne au b√¢ton</span>
            </div>
        </div>
        <div class="legend" id="legendLanceurs" style="display:none">
            <h4>L√©gende ‚Äî Lanceurs</h4>
            <div class="legend-grid">
                <span><strong>PJ</strong> Parties jou√©es</span>
                <span><strong>PL</strong> Parties lanc√©es</span>
                <span><strong>ML</strong> Manches lanc√©es</span>
                <span><strong>OUT</strong> Retraits</span>
                <span><strong>V</strong> Victoires</span>
                <span><strong>D</strong> D√©faites</span>
                <span><strong>N</strong> Nulles</span>
                <span><strong>SV</strong> Sauvetages</span>
                <span><strong>PC</strong> Points compt√©s</span>
                <span><strong>CS</strong> Coups s√ªrs accord√©s</span>
                <span><strong>BB</strong> Buts sur balles</span>
                <span><strong>RB</strong> Retraits au b√¢ton</span>
                <span><strong>HR</strong> Circuits accord√©s</span>
                <span><strong>MOY</strong> Moyenne de points m√©rit√©s</span>
            </div>
        </div>
    </div>

    <footer>
        <div class="footer-grid" style="max-width:1400px;margin:0 auto;display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:2rem">
            <div>
                <div style="display:flex;align-items:center;gap:1rem;margin-bottom:1rem">
                    <img src="logo-lbma.jpg" alt="LBMA" style="height:50px;background:white;padding:5px;border-radius:5px">
                    <div>
                        <div style="font-family:'Bebas Neue',sans-serif;font-size:1.5rem">LBMA</div>
                        <div style="opacity:.7;font-size:.9rem">Depuis 1976</div>
                    </div>
                </div>
                <div class="footer-social" style="margin-top:1rem">
                    <a href="https://www.facebook.com/groups/2400013274" target="_blank" class="social-link">üìò Facebook</a>
                    <a href="https://www.marqueur.com/baseball/mbr/tools/blg/index.php?nyx=1154" target="_blank" class="social-link">üìä Marqueur.com</a>
                </div>
            </div>
            <div>
                <h4 style="font-family:'Oswald',sans-serif;color:var(--gold);margin-bottom:1rem">üìä Statistiques 2026</h4>
                <ul style="list-style:none">
                    <li><a href="classement-equipes.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Classement</a></li>
                    <li><a href="stats-frappeurs.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Frappeurs</a></li>
                    <li><a href="stats-lanceurs.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Lanceurs</a></li>
                    <li><a href="stats-series.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">S√©ries √âliminatoires</a></li>
                </ul>
            </div>
            <div>
                <h4 style="font-family:'Oswald',sans-serif;color:var(--gold);margin-bottom:1rem">üìö Archives</h4>
                <ul style="list-style:none">
                    <li><a href="archives-frappeurs.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Stats Frappeurs par Ann√©e</a></li>
                    <li><a href="frappeurs-carriere.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Frappeurs - Carri√®re</a></li>
                    <li><a href="archives-lanceurs.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Stats Lanceurs par Ann√©e</a></li>
                    <li><a href="lanceurs-carriere.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Lanceurs - Carri√®re</a></li>
                    <li><a href="classement-equipes.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Classements Historiques</a></li>
                    <li><a href="temple-renommee.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Temple de la Renomm√©e</a></li>
                </ul>
            </div>
            <div>
                <h4 style="font-family:'Oswald',sans-serif;color:var(--gold);margin-bottom:1rem">‚öæ La Ligue</h4>
                <ul style="list-style:none">
                    <li><a href="equipes.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">√âquipes 2026</a></li>
                    <li><a href="calendrier.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Calendrier</a></li>
                    <li><a href="reglements.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">R√®glements</a></li>
                    <li><a href="contact.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Direction</a></li>
                    <li><a href="liens-utiles.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Liens Utiles</a></li>
                    <li><a href="revue-presse.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">M√©dias & Entrevues</a></li>
                    <li><a href="nous-contacter.html" style="color:white;text-decoration:none;display:block;padding:.25rem 0;opacity:.8">Nous Contacter</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">¬© 2026 Ligue de Balle Molle Amicale (LBMA) - Tous droits r√©serv√©s</div>
    </footer>

    <script>
    const SUPABASE_URL = 'https://xgyskiatppgaeaamjhxr.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhneXNraWF0cHBnYWVhYW1qaHhyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA0OTgxNTQsImV4cCI6MjA4NjA3NDE1NH0.67KCcUWlJij-scDoCUvZpkiCle5-mHVmy-inRk96Tac';

    let allData = [];
    let currentSection = 'frappeurs';
    let sortCol = 'moy';
    let sortDir = 'desc';

    async function supabaseGet(table, params) {
        const url = SUPABASE_URL + '/rest/v1/' + table + '?' + params;
        const res = await fetch(url, {
            headers: { 'apikey': SUPABASE_KEY, 'Authorization': 'Bearer ' + SUPABASE_KEY }
        });
        return res.json();
    }

    async function init() {
        try {
            const saisonsF = await supabaseGet('frappeurs_series', 'select=saison&order=saison.desc&limit=5000');
            const saisonsL = await supabaseGet('lanceurs_series', 'select=saison&order=saison.desc&limit=5000');
            const allSaisons = [...new Set([
                ...(Array.isArray(saisonsF) ? saisonsF.map(s => s.saison) : []),
                ...(Array.isArray(saisonsL) ? saisonsL.map(s => s.saison) : [])
            ])].sort((a, b) => String(b).localeCompare(String(a)));

            const sel = document.getElementById('anneeSelect');
            if (allSaisons.length === 0) {
                ['2025','2024','2023','2022','2021','2020','2019','2018'].forEach(y => {
                    sel.innerHTML += '<option value="' + y + '">' + y + '</option>';
                });
            } else {
                allSaisons.forEach(s => {
                    sel.innerHTML += '<option value="' + s + '">' + s + '</option>';
                });
            }
            loadStats();
        } catch(e) {
            console.error('Erreur init:', e);
            const sel = document.getElementById('anneeSelect');
            ['2025','2024','2023','2022','2021','2020','2019','2018'].forEach(y => {
                sel.innerHTML += '<option value="' + y + '">' + y + '</option>';
            });
            loadStats();
        }
    }

    async function loadStats() {
        const saison = document.getElementById('anneeSelect').value;
        document.getElementById('headerSaison').textContent = saison;
        document.getElementById('loading').style.display = 'block';
        document.getElementById('noData').style.display = 'none';
        document.getElementById('statsTable').style.display = 'none';

        const table = currentSection === 'frappeurs' ? 'frappeurs_series' : 'lanceurs_series';
        const orderCol = currentSection === 'frappeurs' ? 'moy.desc.nullslast' : 'moy.asc.nullslast';

        try {
            allData = await supabaseGet(table, 'select=*&saison=eq.' + saison + '&order=' + orderCol + '&limit=500');
            document.getElementById('loading').style.display = 'none';

            if (!Array.isArray(allData) || allData.length === 0) {
                document.getElementById('noData').style.display = 'block';
                document.getElementById('summaryCards').innerHTML = '';
                return;
            }
            populateEquipes(allData);
            updateSummary(allData);
            renderTable(allData);
        } catch(e) {
            console.error('Erreur chargement:', e);
            document.getElementById('loading').style.display = 'none';
            document.getElementById('noData').style.display = 'block';
        }
    }

    function changeSection(section) {
        currentSection = section;
        document.getElementById('tabFrappeurs').classList.toggle('active', section === 'frappeurs');
        document.getElementById('tabLanceurs').classList.toggle('active', section === 'lanceurs');
        document.getElementById('legendFrappeurs').style.display = section === 'frappeurs' ? 'block' : 'none';
        document.getElementById('legendLanceurs').style.display = section === 'lanceurs' ? 'block' : 'none';
        sortCol = 'moy';
        sortDir = section === 'frappeurs' ? 'desc' : 'asc';
        loadStats();
    }

    function populateEquipes(data) {
        const equipes = [...new Set(data.map(d => d.equipe).filter(Boolean))].sort();
        const sel = document.getElementById('equipeSelect');
        sel.innerHTML = '<option value="all">Toutes les √©quipes</option>';
        equipes.forEach(eq => { sel.innerHTML += '<option value="' + eq + '">' + eq + '</option>'; });
    }

    function filterTable() {
        const equipe = document.getElementById('equipeSelect').value;
        const filtered = equipe === 'all' ? allData : allData.filter(d => d.equipe === equipe);
        updateSummary(filtered);
        renderTable(filtered);
    }

    function updateSummary(data) {
        const cards = document.getElementById('summaryCards');
        if (currentSection === 'frappeurs') {
            const bestMoy = data.length ? Math.max(...data.filter(d => d.moy != null && d.ab >= 5).map(d => d.moy).concat([0])) : 0;
            const bestCS = data.length ? Math.max(...data.map(d => d.cs || 0)) : 0;
            const bestCC = data.length ? Math.max(...data.map(d => d.cc || 0)) : 0;
            cards.innerHTML =
                '<div class="summary-card"><div class="value">' + data.length + '</div><div class="label">Joueurs</div></div>' +
                '<div class="summary-card"><div class="value">' + (bestMoy > 0 ? bestMoy.toFixed(3) : '-') + '</div><div class="label">Meilleure MOY</div></div>' +
                '<div class="summary-card"><div class="value">' + bestCC + '</div><div class="label">Plus de CC</div></div>' +
                '<div class="summary-card"><div class="value">' + bestCS + '</div><div class="label">Plus de CS</div></div>';
        } else {
            const bestV = data.length ? Math.max(...data.map(d => d.v || 0)) : 0;
            const vals = data.filter(d => d.moy != null).map(d => d.moy);
            const bestMoyL = vals.length ? Math.min(...vals) : 0;
            cards.innerHTML =
                '<div class="summary-card"><div class="value">' + data.length + '</div><div class="label">Lanceurs</div></div>' +
                '<div class="summary-card"><div class="value">' + (bestMoyL < 9999 ? bestMoyL.toFixed(2) : '-') + '</div><div class="label">Meilleure MOY</div></div>' +
                '<div class="summary-card"><div class="value">' + bestV + '</div><div class="label">Plus de V</div></div>';
        }
    }

    function renderTable(data) {
        const thead = document.getElementById('tableHead');
        const tbody = document.getElementById('tableBody');
        document.getElementById('statsTable').style.display = 'table';

        if (currentSection === 'frappeurs') {
            thead.innerHTML = '<tr>' +
                '<th data-col="rank">#</th>' +
                '<th data-col="nom" style="text-align:left;padding-left:1rem">Joueur</th>' +
                '<th data-col="equipe" style="text-align:left">√âquipe</th>' +
                '<th data-col="pj">PJ</th><th data-col="ab">AB</th><th data-col="cs">CS</th>' +
                '<th data-col="simples">1B</th><th data-col="doubles">2B</th><th data-col="triples">3B</th>' +
                '<th data-col="cc">CC</th><th data-col="pc">PC</th><th data-col="pp">PP</th>' +
                '<th data-col="bb">BB</th><th data-col="rb">RB</th><th data-col="sac">SAC</th>' +
                '<th data-col="moy">MOY</th></tr>';

            const maxMoy = Math.max(...data.filter(d => d.moy != null).map(d => d.moy).concat([0]));
            const maxCS = Math.max(...data.map(d => d.cs || 0));
            const maxCC = Math.max(...data.map(d => d.cc || 0));
            const maxPP = Math.max(...data.map(d => d.pp || 0));

            tbody.innerHTML = data.map((d, i) =>
                '<tr>' +
                '<td class="rank-col">' + (i+1) + '</td>' +
                '<td class="player-name">' + (d.nom||'') + '</td>' +
                '<td class="team-col">' + (d.equipe||'') + '</td>' +
                '<td>' + (d.pj||0) + '</td><td>' + (d.ab||0) + '</td>' +
                '<td class="' + (d.cs===maxCS&&maxCS>0?'highlight':'') + '">' + (d.cs||0) + '</td>' +
                '<td>' + (d.simples||0) + '</td><td>' + (d.doubles||0) + '</td><td>' + (d.triples||0) + '</td>' +
                '<td class="' + (d.cc===maxCC&&maxCC>0?'highlight':'') + '">' + (d.cc||0) + '</td>' +
                '<td>' + (d.pc||0) + '</td>' +
                '<td class="' + (d.pp===maxPP&&maxPP>0?'highlight':'') + '">' + (d.pp||0) + '</td>' +
                '<td>' + (d.bb||0) + '</td><td>' + (d.rb||0) + '</td><td>' + (d.sac||0) + '</td>' +
                '<td class="' + (d.moy===maxMoy&&maxMoy>0?'highlight':'') + '">' + (d.moy!=null?Number(d.moy).toFixed(3):'-') + '</td>' +
                '</tr>'
            ).join('');
        } else {
            thead.innerHTML = '<tr>' +
                '<th data-col="rank">#</th>' +
                '<th data-col="nom" style="text-align:left;padding-left:1rem">Lanceur</th>' +
                '<th data-col="equipe" style="text-align:left">√âQ</th>' +
                '<th data-col="pj">PJ</th><th data-col="pl">PL</th><th data-col="ml">ML</th><th data-col="out">OUT</th>' +
                '<th data-col="v">V</th><th data-col="d">D</th><th data-col="n">N</th><th data-col="sv">SV</th>' +
                '<th data-col="pc">PC</th><th data-col="cs">CS</th><th data-col="bb">BB</th>' +
                '<th data-col="rb">RB</th><th data-col="hr">HR</th><th data-col="moy">MOY</th></tr>';

            const bestMoyL = Math.min(...data.filter(d => d.moy!=null).map(d => d.moy).concat([9999]));
            const maxV = Math.max(...data.map(d => d.v||0));
            const maxRB = Math.max(...data.map(d => d.rb||0));

            tbody.innerHTML = data.map((d, i) =>
                '<tr>' +
                '<td class="rank-col">' + (i+1) + '</td>' +
                '<td class="player-name">' + (d.nom||'') + '</td>' +
                '<td class="team-col">' + (d.equipe||'') + '</td>' +
                '<td>' + (d.pj||0) + '</td><td>' + (d.pl||0) + '</td>' +
                '<td>' + (d.ml!=null?Number(d.ml).toFixed(1):'0.0') + '</td>' +
                '<td>' + (d.out||0) + '</td>' +
                '<td class="' + (d.v===maxV&&maxV>0?'highlight':'') + '">' + (d.v||0) + '</td>' +
                '<td>' + (d.d||0) + '</td><td>' + (d.n||0) + '</td><td>' + (d.sv||0) + '</td>' +
                '<td>' + (d.pc||0) + '</td><td>' + (d.cs||0) + '</td><td>' + (d.bb||0) + '</td>' +
                '<td class="' + (d.rb===maxRB&&maxRB>0?'highlight':'') + '">' + (d.rb||0) + '</td>' +
                '<td>' + (d.hr||0) + '</td>' +
                '<td class="' + (d.moy===bestMoyL&&d.moy!=null?'highlight':'') + '">' + (d.moy!=null?Number(d.moy).toFixed(2):'-') + '</td>' +
                '</tr>'
            ).join('');
        }

        // Tri par colonne au clic
        document.querySelectorAll('#tableHead th[data-col]').forEach(th => {
            th.addEventListener('click', function() {
                const col = this.dataset.col;
                if (col === 'rank') return;
                if (sortCol === col) sortDir = sortDir === 'asc' ? 'desc' : 'asc';
                else { sortCol = col; sortDir = (col==='nom'||col==='equipe') ? 'asc' : 'desc'; }
                document.querySelectorAll('#tableHead th').forEach(t => t.classList.remove('sorted-asc','sorted-desc'));
                this.classList.add('sorted-' + sortDir);
                const sorted = [...data].sort((a,b) => {
                    let va=a[col], vb=b[col];
                    if(va==null) return 1; if(vb==null) return -1;
                    if(typeof va==='string') return sortDir==='asc'?va.localeCompare(vb):vb.localeCompare(va);
                    return sortDir==='asc'?va-vb:vb-va;
                });
                renderTable(sorted);
            });
        });
    }

    init();

    /* === MOBILE NAV === */
    (function() {
        const isTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
        document.querySelectorAll('nav .dropdown > a').forEach(a => {
            a.addEventListener('click', function(e) {
                if (isTouch || window.innerWidth <= 768) {
                    e.preventDefault();
                    const parent = this.parentElement;
                    document.querySelectorAll('nav .dropdown').forEach(d => { if(d!==parent) d.classList.remove('open'); });
                    parent.classList.toggle('open');
                }
            });
        });
        document.addEventListener('click', e => {
            if (!e.target.closest('nav')) {
                document.querySelector('nav ul')?.classList.remove('open');
                document.querySelectorAll('nav .dropdown').forEach(d => d.classList.remove('open'));
            }
        });
    })();
    </script>
<script src="lbma-analytics.js"></script>
</body>
</html>
