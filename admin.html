<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administration - LBMA</title>
    <link rel="icon" type="image/jpeg" href="logo-lbma.jpg">
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Oswald:wght@400;600;700&family=Work+Sans:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{--primary:#1E3A5F;--accent:#CC0000;--gold:#D4AF37;--white:#FDFBF7;--cream:#F5F1E8;--dark:#1A1A1A;--success:#28a745;--danger:#dc3545;--warning:#ffc107;
              --aigles:#FF8001;--condors:#0070C0;--ducs:#375623;--faucons:#FF0000;--harfangs:#A6A6A6;--vautours:#FFFF00}
        body{font-family:'Work Sans',sans-serif;background:var(--cream);display:flex;min-height:100vh}
        .sidebar{width:240px;background:var(--dark);color:var(--white);position:fixed;height:100vh;overflow-y:auto}
        .sidebar-header{padding:1rem;background:var(--primary);display:flex;align-items:center;gap:.75rem}
        .sidebar-header img{height:40px;background:white;padding:3px;border-radius:5px}
        .sidebar-header h2{font-family:'Bebas Neue',sans-serif;font-size:1.2rem}
        .user-info{padding:.75rem 1rem;background:rgba(255,255,255,.1)}
        .user-info .username{font-family:'Oswald',sans-serif;color:var(--gold)}
        .user-info .logout-btn{background:var(--danger);color:white;border:none;padding:.4rem .75rem;margin-top:.4rem;cursor:pointer;font-size:.75rem;width:100%}
        .menu-section{padding:.4rem 1rem;font-size:.65rem;text-transform:uppercase;color:rgba(255,255,255,.5);margin-top:.75rem}
        .menu-item{display:flex;align-items:center;gap:.75rem;padding:.6rem 1rem;cursor:pointer;transition:.3s;border-left:3px solid transparent;font-size:.85rem}
        .menu-item:hover{background:rgba(255,255,255,.1)}
        .menu-item.active{background:var(--primary);border-left-color:var(--gold)}
        .menu-item.superadmin-only{background:linear-gradient(90deg,rgba(204,0,0,.3),transparent)}
        .sidebar-footer{padding:.75rem 1rem;background:rgba(0,0,0,.3);margin-top:auto}
        .sidebar-footer a{color:var(--white);text-decoration:none;opacity:.8;display:block;padding:.2rem 0;font-size:.75rem}
        .sidebar-footer a:hover{color:var(--gold)}
        .main-content{margin-left:240px;flex:1;padding:1.5rem}
        .page-header h1{font-family:'Bebas Neue',sans-serif;font-size:2rem;color:var(--primary)}
        .page-header p{color:#666;font-size:.85rem}
        .cards-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:.75rem;margin:1.5rem 0}
        .stat-card{background:var(--white);border:2px solid var(--dark);padding:.75rem;text-align:center}
        .stat-card .number{font-family:'Bebas Neue',sans-serif;font-size:1.75rem;color:var(--primary)}
        .stat-card .label{font-family:'Oswald',sans-serif;text-transform:uppercase;font-size:.65rem;color:#666}
        .content-box{background:var(--white);border:2px solid var(--dark);padding:1.25rem;margin-bottom:1.25rem}
        .content-box h2{font-family:'Oswald',sans-serif;font-size:1.1rem;color:var(--primary);margin-bottom:.75rem;border-bottom:2px solid var(--cream);padding-bottom:.4rem}
        .admin-section{display:none}
        .admin-section.active{display:block}
        .btn{padding:.4rem .75rem;font-family:'Oswald',sans-serif;border:2px solid var(--dark);cursor:pointer;transition:.3s;text-transform:uppercase;font-size:.75rem}
        .btn-success{background:var(--success);color:white;border-color:var(--success)}
        .btn-primary{background:var(--primary);color:white;border-color:var(--primary)}
        .btn-danger{background:var(--danger);color:white;border-color:var(--danger)}
        .btn-warning{background:var(--warning);color:var(--dark);border-color:var(--warning)}
        .btn-secondary{background:var(--cream);color:var(--dark)}
        .btn:hover{opacity:.9}
        .btn-small{padding:.2rem .4rem;font-size:.65rem}
        .btn-group{display:flex;gap:.4rem;flex-wrap:wrap;margin-top:.5rem}
        .form-row{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:.5rem;margin-bottom:.5rem}
        .form-group{margin-bottom:.5rem}
        .form-group label{display:block;font-family:'Oswald',sans-serif;font-size:.75rem;margin-bottom:.25rem;color:var(--primary)}
        .form-group input,.form-group select,.form-group textarea{width:100%;padding:.4rem;border:2px solid var(--dark);font-size:.85rem;background:var(--cream)}
        .form-group input:focus,.form-group select:focus{outline:none;border-color:var(--primary);background:var(--white)}
        .alert{padding:.6rem;margin-bottom:.75rem;border-left:4px solid;font-size:.8rem}
        .alert-info{background:#cce5ff;border-color:var(--primary)}
        .modal{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.6);z-index:2000;align-items:center;justify-content:center}
        .modal.active{display:flex}
        .modal-content{background:var(--white);border:3px solid var(--dark);width:90%;max-width:500px;max-height:90vh;overflow-y:auto}
        .modal-header{background:var(--primary);color:white;padding:.6rem 1rem;display:flex;justify-content:space-between;align-items:center}
        .modal-header h2{font-family:'Bebas Neue',sans-serif;font-size:1.1rem}
        .modal-header.danger{background:var(--danger)}
        .modal-close{background:none;border:none;color:white;font-size:1.2rem;cursor:pointer}
        .modal-body{padding:1rem}
        .toast{position:fixed;top:20px;right:20px;padding:.6rem 1.25rem;border-radius:5px;color:white;font-weight:bold;z-index:3000;font-size:.85rem}
        .toast-success{background:var(--success)}.toast-danger{background:var(--danger)}
        .item-card{background:var(--cream);border:2px solid var(--dark);padding:.6rem;margin-bottom:.4rem;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:.4rem}
        .item-card h4{font-family:'Oswald',sans-serif;color:var(--primary);font-size:.85rem}
        .item-card p{font-size:.75rem;color:#666}
        .action-btns{display:flex;gap:.25rem}
        .superadmin-content{display:none}
        body.is-superadmin .superadmin-content{display:block}
        body.is-superadmin .menu-item.superadmin-only{display:flex}
        body:not(.is-superadmin) .menu-item.superadmin-only{display:none}
        .team-color{font-weight:bold;padding:.1rem .4rem;border-radius:3px}
        .team-color.AIGLES{background:var(--aigles);color:white}
        .team-color.CONDORS{background:var(--condors);color:white}
        .team-color.DUCS{background:var(--ducs);color:white}
        .team-color.FAUCONS{background:var(--faucons);color:white}
        .team-color.HARFANGS{background:var(--harfangs);color:white}
        .team-color.VAUTOURS{background:var(--vautours);color:white}
        .status-badge{padding:.15rem .4rem;font-size:.65rem;font-family:'Oswald',sans-serif;display:inline-block}
        .status-badge.final{background:var(--success);color:white}
        .status-badge.avenir{background:var(--cream);color:#666;border:1px solid #ccc}
        .status-badge.ferie{background:var(--gold);color:var(--dark)}
        .data-table{width:100%;border-collapse:collapse;font-size:.8rem}
        .data-table th{background:var(--primary);color:white;padding:.4rem;text-align:left;font-family:'Oswald',sans-serif;font-size:.7rem}
        .data-table td{padding:.35rem;border-bottom:1px solid var(--cream)}
        .data-table tr:hover{background:var(--cream)}
        .games-list{max-height:400px;overflow-y:auto}
        .tabs{display:flex;border-bottom:2px solid var(--dark);margin-bottom:.75rem;flex-wrap:wrap}
        .tab{padding:.4rem .75rem;font-family:'Oswald',sans-serif;cursor:pointer;background:var(--cream);border:2px solid var(--dark);border-bottom:none;margin-right:.15rem;font-size:.8rem}
        .tab.active{background:var(--primary);color:white}
        .tab-content{display:none}.tab-content.active{display:block}
        .team-tab{border-top:3px solid transparent}
        .team-tab.AIGLES{border-top-color:var(--aigles)}.team-tab.CONDORS{border-top-color:var(--condors)}
        .team-tab.DUCS{border-top-color:var(--ducs)}.team-tab.FAUCONS{border-top-color:var(--faucons)}
        .team-tab.HARFANGS{border-top-color:var(--harfangs)}.team-tab.VAUTOURS{border-top-color:var(--vautours)}
        .cote-badge{padding:.2rem .5rem;font-family:'Oswald',sans-serif;font-size:.75rem;border-radius:3px}
        .cote-1{background:#ffebee;color:#c62828}.cote-2{background:#fff3e0;color:#ef6c00}
        .cote-3{background:#fffde7;color:#f9a825}.cote-4{background:#e8f5e9;color:#2e7d32}.cote-5{background:#e3f2fd;color:#1565c0}
    </style>
</head>
<body>
    <aside class="sidebar">
        <div class="sidebar-header"><img src="logo-lbma.jpg" alt="LBMA"><h2>Admin LBMA</h2></div>
        <div class="user-info">
            <div>ConnectÃ©: <span class="username" id="currentUser">Admin</span></div>
            <button class="logout-btn" onclick="logout()">ğŸšª DÃ©connexion</button>
        </div>
        <nav>
            <div class="menu-section">Principal</div>
            <div class="menu-item active" onclick="showSection('dashboard',this)">ğŸ  Tableau de Bord</div>
            <div class="menu-section">Gestion</div>
            <div class="menu-item" onclick="showSection('joueursList',this)">ğŸƒ Joueurs (Liste)</div>
            <div class="menu-item" onclick="showSection('equipes',this)">ğŸ‘¥ Ã‰quipes & Joueurs</div>
            <div class="menu-item" onclick="showSection('calendrier',this)">ğŸ“… Calendrier</div>
            <div class="menu-item" onclick="showSection('temple',this)">ğŸ† Temple</div>
            <div class="menu-item" onclick="showSection('reglements',this)">ğŸ“‹ RÃ¨glements</div>
            <div class="menu-item" onclick="showSection('presse',this)">ğŸ“° MÃ©dias</div>
            <div class="menu-item" onclick="showSection('contacts',this)">ğŸ‘” Direction/Contacts</div>
            <div class="menu-section">RepÃªchage</div>
            <div class="menu-item" onclick="showSection('joueursRepechage',this)">ğŸ‘¥ Joueurs RepÃªchage</div>
            <div class="menu-section">Statistiques</div>
            <div class="menu-item" onclick="showSection('statsLanceurs',this)">ğŸ¯ Stats Lanceurs</div>
            <div class="menu-section">Live</div>
            <div class="menu-item" onclick="window.location.href='repechage-live.html'">ğŸ“‹ RepÃªchage</div>
            <div class="menu-item" onclick="window.location.href='stats-live.html'">ğŸ“Š Stats Live</div>
            <div class="menu-section superadmin-content">Super Admin</div>
            <div class="menu-item superadmin-only" onclick="showSection('users',this)">ğŸ” Utilisateurs</div>
            <div class="menu-section">Aide</div>
            <div class="menu-item" onclick="window.open('tutoriel.html','_blank')">ğŸ“– Tutoriel</div>
            <div class="menu-section">Voir le site</div>
            <div class="menu-item" onclick="window.open('joueurs.html','_blank')" style="opacity:.7">ğŸƒ Joueurs</div>
            <div class="menu-item" onclick="window.open('equipes.html','_blank')" style="opacity:.7">ğŸ‘¥ Ã‰quipes</div>
            <div class="menu-item" onclick="window.open('calendrier.html','_blank')" style="opacity:.7">ğŸ“… Calendrier</div>
            <div class="menu-item" onclick="window.open('temple-renommee.html','_blank')" style="opacity:.7">ğŸ† Temple</div>
        </nav>
        <div class="sidebar-footer" style="margin-top:auto;border-top:1px solid rgba(255,255,255,.2);padding-top:1rem">
            <a href="index.html" style="display:flex;align-items:center;gap:.5rem;background:var(--primary);padding:.5rem .75rem;border-radius:5px;margin-bottom:.5rem">ğŸ  Retour au site</a>
        </div>
    </aside>

    <main class="main-content">
        <!-- DASHBOARD -->
        <section id="dashboard" class="admin-section active">
            <div class="page-header"><h1>ğŸ  Tableau de Bord</h1></div>
            <div class="cards-grid">
                <div class="stat-card"><div class="number">6</div><div class="label">Ã‰quipes</div></div>
                <div class="stat-card"><div class="number" id="statJoueurs">0</div><div class="label">Joueurs</div></div>
                <div class="stat-card"><div class="number" id="statGames">0</div><div class="label">Parties</div></div>
                <div class="stat-card"><div class="number" id="statPlayed">0</div><div class="label">JouÃ©es</div></div>
            </div>
            <div class="content-box">
                <h2>âš¡ Actions Rapides</h2>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="showSection('equipes',document.querySelectorAll('.menu-item')[2])">ğŸ‘¥ Ã‰quipes</button>
                    <button class="btn btn-primary" onclick="showSection('calendrier',document.querySelectorAll('.menu-item')[3])">ğŸ“… Calendrier</button>
                    <a href="equipes.html" target="_blank" class="btn btn-success" style="text-decoration:none">ğŸŒ Voir Ã‰quipes</a>
                </div>
            </div>
        </section>

        <!-- JOUEURS (LISTE COMPLÃˆTE) -->
        <section id="joueursList" class="admin-section">
            <div class="page-header">
                <h1>ğŸƒ Liste des Joueurs <span id="joueursSaison">2025</span></h1>
                <p>GÃ©rez la liste complÃ¨te des joueurs avec toutes leurs informations</p>
            </div>
            
            <!-- Gestion des saisons joueurs -->
            <div class="content-box" style="background:linear-gradient(135deg,#1E3A5F 0%,#2D5A8A 100%);color:white;margin-bottom:1.5rem">
                <h2 style="color:var(--gold);border-bottom-color:rgba(255,255,255,0.3)">ğŸ“… Gestion des Saisons</h2>
                <p style="margin-bottom:1rem;opacity:0.9">Saison actuelle: <strong id="joueursSaisonLabel">2025</strong></p>
                <div class="btn-group">
                    <button class="btn btn-warning" onclick="archiverJoueurs()">ğŸ“¦ Archiver Joueurs</button>
                    <button class="btn btn-success" onclick="nouvelleSaisonJoueurs()">ğŸ†• Nouvelle Saison</button>
                    <button class="btn btn-primary" onclick="openModal('archivesJoueurs')">ğŸ“š Voir Archives</button>
                    <button class="btn btn-secondary" onclick="downloadJoueursJSON()">ğŸ’¾ TÃ©lÃ©charger JSON</button>
                </div>
            </div>
            
            <!-- Actions -->
            <div class="content-box">
                <h2>â• Actions</h2>
                <div class="btn-group">
                    <button class="btn btn-success" onclick="openJoueurListModal(-1)">â• Ajouter Joueur</button>
                    <a href="joueurs.html" target="_blank" class="btn btn-primary" style="text-decoration:none">ğŸŒ Voir Page Publique</a>
                </div>
            </div>
            
            <!-- LÃ©gende -->
            <div class="content-box">
                <h2>ğŸ“– LÃ©gende</h2>
                <div style="display:flex;flex-wrap:wrap;gap:1rem;margin-top:.5rem">
                    <span style="background:#28a745;color:white;padding:.3rem .6rem;border-radius:3px">ğŸ‘” Coach</span>
                    <span style="background:#ffc107;color:#333;padding:.3rem .6rem;border-radius:3px">âš™ï¸ Admin Ligue</span>
                    <span style="background:linear-gradient(135deg,#28a745 50%,#ffc107 50%);color:white;padding:.3rem .6rem;border-radius:3px">ğŸ‘”âš™ï¸ Coach+Admin</span>
                    <span style="background:var(--cream);padding:.3rem .6rem;border-radius:3px">Joueur</span>
                </div>
            </div>
            
            <!-- Filtres -->
            <div class="content-box">
                <h2>ğŸ” Filtres</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label>Rechercher</label>
                        <input type="text" id="adminSearchJoueur" placeholder="Nom..." oninput="renderJoueursList()">
                    </div>
                    <div class="form-group">
                        <label>Cote</label>
                        <select id="adminFilterCote" onchange="renderJoueursList()">
                            <option value="">Toutes</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>RÃ´le</label>
                        <select id="adminFilterRole" onchange="renderJoueursList()">
                            <option value="">Tous</option>
                            <option value="coach">Coach</option>
                            <option value="admin">Admin Ligue</option>
                            <option value="coachadmin">Coach + Admin</option>
                            <option value="joueur">Joueur</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- Table des joueurs -->
            <div class="content-box">
                <h2>ğŸ‘¥ Joueurs (<span id="joueursCount">0</span>)</h2>
                <div style="max-height:600px;overflow-y:auto">
                    <table class="data-table" id="joueursAdminTable">
                        <thead>
                            <tr>
                                <th>Nom</th>
                                <th>Cote</th>
                                <th>RÃ´le</th>
                                <th>TÃ©lÃ©phone</th>
                                <th>Courriel</th>
                                <th>Naissance</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="joueursAdminBody"></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Ã‰QUIPES & JOUEURS -->
        <section id="equipes" class="admin-section">
            <div class="page-header">
                <h1>ğŸ‘¥ Ã‰quipes & Joueurs <span id="saisonActuelle">2025</span></h1>
                <p>GÃ©rez les joueurs de chaque Ã©quipe</p>
            </div>
            
            <!-- Gestion des saisons -->
            <div class="content-box" style="background:linear-gradient(135deg,#1E3A5F 0%,#2D5A8A 100%);color:white;margin-bottom:1.5rem">
                <h2 style="color:var(--gold);border-bottom-color:rgba(255,255,255,0.3)">ğŸ“… Gestion des Saisons</h2>
                <p style="margin-bottom:1rem;opacity:0.9">Saison actuelle: <strong id="saisonLabel">2025</strong></p>
                <div class="btn-group">
                    <button class="btn btn-warning" onclick="archiverSaison()">ğŸ“¦ Archiver Saison Actuelle</button>
                    <button class="btn btn-success" onclick="nouvelleSaison()">ğŸ†• Nouvelle Saison</button>
                    <button class="btn btn-primary" onclick="openModal('archives')">ğŸ“š Voir Archives</button>
                    <button class="btn btn-secondary" onclick="downloadEquipesJSON()">ğŸ’¾ TÃ©lÃ©charger JSON</button>
                </div>
            </div>
            
            <div class="tabs" id="equipeTabs"></div>
            
            <div id="equipeContent"></div>
        </section>

        <!-- CALENDRIER -->
        <section id="calendrier" class="admin-section">
            <div class="page-header">
                <h1>ğŸ“… Calendrier des Parties</h1>
                <p>25 parties: vendredis soir + samedis matin + journÃ©es fÃ©riÃ©es</p>
            </div>
            
            <div class="content-box">
                <h2>â• Ajouter une Partie</h2>
                <div class="form-row">
                    <div class="form-group"><label>Date *</label><input type="date" id="newDate"></div>
                    <div class="form-group"><label>Jour</label>
                        <select id="newJour"><option value="SAMEDI">Samedi</option><option value="VENDREDI">Vendredi</option><option value="LUNDI">Lundi</option><option value="MARDI">Mardi</option></select>
                    </div>
                    <div class="form-group"><label>Heure *</label>
                        <select id="newHeure"><option value="8H30">8H30</option><option value="9H00">9H00</option><option value="10H00">10H00</option><option value="10H45">10H45</option><option value="11H30">11H30</option><option value="18H30">18H30</option><option value="20H00">20H00</option><option value="21H30">21H30</option></select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>Visiteur *</label>
                        <select id="newVisiteur"><option value="AIGLES">Aigles</option><option value="CONDORS">Condors</option><option value="DUCS">Ducs</option><option value="FAUCONS">Faucons</option><option value="HARFANGS">Harfangs</option><option value="VAUTOURS">Vautours</option></select>
                    </div>
                    <div class="form-group"><label>Receveur (Local) *</label>
                        <select id="newLocal"><option value="AIGLES">Aigles</option><option value="CONDORS">Condors</option><option value="DUCS">Ducs</option><option value="FAUCONS">Faucons</option><option value="HARFANGS">Harfangs</option><option value="VAUTOURS">Vautours</option></select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>Endroit *</label>
                        <select id="newEndroit"><option value="AUTEUIL">Auteuil</option><option value="JARRY 1">Jarry 1</option><option value="PARC DE LOUISBOURG">Parc de Louisbourg</option></select>
                    </div>
                    <div class="form-group"><label>SpÃ©cial</label>
                        <select id="newSpecial"><option value="">Aucune</option><option value="PATRIOTES">Patriotes</option><option value="ST-JEAN">St-Jean</option><option value="TRAVAIL">Travail</option></select>
                    </div>
                </div>
                <div class="btn-group"><button class="btn btn-success" onclick="addGame()">â• Ajouter</button></div>
            </div>

            <div class="content-box">
                <h2>ğŸ“‹ Parties (<span id="gameCount">0</span>)</h2>
                <div class="form-row" style="margin-bottom:.5rem">
                    <div class="form-group"><label>Mois</label><select id="filterMois" onchange="renderGames()"><option value="">Tous</option><option value="05">Mai</option><option value="06">Juin</option><option value="07">Juillet</option><option value="08">AoÃ»t</option><option value="09">Sept</option></select></div>
                </div>
                <div class="games-list" id="gamesList"></div>
            </div>
        </section>

        <!-- TEMPLE -->
        <section id="temple" class="admin-section">
            <div class="page-header"><h1>ğŸ† Temple de la RenommÃ©e</h1></div>
            
            <div class="alert alert-info">
                âš ï¸ Pour appliquer les modifications: <strong>TÃ©lÃ©chargez le JSON</strong> puis uploadez-le sur le serveur.
            </div>
            
            <div class="btn-group" style="margin-bottom:1rem">
                <button class="btn btn-warning" onclick="loadTempleFromServer()">ğŸ“¥ Charger depuis serveur</button>
                <button class="btn btn-success" onclick="downloadTempleJSON()">ğŸ’¾ TÃ©lÃ©charger JSON</button>
                <a href="temple-renommee.html" target="_blank" class="btn btn-primary" style="text-decoration:none">ğŸŒ Voir la page</a>
            </div>

            <div class="content-box">
                <h2>ğŸ—ï¸ BÃ¢tisseurs</h2>
                <div class="btn-group" style="margin-bottom:.5rem"><button class="btn btn-success" onclick="openTempleModal('batisseur')">â• Ajouter</button></div>
                <div id="batisseursList"></div>
            </div>
            
            <div class="content-box">
                <h2>ğŸ† TrophÃ©es PerpÃ©tuels</h2>
                <div class="btn-group" style="margin-bottom:.5rem"><button class="btn btn-success" onclick="openTempleModal('trophee')">â• Ajouter</button></div>
                <div id="tropheesList"></div>
            </div>
            
            <div class="content-box">
                <h2>ğŸ‘‘ Membres Ã  Vie</h2>
                <div class="btn-group" style="margin-bottom:.5rem"><button class="btn btn-success" onclick="openTempleModal('membre')">â• Ajouter</button></div>
                <div id="membresList"></div>
            </div>
            
            <div class="content-box">
                <h2>ğŸŒ³ Visite GuidÃ©e</h2>
                <div class="form-group"><label>Description</label><textarea id="visiteDesc" rows="2"></textarea></div>
                <div class="form-group"><label>Note</label><textarea id="visiteNote" rows="2"></textarea></div>
                <div class="btn-group"><button class="btn btn-primary" onclick="saveVisite()">ğŸ’¾ Sauvegarder</button></div>
            </div>
        </section>

        <!-- RÃˆGLEMENTS -->
        <section id="reglements" class="admin-section">
            <div class="page-header"><h1>ğŸ“‹ RÃ¨glements</h1></div>
            <div class="content-box">
                <div class="form-row">
                    <div class="form-group"><label>Version</label><input type="text" id="regVersion" value="2025"></div>
                    <div class="form-group"><label>Date MAJ</label><input type="date" id="regDate"></div>
                </div>
                <div class="btn-group"><button class="btn btn-success" onclick="saveReglements()">ğŸ’¾</button><a href="reglements.html" target="_blank" class="btn btn-primary" style="text-decoration:none">ğŸŒ Voir</a></div>
            </div>
        </section>

        <!-- MÃ‰DIAS -->
        <section id="presse" class="admin-section">
            <div class="page-header"><h1>ğŸ“° MÃ©dias</h1></div>
            <div class="content-box">
                <h2>ğŸ“° Articles</h2>
                <div class="btn-group" style="margin-bottom:.5rem"><button class="btn btn-success" onclick="openModal('article')">â•</button></div>
                <div id="articlesList"></div>
            </div>
            <div class="content-box">
                <h2>ğŸ™ï¸ Podcasts</h2>
                <div class="btn-group" style="margin-bottom:.5rem"><button class="btn btn-success" onclick="openModal('podcast')">â•</button></div>
                <div id="podcastsList"></div>
            </div>
        </section>

        <!-- UTILISATEURS -->
        <section id="users" class="admin-section">
            <div class="page-header"><h1>ğŸ” Utilisateurs</h1></div>
            <div class="content-box">
                <div class="btn-group" style="margin-bottom:.5rem"><button class="btn btn-success" onclick="openModal('user')">â•</button></div>
                <table class="data-table"><thead><tr><th>User</th><th>Nom</th><th>RÃ´le</th><th>Actions</th></tr></thead><tbody id="usersList"></tbody></table>
            </div>
        </section>

        <!-- JOUEURS REPÃŠCHAGE (Supabase) -->
        <section id="joueursRepechage" class="admin-section">
            <div class="page-header">
                <h1>ğŸ‘¥ Joueurs RepÃªchage (Supabase)</h1>
                <p>GÃ©rer la liste des joueurs disponibles pour le repÃªchage</p>
            </div>

            <div class="content-box" style="background:linear-gradient(135deg,#1E3A5F 0%,#2D5A8A 100%);color:white">
                <h2 style="color:var(--gold);border-bottom-color:rgba(255,255,255,0.3)">ğŸ“… Saison</h2>
                <div class="form-row" style="align-items:flex-end">
                    <div class="form-group">
                        <label style="color:white">Saison</label>
                        <select id="jrSaison" onchange="loadJoueursRepechage()" style="color:var(--dark)">
                            <option value="2026">2026</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label style="color:white">Stats</label>
                        <div id="jrStats" style="font-family:'Oswald',sans-serif;font-size:1rem">â€”</div>
                    </div>
                </div>
            </div>

            <div class="content-box">
                <h2>â• Actions</h2>
                <div class="btn-group">
                    <button class="btn btn-success" onclick="openJrModal(-1)">â• Ajouter Joueur</button>
                    <button class="btn btn-warning" onclick="copierSaisonJr()">ğŸ“‹ Copier vers nouvelle saison</button>
                    <a href="repechage-live.html" target="_blank" class="btn btn-primary" style="text-decoration:none">ğŸ”´ RepÃªchage Live</a>
                </div>
            </div>

            <div class="content-box">
                <h2>ğŸ” Filtres</h2>
                <div class="form-row">
                    <div class="form-group"><label>Rechercher</label><input type="text" id="jrSearch" placeholder="Nom..." oninput="renderJrTable()"></div>
                    <div class="form-group"><label>Cote</label>
                        <select id="jrFilterCote" onchange="renderJrTable()"><option value="">Toutes</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option></select>
                    </div>
                    <div class="form-group"><label>Actif</label>
                        <select id="jrFilterActif" onchange="renderJrTable()"><option value="true">Actifs</option><option value="false">Inactifs</option><option value="">Tous</option></select>
                    </div>
                </div>
            </div>

            <div class="content-box">
                <h2>ğŸ‘¥ Joueurs (<span id="jrCount">0</span>)</h2>
                <div style="max-height:500px;overflow-y:auto">
                    <table class="data-table" id="jrTable">
                        <thead><tr>
                            <th>Nom</th><th>Cote</th><th>RÃ´le</th><th>TÃ©l</th><th>Courriel</th><th>Actif</th><th>Actions</th>
                        </tr></thead>
                        <tbody id="jrBody"></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Modal Joueur RepÃªchage -->
        <div id="jrEditModal" class="modal">
            <div class="modal-content" style="max-width:600px">
                <div class="modal-header" style="background:var(--gold);color:var(--dark)"><h2>ğŸ‘¥ Joueur RepÃªchage</h2><button class="modal-close" onclick="closeModal('jrEdit')" style="color:var(--dark)">Ã—</button></div>
                <div class="modal-body">
                    <input type="hidden" id="jrEditId">
                    <div class="form-row">
                        <div class="form-group" style="flex:2"><label>Nom complet *</label><input type="text" id="jrEditNom" placeholder="Nom, PrÃ©nom"></div>
                        <div class="form-group"><label>Cote *</label>
                            <select id="jrEditCote"><option value="1">1</option><option value="2">2</option><option value="3" selected>3</option><option value="4">4</option><option value="5">5</option></select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>RÃ´le</label>
                            <select id="jrEditRole"><option value="joueur">Joueur</option><option value="coach">ğŸ‘” Coach</option><option value="admin">âš™ï¸ Admin</option><option value="coachadmin">ğŸ‘”âš™ï¸ Coach+Admin</option></select>
                        </div>
                        <div class="form-group"><label>Actif</label>
                            <select id="jrEditActif"><option value="true">âœ… Oui</option><option value="false">âŒ Non</option></select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>TÃ©lÃ©phone 1</label><input type="tel" id="jrEditTel1" placeholder="514-XXX-XXXX"></div>
                        <div class="form-group"><label>TÃ©lÃ©phone 2</label><input type="tel" id="jrEditTel2" placeholder="514-XXX-XXXX"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>Courriel</label><input type="email" id="jrEditCourriel" placeholder="email@exemple.com"></div>
                        <div class="form-group"><label>Naissance</label><input type="text" id="jrEditNaissance" placeholder="1 janv 1980"></div>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-success" onclick="saveJrEdit()">ğŸ’¾ Sauvegarder</button>
                        <button class="btn btn-secondary" onclick="closeModal('jrEdit')">Annuler</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- STATS LANCEURS (Supabase) -->
        <section id="statsLanceurs" class="admin-section">
            <div class="page-header">
                <h1>ğŸ¯ Stats Lanceurs (Supabase)</h1>
                <p>Modifier les statistiques des lanceurs directement dans la base de donnÃ©es</p>
            </div>

            <div class="content-box">
                <h2>ğŸ” Filtres</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label>Saison</label>
                        <select id="lanceurSaison" onchange="loadLanceurStats()">
                            <option value="">-- Choisir --</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Rechercher</label>
                        <input type="text" id="lanceurSearch" placeholder="Nom..." oninput="filterLanceurTable()">
                    </div>
                </div>
            </div>

            <div class="content-box">
                <h2>ğŸ“Š Lanceurs (<span id="lanceurCount">0</span>)</h2>
                <div id="lanceurMessage" style="display:none;padding:.5rem;background:#cce5ff;border-left:4px solid var(--primary);margin-bottom:.5rem;font-size:.8rem"></div>
                <div style="max-height:500px;overflow-y:auto">
                    <table class="data-table" id="lanceurTable">
                        <thead>
                            <tr>
                                <th>Nom</th>
                                <th>Ã‰Q</th>
                                <th>Cote</th>
                                <th>A/B</th>
                                <th>PL</th>
                                <th>V</th>
                                <th>D</th>
                                <th>N</th>
                                <th>PC</th>
                                <th>CS</th>
                                <th>BB</th>
                                <th>K</th>
                                <th>MOY</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="lanceurBody"></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Modal Lanceur Edit -->
        <div id="lanceurEditModal" class="modal">
            <div class="modal-content" style="max-width:600px">
                <div class="modal-header" style="background:var(--accent)"><h2>ğŸ¯ Modifier Lanceur</h2><button class="modal-close" onclick="closeModal('lanceurEdit')">Ã—</button></div>
                <div class="modal-body">
                    <input type="hidden" id="lanceurEditId">
                    <div class="form-row">
                        <div class="form-group"><label>Nom</label><input type="text" id="lanceurEditNom"></div>
                        <div class="form-group"><label>Saison</label><input type="text" id="lanceurEditSaison" readonly style="background:#ddd"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>Ã‰quipe</label>
                            <select id="lanceurEditEquipe">
                                <option value="">-</option>
                                <option value="AI">AI (Aigles)</option>
                                <option value="CO">CO (Condors)</option>
                                <option value="DU">DU (Ducs)</option>
                                <option value="FA">FA (Faucons)</option>
                                <option value="HA">HA (Harfangs)</option>
                                <option value="VA">VA (Vautours)</option>
                                <option value="GD">GD (Gds Ducs)</option>
                                <option value="Ã‰P">Ã‰P (Ã‰perviers)</option>
                            </select>
                        </div>
                        <div class="form-group"><label>Cote</label>
                            <select id="lanceurEditCote">
                                <option value="">-</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                            </select>
                        </div>
                        <div class="form-group"><label>Type A/B</label>
                            <select id="lanceurEditType">
                                <option value="">-</option>
                                <option value="A">A (Partant)</option>
                                <option value="B">B (Releveur)</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>PL</label><input type="number" id="lanceurEditPL" min="0"></div>
                        <div class="form-group"><label>ML</label><input type="number" id="lanceurEditML" min="0" step="0.01"></div>
                        <div class="form-group"><label>V</label><input type="number" id="lanceurEditV" min="0"></div>
                        <div class="form-group"><label>D</label><input type="number" id="lanceurEditD" min="0"></div>
                        <div class="form-group"><label>N</label><input type="number" id="lanceurEditN" min="0"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>PC</label><input type="number" id="lanceurEditPC" min="0"></div>
                        <div class="form-group"><label>CS</label><input type="number" id="lanceurEditCS" min="0"></div>
                        <div class="form-group"><label>BB</label><input type="number" id="lanceurEditBB" min="0"></div>
                        <div class="form-group"><label>RB (K)</label><input type="number" id="lanceurEditRB" min="0"></div>
                        <div class="form-group"><label>MOY</label><input type="number" id="lanceurEditMOY" min="0" step="0.001"></div>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-success" onclick="saveLanceurEdit()">ğŸ’¾ Sauvegarder</button>
                        <button class="btn btn-secondary" onclick="closeModal('lanceurEdit')">Annuler</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- CONTACTS / DIRECTION -->
        <section id="contacts" class="admin-section">
            <div class="page-header"><h1>ğŸ‘” Direction / Contacts</h1></div>
            
            <div class="alert alert-info">
                âš ï¸ Pour appliquer les modifications: <strong>TÃ©lÃ©chargez le JSON</strong> puis uploadez-le sur le serveur comme <code>contacts-data.json</code>.
            </div>
            
            <div class="btn-group" style="margin-bottom:1rem">
                <button class="btn btn-warning" onclick="loadContactsFromServer()">ğŸ“¥ Charger depuis serveur</button>
                <button class="btn btn-success" onclick="downloadContactsJSON()">ğŸ’¾ TÃ©lÃ©charger JSON</button>
                <a href="contact.html" target="_blank" class="btn btn-primary" style="text-decoration:none">ğŸŒ Voir la page</a>
            </div>
            
            <div class="content-box">
                <h2>âš™ï¸ Configuration de la Page</h2>
                <div class="form-group">
                    <label>Titre de la page</label>
                    <input type="text" id="contactsPageTitre" value="Direction LBMA" placeholder="Ex: Direction LBMA">
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="contactsPageDesc" rows="2" placeholder="Description affichÃ©e en haut de la page"></textarea>
                </div>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="saveContactsConfig()">ğŸ’¾ Sauvegarder Config</button>
                </div>
            </div>

            <div class="content-box">
                <h2>ğŸ‘¥ Membres de la Direction (<span id="contactsCount">0</span>)</h2>
                <div class="btn-group" style="margin-bottom:1rem">
                    <button class="btn btn-success" onclick="openContactModal(-1)">â• Ajouter un Contact</button>
                </div>
                <div id="contactsList"></div>
            </div>
        </section>
    </main>

    <!-- MODALS -->
    <div id="joueurModal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h2>ğŸƒ Joueur</h2><button class="modal-close" onclick="closeModal('joueur')">Ã—</button></div>
            <div class="modal-body">
                <input type="hidden" id="joueurEquipe">
                <input type="hidden" id="joueurIdx" value="-1">
                <input type="hidden" id="joueurIsCoach" value="false">
                <div class="form-group"><label>Nom complet *</label><input type="text" id="joueurNom" placeholder="Nom, PrÃ©nom"></div>
                <div class="form-group"><label>Cote *</label>
                    <select id="joueurCote">
                        <option value="1">1 - DÃ©butant</option>
                        <option value="2">2 - IntermÃ©diaire</option>
                        <option value="3" selected>3 - RÃ©gulier</option>
                        <option value="4">4 - AvancÃ©</option>
                        <option value="5">5 - Ã‰lite</option>
                    </select>
                </div>
                <div class="btn-group">
                    <button class="btn btn-success" onclick="saveJoueur()">ğŸ’¾ Sauvegarder</button>
                    <button class="btn btn-secondary" onclick="closeModal('joueur')">Annuler</button>
                </div>
            </div>
        </div>
    </div>

    <div id="coachModal" class="modal">
        <div class="modal-content">
            <div class="modal-header" style="background:var(--gold)"><h2>ğŸ‘” Coach</h2><button class="modal-close" onclick="closeModal('coach')">Ã—</button></div>
            <div class="modal-body">
                <input type="hidden" id="coachEquipe">
                <div class="alert alert-info">
                    <strong>ğŸ’¡ Info:</strong> Le coach est aussi considÃ©rÃ© comme joueur dans l'alignement. Sa cote compte dans le total de l'Ã©quipe.
                </div>
                <div class="form-group"><label>Nom complet du Coach *</label><input type="text" id="coachNom" placeholder="Nom, PrÃ©nom"></div>
                <div class="form-group"><label>Cote *</label>
                    <select id="coachCote">
                        <option value="1">1 - DÃ©butant</option>
                        <option value="2">2 - IntermÃ©diaire</option>
                        <option value="3" selected>3 - RÃ©gulier</option>
                        <option value="4">4 - AvancÃ©</option>
                        <option value="5">5 - Ã‰lite</option>
                    </select>
                </div>
                <div class="btn-group">
                    <button class="btn btn-success" onclick="saveCoach()">ğŸ’¾ Sauvegarder Coach</button>
                    <button class="btn btn-secondary" onclick="closeModal('coach')">Annuler</button>
                </div>
            </div>
        </div>
    </div>

    <div id="archivesModal" class="modal">
        <div class="modal-content" style="max-width:800px">
            <div class="modal-header" style="background:var(--primary)"><h2>ğŸ“š Archives des Saisons</h2><button class="modal-close" onclick="closeModal('archives')">Ã—</button></div>
            <div class="modal-body">
                <div id="archivesList"></div>
                <div class="btn-group" style="margin-top:1rem">
                    <button class="btn btn-warning" onclick="downloadAllArchives()">ğŸ’¾ TÃ©lÃ©charger Toutes les Archives</button>
                    <button class="btn btn-secondary" onclick="closeModal('archives')">Fermer</button>
                </div>
            </div>
        </div>
    </div>

    <div id="archiveDetailModal" class="modal">
        <div class="modal-content" style="max-width:900px">
            <div class="modal-header" style="background:var(--gold)"><h2>ğŸ“‹ DÃ©tails Saison <span id="archiveDetailSaison"></span></h2><button class="modal-close" onclick="closeModal('archiveDetail')">Ã—</button></div>
            <div class="modal-body" id="archiveDetailContent" style="max-height:70vh;overflow-y:auto"></div>
        </div>
    </div>

    <div id="gameModal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h2>ğŸ“… Modifier Partie</h2><button class="modal-close" onclick="closeModal('game')">Ã—</button></div>
            <div class="modal-body">
                <input type="hidden" id="gameId">
                <div class="form-row">
                    <div class="form-group"><label>Date</label><input type="date" id="gameDate"></div>
                    <div class="form-group"><label>Heure</label><select id="gameHeure"><option value="8H30">8H30</option><option value="9H00">9H00</option><option value="10H00">10H00</option><option value="10H45">10H45</option><option value="11H30">11H30</option><option value="18H30">18H30</option><option value="20H00">20H00</option><option value="21H30">21H30</option></select></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>Visiteur</label><select id="gameVisiteur"><option value="AIGLES">Aigles</option><option value="CONDORS">Condors</option><option value="DUCS">Ducs</option><option value="FAUCONS">Faucons</option><option value="HARFANGS">Harfangs</option><option value="VAUTOURS">Vautours</option></select></div>
                    <div class="form-group"><label>Score V</label><input type="number" id="gameScoreV" min="0"></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>Local</label><select id="gameLocal"><option value="AIGLES">Aigles</option><option value="CONDORS">Condors</option><option value="DUCS">Ducs</option><option value="FAUCONS">Faucons</option><option value="HARFANGS">Harfangs</option><option value="VAUTOURS">Vautours</option></select></div>
                    <div class="form-group"><label>Score L</label><input type="number" id="gameScoreL" min="0"></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>Endroit</label><select id="gameEndroit"><option value="AUTEUIL">Auteuil</option><option value="JARRY 1">Jarry 1</option><option value="PARC DE LOUISBOURG">Louisbourg</option></select></div>
                    <div class="form-group"><label>Status</label><select id="gameStatus"><option value="avenir">Ã€ venir</option><option value="final">Final</option></select></div>
                </div>
                <div class="btn-group"><button class="btn btn-success" onclick="saveGame()">ğŸ’¾</button><button class="btn btn-secondary" onclick="closeModal('game')">Annuler</button></div>
            </div>
        </div>
    </div>

    <div id="batisseurModal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h2>ğŸ—ï¸ BÃ¢tisseur</h2><button class="modal-close" onclick="closeModal('batisseur')">Ã—</button></div>
            <div class="modal-body">
                <input type="hidden" id="batisseurId">
                <div class="form-group"><label>Nom</label><input type="text" id="batisseurNom"></div>
                <div class="form-group"><label>Description</label><input type="text" id="batisseurDesc"></div>
                <div class="btn-group"><button class="btn btn-success" onclick="saveBatisseur()">ğŸ’¾</button></div>
            </div>
        </div>
    </div>

    <div id="tropheeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header" style="background:var(--gold);color:var(--dark)"><h2>ğŸ† TrophÃ©e</h2><button class="modal-close" onclick="closeModal('trophee')" style="color:var(--dark)">Ã—</button></div>
            <div class="modal-body">
                <input type="hidden" id="tropheeId">
                <div class="form-group"><label>Nom (personne honorÃ©e)</label><input type="text" id="tropheeNom"></div>
                <div class="form-group"><label>TrophÃ©e (nom du prix)</label><input type="text" id="tropheePrix"></div>
                <div class="form-group"><label>IcÃ´ne</label><select id="tropheeIcon">
                    <option value="ğŸ…">ğŸ… MÃ©daille</option>
                    <option value="ğŸ›¡ï¸">ğŸ›¡ï¸ Bouclier</option>
                    <option value="ğŸ“‹">ğŸ“‹ Clipboard</option>
                    <option value="âš¾">âš¾ Baseball</option>
                    <option value="ğŸ¯">ğŸ¯ Cible</option>
                    <option value="ğŸŒŸ">ğŸŒŸ Ã‰toile</option>
                    <option value="â¤ï¸">â¤ï¸ Coeur</option>
                    <option value="ğŸŒ±">ğŸŒ± Pousse</option>
                    <option value="ğŸ¤">ğŸ¤ PoignÃ©e</option>
                    <option value="ğŸ†">ğŸ† TrophÃ©e</option>
                </select></div>
                <div class="btn-group"><button class="btn btn-success" onclick="saveTrophee()">ğŸ’¾</button></div>
            </div>
        </div>
    </div>

    <div id="membreModal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h2>ğŸ‘‘ Membre Ã  Vie</h2><button class="modal-close" onclick="closeModal('membre')">Ã—</button></div>
            <div class="modal-body">
                <input type="hidden" id="membreId">
                <div class="form-group"><label>Nom</label><input type="text" id="membreNom"></div>
                <div class="btn-group"><button class="btn btn-success" onclick="saveMembre()">ğŸ’¾</button></div>
            </div>
        </div>
    </div>

    <div id="articleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h2>ğŸ“° Article</h2><button class="modal-close" onclick="closeModal('article')">Ã—</button></div>
            <div class="modal-body">
                <input type="hidden" id="articleId">
                <div class="form-group"><label>Titre</label><input type="text" id="articleTitre"></div>
                <div class="form-group"><label>Date</label><input type="date" id="articleDate"></div>
                <div class="form-group"><label>Extrait</label><textarea id="articleExtrait" rows="2"></textarea></div>
                <div class="form-group"><label>Lien</label><input type="url" id="articleLien"></div>
                <div class="btn-group"><button class="btn btn-success" onclick="saveArticle()">ğŸ’¾</button></div>
            </div>
        </div>
    </div>

    <div id="podcastModal" class="modal">
        <div class="modal-content">
            <div class="modal-header" style="background:#8B5CF6"><h2>ğŸ™ï¸ Podcast</h2><button class="modal-close" onclick="closeModal('podcast')">Ã—</button></div>
            <div class="modal-body">
                <input type="hidden" id="podcastId">
                <div class="form-group"><label>Nom</label><input type="text" id="podcastTitre"></div>
                <div class="form-row"><div class="form-group"><label>Ã‰pisode</label><input type="text" id="podcastEpisode"></div><div class="form-group"><label>Date</label><input type="date" id="podcastDate"></div></div>
                <div class="form-group"><label>Description</label><textarea id="podcastDesc" rows="2"></textarea></div>
                <div class="form-row"><div class="form-group"><label>DurÃ©e</label><input type="text" id="podcastDuree"></div><div class="form-group"><label>Plateforme</label><input type="text" id="podcastPlateforme"></div></div>
                <div class="form-group"><label>Lien</label><input type="url" id="podcastLien"></div>
                <div class="btn-group"><button class="btn btn-success" onclick="savePodcast()">ğŸ’¾</button></div>
            </div>
        </div>
    </div>

    <div id="userModal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h2>ğŸ” Utilisateur</h2><button class="modal-close" onclick="closeModal('user')">Ã—</button></div>
            <div class="modal-body">
                <input type="hidden" id="userIdx" value="-1">
                <div class="form-group"><label>Username</label><input type="text" id="userUsername"></div>
                <div class="form-group"><label>Mot de passe</label><input type="text" id="userPassword"></div>
                <div class="form-group"><label>Nom</label><input type="text" id="userNom"></div>
                <div class="form-group"><label>RÃ´le</label><select id="userRole"><option value="coach">Coach (lecture seule)</option><option value="admin">Administrateur</option><option value="superadmin">Super Admin</option></select></div>
                <div class="btn-group"><button class="btn btn-success" onclick="saveUser()">ğŸ’¾</button></div>
            </div>
        </div>
    </div>

    <!-- Modal Contact -->
    <div id="contactModal" class="modal">
        <div class="modal-content" style="max-width:650px">
            <div class="modal-header" style="background:var(--gold);color:var(--dark)"><h2>ğŸ‘” Contact Direction</h2><button class="modal-close" onclick="closeModal('contact')" style="color:var(--dark)">Ã—</button></div>
            <div class="modal-body">
                <input type="hidden" id="contactIdx" value="-1">
                <div class="form-row">
                    <div class="form-group" style="flex:2">
                        <label>Nom complet *</label>
                        <input type="text" id="contactNom" placeholder="Ex: Michel Plante">
                    </div>
                    <div class="form-group">
                        <label>Ordre d'affichage</label>
                        <input type="number" id="contactOrdre" value="1" min="1">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Titre *</label>
                        <input type="text" id="contactTitre" placeholder="Ex: Directeur">
                    </div>
                    <div class="form-group">
                        <label>Sous-titre (optionnel)</label>
                        <input type="text" id="contactSousTitre" placeholder="Ex: PrÃ©sident">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>TÃ©lÃ©phone</label>
                        <input type="tel" id="contactTelephone" placeholder="Ex: 514-123-4567">
                    </div>
                    <div class="form-group">
                        <label>Courriel</label>
                        <input type="email" id="contactCourriel" placeholder="Ex: nom@email.com">
                    </div>
                </div>
                <div class="form-group">
                    <label>ResponsabilitÃ©s (une par ligne)</label>
                    <textarea id="contactResponsabilites" rows="5" placeholder="RÃ©servation des parcs&#10;Organisation des rÃ©unions&#10;Collecte des cotisations"></textarea>
                </div>
                <div class="btn-group">
                    <button class="btn btn-success" onclick="saveContact()">ğŸ’¾ Sauvegarder</button>
                    <button class="btn btn-secondary" onclick="closeModal('contact')">Annuler</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Joueur Liste (avec infos complÃ¨tes) -->
    <div id="joueurListModal" class="modal">
        <div class="modal-content" style="max-width:600px">
            <div class="modal-header" style="background:#28a745"><h2>ğŸƒ Joueur</h2><button class="modal-close" onclick="closeModal('joueurList')">Ã—</button></div>
            <div class="modal-body">
                <input type="hidden" id="joueurListIdx" value="-1">
                <div class="form-row">
                    <div class="form-group" style="flex:2"><label>Nom complet *</label><input type="text" id="joueurListNom" placeholder="NOM PRÃ‰NOM"></div>
                    <div class="form-group"><label>Cote *</label>
                        <select id="joueurListCote">
                            <option value="1">1 - DÃ©butant</option>
                            <option value="2">2 - IntermÃ©diaire</option>
                            <option value="3" selected>3 - RÃ©gulier</option>
                            <option value="4">4 - AvancÃ©</option>
                            <option value="5">5 - Ã‰lite</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>RÃ´le</label>
                        <select id="joueurListRole">
                            <option value="joueur">Joueur</option>
                            <option value="coach">ğŸ‘” Coach</option>
                            <option value="admin">âš™ï¸ Admin Ligue</option>
                            <option value="coachadmin">ğŸ‘”âš™ï¸ Coach + Admin</option>
                        </select>
                    </div>
                    <div class="form-group"><label>Date de naissance</label><input type="text" id="joueurListNaissance" placeholder="1 janv 1980"></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>TÃ©lÃ©phone 1</label><input type="tel" id="joueurListTel1" placeholder="514-123-4567"></div>
                    <div class="form-group"><label>TÃ©lÃ©phone 2</label><input type="tel" id="joueurListTel2" placeholder="514-123-4567"></div>
                </div>
                <div class="form-group"><label>Courriel</label><input type="email" id="joueurListCourriel" placeholder="email@exemple.com"></div>
                <div class="btn-group">
                    <button class="btn btn-success" onclick="saveJoueurList()">ğŸ’¾ Sauvegarder</button>
                    <button class="btn btn-secondary" onclick="closeModal('joueurList')">Annuler</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Archives Joueurs -->
    <div id="archivesJoueursModal" class="modal">
        <div class="modal-content" style="max-width:800px">
            <div class="modal-header" style="background:var(--primary)"><h2>ğŸ“š Archives des Joueurs</h2><button class="modal-close" onclick="closeModal('archivesJoueurs')">Ã—</button></div>
            <div class="modal-body">
                <div id="archivesJoueursList"></div>
                <div class="btn-group" style="margin-top:1rem">
                    <button class="btn btn-warning" onclick="downloadAllArchivesJoueurs()">ğŸ’¾ TÃ©lÃ©charger Toutes</button>
                    <button class="btn btn-secondary" onclick="closeModal('archivesJoueurs')">Fermer</button>
                </div>
            </div>
        </div>
    </div>

    <div id="confirmModal" class="modal">
        <div class="modal-content" style="max-width:280px">
            <div class="modal-header danger"><h2>âš ï¸</h2><button class="modal-close" onclick="closeModal('confirm')">Ã—</button></div>
            <div class="modal-body" style="text-align:center">
                <p id="confirmMsg" style="margin-bottom:.75rem"></p>
                <div class="btn-group" style="justify-content:center"><button class="btn btn-danger" onclick="doConfirm()">OK</button><button class="btn btn-secondary" onclick="closeModal('confirm')">Annuler</button></div>
            </div>
        </div>
    </div>

    <script>
        const KEYS = {
            session: 'lbma_admin_session',
            users: 'lbma_admin_users',
            equipes: 'lbma_equipes_2025',
            temple: 'lbma_temple_renommee',
            reglements: 'lbma_reglements',
            presse: 'lbma_revue_presse',
            calendrier: 'lbma_calendrier_2025',
            archives: 'lbma_archives_equipes',
            joueurs: 'lbma_joueurs_2026',
            archivesJoueurs: 'lbma_archives_joueurs',
            contacts: 'lbma_contacts'
        };
        
        let session, users, equipes, temple, reglements, presse, calendrier, archives, joueursList, archivesJoueurs, contacts, confirmCb;
        let currentTeam = 'AIGLES';
        
        const defUsers = [
            {username:'admin',password:'Squ1dl33',role:'superadmin',nom:'Super Administrateur'},
            {username:'schausse',password:'Squ1dl33',role:'superadmin',nom:'Serge ChaussÃ©'},
            {username:'pchartrand',password:'Pas2Pat!',role:'admin',nom:'Patrick Chartrand'},
            {username:'kbeauregard',password:'Pas2Keith!',role:'admin',nom:'Keith Beauregard'}
        ];
        const defTemple = {batisseurs:[{id:1,nom:"Robert Auclair",description:"Fondateur"}]};
        const defReglements = {version:"2025",lastUpdate:"2025-01-01"};
        const defPresse = {articles:[],podcasts:[]};
        const defCalendrier = {saison:"2025",parties:[]};
        const defArchives = {saisons:[]};
        const defEquipes = {
            saison:"2025",
            equipes:[
                {id:"AIGLES",nom:"Aigles",coach:"Beauregard, Keith",coachCote:3,joueurs:[{nom:"MÃ©nabo, Marc",cote:4},{nom:"Jasmin-Riel, Danick",cote:5},{nom:"Taddeo, Luke",cote:5},{nom:"Bureau, Robert",cote:3},{nom:"Beaudoin, StÃ©phane",cote:3},{nom:"SÃ©nÃ©cal, GÃ©rald",cote:3},{nom:"Garcia, Mathieu",cote:2},{nom:"Guerrera, Joe",cote:2},{nom:"Colati, Michael",cote:1},{nom:"Resler, Eric",cote:2}]},
                {id:"CONDORS",nom:"Condors",coach:"Bibeau, Alexandre",coachCote:4,joueurs:[{nom:"ChaussÃ©, Serge",cote:3},{nom:"Longtin, Sylvain",cote:4},{nom:"Dorrington, Kevin",cote:4},{nom:"Carballada, Sacha",cote:3},{nom:"LafreniÃ¨re, Ã‰ric",cote:3},{nom:"St-Onge Lachapelle, Francis",cote:3},{nom:"David, Daniel",cote:2},{nom:"Latour, Jonathan",cote:2},{nom:"Borges, Quinn",cote:2},{nom:"Saint-Georges, Derek",cote:1}]},
                {id:"DUCS",nom:"Ducs",coach:"Brisebois, Guy",coachCote:4,joueurs:[{nom:"Noel, Jean-Christophe",cote:3},{nom:"Robillard, Hugo",cote:5},{nom:"Beaudry, Steve",cote:4},{nom:"Trempe, Sasha",cote:3},{nom:"LarivÃ©e, StÃ©phane",cote:4},{nom:"Garcia, Edgar",cote:3},{nom:"Massamiri, Antony",cote:2},{nom:"Chartrand, Patrick",cote:2},{nom:"Forgues, Sylvain",cote:2},{nom:"Plante, Michel",cote:1}]},
                {id:"FAUCONS",nom:"Faucons",coach:"HÃ©tu, StÃ©phane",coachCote:3,joueurs:[{nom:"HÃ©tu, FÃ©lix",cote:4},{nom:"Monette, David",cote:4},{nom:"Ouellet-DorÃ©, Mathieu",cote:4},{nom:"Jean-Lachapelle, JÃ©rÃ©mie",cote:3},{nom:"St-Martin, AndrÃ©",cote:3},{nom:"LaverdiÃ¨re, Philippe",cote:4},{nom:"Boivin, Carl-Olivier",cote:2},{nom:"Doyon, Guyllaume",cote:2},{nom:"Turcot, SÃ©bastien",cote:2},{nom:"Saint-Georges, Sylvain",cote:1}]},
                {id:"HARFANGS",nom:"Harfangs",coach:"Hammarrenger, Benoit",coachCote:5,joueurs:[{nom:"Vaillancourt, Olivier",cote:2},{nom:"Lamontagne, Sylvain",cote:4},{nom:"Dorrington, Jason",cote:4},{nom:"Stabile, John",cote:3},{nom:"Santo, Joe",cote:3},{nom:"Heppell, StÃ©phane",cote:2},{nom:"De Michele, Giovanni",cote:2},{nom:"Marchand, SÃ©bastien",cote:2},{nom:"Bonin, Pierre",cote:2},{nom:"Roberge, Vincent",cote:2}]},
                {id:"VAUTOURS",nom:"Vautours",coach:"MÃ©nard, Michel",coachCote:2,joueurs:[{nom:"Francoeur, Mathieu",cote:5},{nom:"Collard, Ã‰ric",cote:5},{nom:"ThÃ©riault, JÃ©rÃ©my",cote:3},{nom:"Ciarlo, Gino",cote:3},{nom:"Proulx, StÃ©phane",cote:5},{nom:"Lambert, Martin",cote:3},{nom:"St-Onge, Bruno",cote:1},{nom:"Charbonneau, Daniel",cote:2},{nom:"Poulin, Christian",cote:2},{nom:"Michaud, Jean-David",cote:1}]}
            ]
        };
        
        function checkSession(){const s=localStorage.getItem(KEYS.session);if(!s){window.location.href='login.html';return false}session=JSON.parse(s);if(session.expires<Date.now()){localStorage.removeItem(KEYS.session);window.location.href='login.html';return false}document.getElementById('currentUser').textContent=session.nom||session.user;if(session.role==='superadmin')document.body.classList.add('is-superadmin');return true}
        function logout(){localStorage.removeItem(KEYS.session);window.location.href='login.html'}
        function load(key,def){const s=localStorage.getItem(key);if(s)try{return JSON.parse(s)}catch(e){}return JSON.parse(JSON.stringify(def))}
        function save(key,data){localStorage.setItem(key,JSON.stringify(data))}
        
        function init(){
            if(!checkSession())return;
            users=load(KEYS.users,defUsers);
            equipes=load(KEYS.equipes,defEquipes);
            temple=load(KEYS.temple,defTemple);
            reglements=load(KEYS.reglements,defReglements);
            presse=load(KEYS.presse,defPresse);
            calendrier=load(KEYS.calendrier,defCalendrier);
            archives=load(KEYS.archives,defArchives);
            archivesJoueurs=load(KEYS.archivesJoueurs,{saisons:[]});
            loadJoueursList();
            loadContacts();
            updateSaisonDisplay();
            initLanceurSaisons();
            initJrSaisons();
            renderAll();
        }
        
        // === CHARGEMENT JOUEURS DEPUIS JSON ===
        async function loadJoueursList(){
            try {
                // Essayer de charger depuis localStorage d'abord
                const saved = localStorage.getItem(KEYS.joueurs);
                if(saved){
                    joueursList = JSON.parse(saved);
                } else {
                    // Sinon charger depuis le fichier JSON
                    const response = await fetch('joueurs-2026.json');
                    joueursList = await response.json();
                    save(KEYS.joueurs, joueursList);
                }
                updateJoueursSaisonDisplay();
                renderJoueursList();
            } catch(e) {
                console.error('Erreur chargement joueurs:', e);
                joueursList = {saison:'2026', joueurs:[]};
            }
        }
        
        function updateSaisonDisplay(){
            const saison=equipes.saison||'2025';
            document.getElementById('saisonActuelle').textContent=saison;
            document.getElementById('saisonLabel').textContent=saison;
        }
        
        function updateJoueursSaisonDisplay(){
            const saison=joueursList?.saison||'2025';
            document.getElementById('joueursSaison').textContent=saison;
            document.getElementById('joueursSaisonLabel').textContent=saison;
        }
        
        function renderAll(){renderEquipeTabs();renderEquipeContent();renderGames();renderTemple();renderArticles();renderPodcasts();renderUsers();renderJoueursList();renderContacts();updateStats()}
        
        function updateStats(){
            let totalJoueurs=0;
            equipes.equipes.forEach(e=>totalJoueurs+=e.joueurs.length);
            document.getElementById('statJoueurs').textContent=totalJoueurs;
            document.getElementById('statGames').textContent=calendrier.parties?.length||0;
            document.getElementById('statPlayed').textContent=(calendrier.parties||[]).filter(g=>g.status==='final').length;
        }
        
        function showSection(id,el){
            if(id==='users'&&session.role!=='superadmin')return toast('AccÃ¨s refusÃ©','danger');
            document.querySelectorAll('.admin-section').forEach(s=>s.classList.remove('active'));
            document.querySelectorAll('.menu-item').forEach(m=>m.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(el)el.classList.add('active');
        }
        function openModal(id){document.getElementById(id+'Modal').classList.add('active')}
        function closeModal(id){document.getElementById(id+'Modal').classList.remove('active')}
        function toast(msg,type){const t=document.createElement('div');t.className='toast toast-'+type;t.textContent=msg;document.body.appendChild(t);setTimeout(()=>t.remove(),2500)}
        function confirm(msg,cb){document.getElementById('confirmMsg').textContent=msg;confirmCb=cb;openModal('confirm')}
        function doConfirm(){if(confirmCb)confirmCb();closeModal('confirm');confirmCb=null}

        // === Ã‰QUIPES ===
        function renderEquipeTabs(){
            document.getElementById('equipeTabs').innerHTML=equipes.equipes.map(e=>`<div class="tab team-tab ${e.id} ${e.id===currentTeam?'active':''}" onclick="switchTeam('${e.id}')">${e.nom}</div>`).join('');
        }
        
        function switchTeam(id){currentTeam=id;renderEquipeTabs();renderEquipeContent()}
        
        function renderEquipeContent(){
            const eq=equipes.equipes.find(e=>e.id===currentTeam);
            if(!eq)return;
            const totalCote=eq.joueurs.reduce((s,j)=>s+j.cote,0);
            const coach=eq.joueurs.find(j=>j.isCoach);
            const joueursNonCoach=eq.joueurs.filter(j=>!j.isCoach);
            const joueursSorted=[...eq.joueurs].sort((a,b)=>{
                if(a.isCoach) return -1;
                if(b.isCoach) return 1;
                return b.cote-a.cote||a.nom.localeCompare(b.nom);
            });
            
            document.getElementById('equipeContent').innerHTML=`
                <div class="content-box">
                    <h2><span class="team-color ${eq.id}">${eq.nom}</span></h2>
                    <p style="margin-bottom:1rem">Total cotes: <strong>${totalCote}</strong> | ${eq.joueurs.length} joueurs (coach inclus)</p>
                    
                    <!-- Section Coach -->
                    <div style="background:rgba(212,175,55,0.15);border:2px solid var(--gold);padding:1rem;margin-bottom:1rem;border-radius:5px">
                        <h3 style="font-family:'Oswald',sans-serif;color:var(--gold);margin-bottom:.75rem">ğŸ‘” COACH DE L'Ã‰QUIPE</h3>
                        ${coach ? `
                            <p style="font-size:1.1rem;margin-bottom:.75rem">
                                <strong>${coach.nom}</strong> 
                                <span class="cote-badge cote-${coach.cote}" style="margin-left:.5rem">${coach.cote}</span>
                            </p>
                            <div class="btn-group">
                                <button class="btn btn-primary btn-small" onclick="openCoachModal('${eq.id}')">âœï¸ Modifier Coach</button>
                                <button class="btn btn-warning btn-small" onclick="promoteToCoach('${eq.id}')">ğŸ”„ Changer Coach (joueur existant)</button>
                                <button class="btn btn-danger btn-small" onclick="removeCoach('${eq.id}')">ğŸ—‘ï¸ Retirer Coach</button>
                            </div>
                        ` : `
                            <p style="color:#666;margin-bottom:.75rem">âš ï¸ Aucun coach assignÃ©</p>
                            <div class="btn-group">
                                <button class="btn btn-success btn-small" onclick="openCoachModal('${eq.id}')">â• Ajouter Nouveau Coach</button>
                                ${joueursNonCoach.length > 0 ? `<button class="btn btn-warning btn-small" onclick="promoteToCoach('${eq.id}')">ğŸ”„ Promouvoir un Joueur</button>` : ''}
                            </div>
                        `}
                    </div>
                    
                    <div class="btn-group" style="margin-bottom:1rem">
                        <button class="btn btn-success" onclick="openJoueurModal('${eq.id}',-1,false)">â• Ajouter Joueur</button>
                        <button class="btn btn-warning" onclick="downloadEquipesJSON()">ğŸ’¾ TÃ©lÃ©charger JSON</button>
                    </div>
                    <table class="data-table">
                        <thead><tr><th>Nom</th><th>Cote</th><th>RÃ´le</th><th>Actions</th></tr></thead>
                        <tbody>
                            ${joueursSorted.map((j,i)=>{
                                const realIdx=eq.joueurs.findIndex(x=>x.nom===j.nom);
                                return `<tr style="${j.isCoach?'background:rgba(212,175,55,0.2)':''}">
                                    <td>${j.nom}</td>
                                    <td><span class="cote-badge cote-${j.cote}">${j.cote}</span></td>
                                    <td>${j.isCoach?'ğŸ‘” <strong>Coach</strong>':'Joueur'}</td>
                                    <td class="action-btns">
                                        <button class="btn btn-primary btn-small" onclick="openJoueurModal('${eq.id}',${realIdx},${j.isCoach||false})">âœï¸</button>
                                        ${!j.isCoach?`<button class="btn btn-danger btn-small" onclick="deleteJoueur('${eq.id}',${realIdx})">ğŸ—‘ï¸</button>`:``}
                                    </td>
                                </tr>`;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }
        
        function downloadEquipesJSON(){
            const saison=equipes.saison||'2025';
            const json=JSON.stringify(equipes,null,2);
            const blob=new Blob([json],{type:'application/json'});
            const url=URL.createObjectURL(blob);
            const a=document.createElement('a');a.href=url;a.download=`equipes-${saison}.json`;a.click();
            URL.revokeObjectURL(url);toast('JSON tÃ©lÃ©chargÃ©!','success');
        }
        
        // === GESTION DES SAISONS ET ARCHIVES ===
        function archiverSaison(){
            const saison=equipes.saison||'2025';
            // VÃ©rifier si cette saison est dÃ©jÃ  archivÃ©e
            const existingIdx=archives.saisons.findIndex(a=>a.saison===saison);
            if(existingIdx>=0){
                confirm(`La saison ${saison} est dÃ©jÃ  archivÃ©e. Voulez-vous la remplacer?`,()=>{
                    archives.saisons[existingIdx]={
                        saison:saison,
                        dateArchive:new Date().toISOString(),
                        equipes:JSON.parse(JSON.stringify(equipes.equipes))
                    };
                    save(KEYS.archives,archives);
                    toast(`Saison ${saison} mise Ã  jour dans les archives!`,'success');
                });
            }else{
                archives.saisons.push({
                    saison:saison,
                    dateArchive:new Date().toISOString(),
                    equipes:JSON.parse(JSON.stringify(equipes.equipes))
                });
                save(KEYS.archives,archives);
                toast(`Saison ${saison} archivÃ©e avec succÃ¨s!`,'success');
            }
        }
        
        function nouvelleSaison(){
            const saisonActuelle=equipes.saison||'2025';
            const nouvelleSaison=prompt('Entrez l\'annÃ©e de la nouvelle saison:',String(parseInt(saisonActuelle)+1));
            if(!nouvelleSaison)return;
            if(!/^\d{4}$/.test(nouvelleSaison)){toast('Format invalide (ex: 2026)','danger');return;}
            
            // VÃ©rifier si la saison actuelle a Ã©tÃ© archivÃ©e
            const isArchived=archives.saisons.some(a=>a.saison===saisonActuelle);
            
            const doReset=()=>{
                // CrÃ©er les Ã©quipes vides pour la nouvelle saison
                equipes.saison=nouvelleSaison;
                equipes.equipes.forEach(eq=>{
                    eq.joueurs=[];
                });
                save(KEYS.equipes,equipes);
                updateSaisonDisplay();
                renderEquipeTabs();
                renderEquipeContent();
                updateStats();
                toast(`Nouvelle saison ${nouvelleSaison} crÃ©Ã©e! Ajoutez vos joueurs.`,'success');
            };
            
            if(!isArchived){
                confirm(`âš ï¸ La saison ${saisonActuelle} n'est pas archivÃ©e! Voulez-vous l'archiver avant de crÃ©er la saison ${nouvelleSaison}?`,()=>{
                    archiverSaison();
                    doReset();
                });
            }else{
                confirm(`CrÃ©er la saison ${nouvelleSaison}? Toutes les Ã©quipes seront vidÃ©es.`,doReset);
            }
        }
        
        function renderArchivesList(){
            const container=document.getElementById('archivesList');
            if(archives.saisons.length===0){
                container.innerHTML='<p style="color:#666;text-align:center;padding:2rem">ğŸ“­ Aucune saison archivÃ©e</p>';
                return;
            }
            // Trier par saison dÃ©croissante
            const sorted=[...archives.saisons].sort((a,b)=>b.saison.localeCompare(a.saison));
            container.innerHTML=sorted.map(arch=>{
                const nbJoueurs=arch.equipes.reduce((sum,eq)=>sum+eq.joueurs.length,0);
                const date=new Date(arch.dateArchive).toLocaleDateString('fr-CA');
                return `
                    <div class="item-card" style="background:var(--cream)">
                        <div style="flex:1">
                            <h4 style="font-size:1.1rem">ğŸ† Saison ${arch.saison}</h4>
                            <p style="font-size:.8rem;color:#666">ArchivÃ©e le ${date} â€¢ ${nbJoueurs} joueurs â€¢ 6 Ã©quipes</p>
                        </div>
                        <div class="action-btns">
                            <button class="btn btn-primary btn-small" onclick="voirArchive('${arch.saison}')">ğŸ‘ï¸ Voir</button>
                            <button class="btn btn-warning btn-small" onclick="downloadArchive('${arch.saison}')">ğŸ’¾ JSON</button>
                            <button class="btn btn-danger btn-small" onclick="supprimerArchive('${arch.saison}')">ğŸ—‘ï¸</button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function voirArchive(saison){
            const arch=archives.saisons.find(a=>a.saison===saison);
            if(!arch)return;
            document.getElementById('archiveDetailSaison').textContent=saison;
            let html='';
            arch.equipes.forEach(eq=>{
                const coach=eq.joueurs.find(j=>j.isCoach);
                const joueurs=eq.joueurs.filter(j=>!j.isCoach);
                const total=eq.joueurs.reduce((s,j)=>s+j.cote,0);
                html+=`
                    <div style="margin-bottom:1.5rem;border:2px solid var(--dark);background:var(--white)">
                        <div style="background:var(--primary);color:white;padding:.75rem 1rem">
                            <strong>${eq.nom.toUpperCase()}</strong>
                            ${coach?`<span style="opacity:.8;margin-left:1rem">ğŸ‘” ${coach.nom} (${coach.cote})</span>`:''}
                            <span style="float:right">Total: ${total}</span>
                        </div>
                        <div style="padding:.75rem">
                            ${joueurs.map(j=>`<span style="display:inline-block;background:var(--cream);padding:.2rem .5rem;margin:.2rem;border-radius:3px">${j.nom} <span class="cote-badge cote-${j.cote}" style="padding:.1rem .3rem;font-size:.7rem">${j.cote}</span></span>`).join('')}
                        </div>
                    </div>
                `;
            });
            document.getElementById('archiveDetailContent').innerHTML=html;
            closeModal('archives');
            openModal('archiveDetail');
        }
        
        function downloadArchive(saison){
            const arch=archives.saisons.find(a=>a.saison===saison);
            if(!arch)return;
            const data={saison:arch.saison,equipes:arch.equipes};
            const json=JSON.stringify(data,null,2);
            const blob=new Blob([json],{type:'application/json'});
            const url=URL.createObjectURL(blob);
            const a=document.createElement('a');a.href=url;a.download=`equipes-${saison}.json`;a.click();
            URL.revokeObjectURL(url);toast(`Archive ${saison} tÃ©lÃ©chargÃ©e!`,'success');
        }
        
        function downloadAllArchives(){
            const json=JSON.stringify(archives,null,2);
            const blob=new Blob([json],{type:'application/json'});
            const url=URL.createObjectURL(blob);
            const a=document.createElement('a');a.href=url;a.download='lbma-archives-equipes.json';a.click();
            URL.revokeObjectURL(url);toast('Toutes les archives tÃ©lÃ©chargÃ©es!','success');
        }
        
        function supprimerArchive(saison){
            confirm(`Supprimer dÃ©finitivement l'archive de la saison ${saison}?`,()=>{
                archives.saisons=archives.saisons.filter(a=>a.saison!==saison);
                save(KEYS.archives,archives);
                renderArchivesList();
                toast(`Archive ${saison} supprimÃ©e`,'success');
            });
        }
        
        // Override openModal pour rafraÃ®chir les archives
        const originalOpenModal=openModal;
        function openModal(id){
            if(id==='archives')renderArchivesList();
            document.getElementById(id+'Modal').classList.add('active');
        }
        
        // === GESTION DU COACH ===
        function openCoachModal(equipeId){
            const eq=equipes.equipes.find(e=>e.id===equipeId);
            const coach=eq.joueurs.find(j=>j.isCoach);
            document.getElementById('coachEquipe').value=equipeId;
            if(coach){
                document.getElementById('coachNom').value=coach.nom;
                document.getElementById('coachCote').value=coach.cote;
            }else{
                document.getElementById('coachNom').value='';
                document.getElementById('coachCote').value='3';
            }
            openModal('coach');
        }
        
        function saveCoach(){
            const equipeId=document.getElementById('coachEquipe').value;
            const nom=document.getElementById('coachNom').value.trim();
            const cote=parseInt(document.getElementById('coachCote').value);
            if(!nom)return toast('Nom requis!','danger');
            
            const eq=equipes.equipes.find(e=>e.id===equipeId);
            const existingCoachIdx=eq.joueurs.findIndex(j=>j.isCoach);
            
            if(existingCoachIdx>=0){
                // Mise Ã  jour du coach existant
                eq.joueurs[existingCoachIdx].nom=nom;
                eq.joueurs[existingCoachIdx].cote=cote;
            }else{
                // Ajouter nouveau coach
                eq.joueurs.unshift({nom,cote,isCoach:true});
            }
            
            save(KEYS.equipes,equipes);
            renderEquipeContent();
            updateStats();
            closeModal('coach');
            toast('Coach sauvegardÃ©!','success');
        }
        
        function removeCoach(equipeId){
            confirm('Retirer le coach de l\'Ã©quipe? (Il sera complÃ¨tement supprimÃ©)',()=>{
                const eq=equipes.equipes.find(e=>e.id===equipeId);
                eq.joueurs=eq.joueurs.filter(j=>!j.isCoach);
                save(KEYS.equipes,equipes);
                renderEquipeContent();
                updateStats();
                toast('Coach retirÃ©!','success');
            });
        }
        
        function promoteToCoach(equipeId){
            const eq=equipes.equipes.find(e=>e.id===equipeId);
            const joueurs=eq.joueurs.filter(j=>!j.isCoach);
            if(joueurs.length===0){toast('Aucun joueur disponible','danger');return;}
            
            // CrÃ©er une liste pour le select
            const options=joueurs.map(j=>`${j.nom} (cote ${j.cote})`).join('\n');
            const newCoachNom=prompt('SÃ©lectionner le nouveau coach (entrez le nom exact):\n\n'+options);
            if(!newCoachNom)return;
            
            const newCoach=eq.joueurs.find(j=>j.nom===newCoachNom && !j.isCoach);
            if(!newCoach){
                // Essayer de trouver par nom partiel
                const found=eq.joueurs.find(j=>j.nom.toLowerCase().includes(newCoachNom.toLowerCase()) && !j.isCoach);
                if(!found){toast('Joueur non trouvÃ©','danger');return;}
                const oldCoach=eq.joueurs.find(j=>j.isCoach);
                if(oldCoach)oldCoach.isCoach=false;
                found.isCoach=true;
            }else{
                const oldCoach=eq.joueurs.find(j=>j.isCoach);
                if(oldCoach)oldCoach.isCoach=false;
                newCoach.isCoach=true;
            }
            save(KEYS.equipes,equipes);
            renderEquipeContent();
            toast('Coach changÃ©!','success');
        }
        
        function openJoueurModal(equipeId,idx,isCoach=false){
            document.getElementById('joueurEquipe').value=equipeId;
            document.getElementById('joueurIdx').value=idx;
            document.getElementById('joueurIsCoach').value=isCoach?'true':'false';
            if(idx>=0){
                const eq=equipes.equipes.find(e=>e.id===equipeId);
                const j=eq.joueurs[idx];
                document.getElementById('joueurNom').value=j.nom;
                document.getElementById('joueurCote').value=j.cote;
            }else{
                document.getElementById('joueurNom').value='';
                document.getElementById('joueurCote').value='3';
            }
            openModal('joueur');
        }
        
        function saveJoueur(){
            const equipeId=document.getElementById('joueurEquipe').value;
            const idx=parseInt(document.getElementById('joueurIdx').value);
            const nom=document.getElementById('joueurNom').value.trim();
            const cote=parseInt(document.getElementById('joueurCote').value);
            const isCoach=document.getElementById('joueurIsCoach').value==='true';
            if(!nom)return toast('Nom requis!','danger');
            
            const eq=equipes.equipes.find(e=>e.id===equipeId);
            if(idx>=0){eq.joueurs[idx]={nom,cote,isCoach}}
            else{eq.joueurs.push({nom,cote,isCoach:false})}
            
            save(KEYS.equipes,equipes);
            renderEquipeContent();
            updateStats();
            closeModal('joueur');
            toast('Joueur sauvegardÃ©!','success');
        }
        
        function deleteJoueur(equipeId,idx){
            confirm('Supprimer ce joueur?',()=>{
                const eq=equipes.equipes.find(e=>e.id===equipeId);
                eq.joueurs.splice(idx,1);
                save(KEYS.equipes,equipes);
                renderEquipeContent();
                updateStats();
                toast('SupprimÃ©!','success');
            });
        }

        // === CALENDRIER ===
        function renderGames(){
            const mois=document.getElementById('filterMois')?.value||'';
            let games=calendrier.parties||[];
            if(mois)games=games.filter(g=>g.date.split('-')[1]===mois);
            games.sort((a,b)=>a.date.localeCompare(b.date)||a.heure.localeCompare(b.heure));
            document.getElementById('gameCount').textContent=games.length;
            document.getElementById('gamesList').innerHTML=games.map(g=>`
                <div class="item-card">
                    <div style="flex:1">
                        <strong>#${g.id}</strong> ${g.jour} ${g.date} <strong>${g.heure}</strong>
                        ${g.special?'<span class="status-badge ferie">'+g.special+'</span>':''}
                        <br><span class="team-color ${g.visiteur}">${g.visiteur}</span> ${g.scoreV!==null?g.scoreV:''} vs ${g.scoreL!==null?g.scoreL:''} <span class="team-color ${g.local}">${g.local}</span>
                        <span style="color:#888;font-size:.75rem">@ ${g.endroit}</span>
                    </div>
                    <div class="action-btns">
                        <span class="status-badge ${g.status}">${g.status==='final'?'FINAL':'Ã€ VENIR'}</span>
                        <button class="btn btn-primary btn-small" onclick="editGame(${g.id})">âœï¸</button>
                        <button class="btn btn-danger btn-small" onclick="deleteGame(${g.id})">ğŸ—‘ï¸</button>
                    </div>
                </div>
            `).join('')||'<p>Aucune partie</p>';
        }
        
        function addGame(){
            const date=document.getElementById('newDate').value;
            if(!date)return toast('Date requise!','danger');
            const visiteur=document.getElementById('newVisiteur').value;
            const local=document.getElementById('newLocal').value;
            if(visiteur===local)return toast('Ã‰quipes diffÃ©rentes!','danger');
            const maxId=Math.max(0,...(calendrier.parties||[]).map(g=>g.id));
            calendrier.parties.push({
                id:maxId+1,date,jour:document.getElementById('newJour').value,heure:document.getElementById('newHeure').value,
                visiteur,local,scoreV:null,scoreL:null,endroit:document.getElementById('newEndroit').value,
                status:'avenir',special:document.getElementById('newSpecial').value
            });
            save(KEYS.calendrier,calendrier);renderGames();updateStats();toast('Partie ajoutÃ©e!','success');
            document.getElementById('newDate').value='';
        }
        
        function editGame(id){
            const g=calendrier.parties.find(x=>x.id===id);if(!g)return;
            document.getElementById('gameId').value=id;
            document.getElementById('gameDate').value=g.date;
            document.getElementById('gameHeure').value=g.heure;
            document.getElementById('gameVisiteur').value=g.visiteur;
            document.getElementById('gameLocal').value=g.local;
            document.getElementById('gameScoreV').value=g.scoreV!==null?g.scoreV:'';
            document.getElementById('gameScoreL').value=g.scoreL!==null?g.scoreL:'';
            document.getElementById('gameEndroit').value=g.endroit;
            document.getElementById('gameStatus').value=g.status;
            openModal('game');
        }
        
        function saveGame(){
            const id=parseInt(document.getElementById('gameId').value);
            const idx=calendrier.parties.findIndex(g=>g.id===id);if(idx<0)return;
            const sv=document.getElementById('gameScoreV').value;
            const sl=document.getElementById('gameScoreL').value;
            Object.assign(calendrier.parties[idx],{
                date:document.getElementById('gameDate').value,heure:document.getElementById('gameHeure').value,
                visiteur:document.getElementById('gameVisiteur').value,local:document.getElementById('gameLocal').value,
                scoreV:sv!==''?parseInt(sv):null,scoreL:sl!==''?parseInt(sl):null,
                endroit:document.getElementById('gameEndroit').value,status:document.getElementById('gameStatus').value
            });
            save(KEYS.calendrier,calendrier);renderGames();updateStats();closeModal('game');toast('OK','success');
        }
        
        function deleteGame(id){confirm('Supprimer?',()=>{calendrier.parties=calendrier.parties.filter(g=>g.id!==id);save(KEYS.calendrier,calendrier);renderGames();updateStats();toast('OK','success')})}

        // === TEMPLE ===
        function openTempleModal(type){
            if(type==='batisseur'){document.getElementById('batisseurId').value='';document.getElementById('batisseurNom').value='';document.getElementById('batisseurDesc').value='';openModal('batisseur')}
            else if(type==='trophee'){document.getElementById('tropheeId').value='';document.getElementById('tropheeNom').value='';document.getElementById('tropheePrix').value='';document.getElementById('tropheeIcon').value='ğŸ†';openModal('trophee')}
            else if(type==='membre'){document.getElementById('membreId').value='';document.getElementById('membreNom').value='';openModal('membre')}
        }
        function loadTempleFromServer(){
            fetch('temple-data.json').then(r=>r.json()).then(data=>{
                temple=data;save(KEYS.temple,temple);renderTemple();toast('ChargÃ© depuis serveur!','success');
            }).catch(e=>toast('Erreur chargement','danger'));
        }
        function downloadTempleJSON(){
            const json=JSON.stringify(temple,null,2);
            const blob=new Blob([json],{type:'application/json'});
            const url=URL.createObjectURL(blob);
            const a=document.createElement('a');a.href=url;a.download='temple-data.json';a.click();
            URL.revokeObjectURL(url);toast('JSON tÃ©lÃ©chargÃ©!','success');
        }
        function renderTemple(){renderBatisseurs();renderTrophees();renderMembres();renderVisiteForm()}
        function renderBatisseurs(){document.getElementById('batisseursList').innerHTML=(temple.batisseurs||[]).map(b=>`<div class="item-card"><h4>â­ ${b.nom}</h4><p>${b.description||''}</p><div class="action-btns"><button class="btn btn-primary btn-small" onclick="editBatisseur(${b.id})">âœï¸</button><button class="btn btn-danger btn-small" onclick="deleteBatisseur(${b.id})">ğŸ—‘ï¸</button></div></div>`).join('')||'<p>Aucun bÃ¢tisseur</p>'}
        function editBatisseur(id){const b=temple.batisseurs.find(x=>x.id===id);if(!b)return;document.getElementById('batisseurId').value=id;document.getElementById('batisseurNom').value=b.nom;document.getElementById('batisseurDesc').value=b.description||'';openModal('batisseur')}
        function saveBatisseur(){const id=document.getElementById('batisseurId').value;const nom=document.getElementById('batisseurNom').value.trim();if(!nom)return toast('Nom requis','danger');const d={nom,description:document.getElementById('batisseurDesc').value.trim()};if(id){const i=temple.batisseurs.findIndex(b=>b.id===parseInt(id));if(i>-1)temple.batisseurs[i]={...temple.batisseurs[i],...d}}else{if(!temple.batisseurs)temple.batisseurs=[];temple.batisseurs.push({id:Date.now(),...d})}save(KEYS.temple,temple);renderBatisseurs();closeModal('batisseur');toast('OK','success')}
        function deleteBatisseur(id){confirm('Supprimer ce bÃ¢tisseur?',()=>{temple.batisseurs=temple.batisseurs.filter(b=>b.id!==id);save(KEYS.temple,temple);renderBatisseurs();toast('SupprimÃ©','success')})}
        
        function renderTrophees(){document.getElementById('tropheesList').innerHTML=(temple.trophees||[]).map(t=>`<div class="item-card"><h4>${t.icon||'ğŸ†'} ${t.nom}</h4><p>${t.trophee||''}</p><div class="action-btns"><button class="btn btn-primary btn-small" onclick="editTrophee(${t.id})">âœï¸</button><button class="btn btn-danger btn-small" onclick="deleteTrophee(${t.id})">ğŸ—‘ï¸</button></div></div>`).join('')||'<p>Aucun trophÃ©e</p>'}
        function editTrophee(id){const t=temple.trophees.find(x=>x.id===id);if(!t)return;document.getElementById('tropheeId').value=id;document.getElementById('tropheeNom').value=t.nom;document.getElementById('tropheePrix').value=t.trophee||'';document.getElementById('tropheeIcon').value=t.icon||'ğŸ†';openModal('trophee')}
        function saveTrophee(){const id=document.getElementById('tropheeId').value;const nom=document.getElementById('tropheeNom').value.trim();if(!nom)return toast('Nom requis','danger');const d={nom,trophee:document.getElementById('tropheePrix').value.trim(),icon:document.getElementById('tropheeIcon').value};if(id){const i=temple.trophees.findIndex(t=>t.id===parseInt(id));if(i>-1)temple.trophees[i]={...temple.trophees[i],...d}}else{if(!temple.trophees)temple.trophees=[];temple.trophees.push({id:Date.now(),...d})}save(KEYS.temple,temple);renderTrophees();closeModal('trophee');toast('OK','success')}
        function deleteTrophee(id){confirm('Supprimer ce trophÃ©e?',()=>{temple.trophees=temple.trophees.filter(t=>t.id!==id);save(KEYS.temple,temple);renderTrophees();toast('SupprimÃ©','success')})}
        
        function renderMembres(){document.getElementById('membresList').innerHTML=(temple.membres||[]).map(m=>`<div class="item-card"><h4>ğŸ‘‘ ${m.nom}</h4><div class="action-btns"><button class="btn btn-primary btn-small" onclick="editMembre(${m.id})">âœï¸</button><button class="btn btn-danger btn-small" onclick="deleteMembre(${m.id})">ğŸ—‘ï¸</button></div></div>`).join('')||'<p>Aucun membre</p>'}
        function editMembre(id){const m=temple.membres.find(x=>x.id===id);if(!m)return;document.getElementById('membreId').value=id;document.getElementById('membreNom').value=m.nom;openModal('membre')}
        function saveMembre(){const id=document.getElementById('membreId').value;const nom=document.getElementById('membreNom').value.trim();if(!nom)return toast('Nom requis','danger');if(id){const i=temple.membres.findIndex(m=>m.id===parseInt(id));if(i>-1)temple.membres[i].nom=nom}else{if(!temple.membres)temple.membres=[];temple.membres.push({id:Date.now(),nom})}save(KEYS.temple,temple);renderMembres();closeModal('membre');toast('OK','success')}
        function deleteMembre(id){confirm('Supprimer ce membre?',()=>{temple.membres=temple.membres.filter(m=>m.id!==id);save(KEYS.temple,temple);renderMembres();toast('SupprimÃ©','success')})}
        
        function renderVisiteForm(){if(!temple.visite)temple.visite={description:'',note:'',horaires:[]};document.getElementById('visiteDesc').value=temple.visite.description||'';document.getElementById('visiteNote').value=temple.visite.note||''}
        function saveVisite(){if(!temple.visite)temple.visite={horaires:[]};temple.visite.description=document.getElementById('visiteDesc').value;temple.visite.note=document.getElementById('visiteNote').value;save(KEYS.temple,temple);toast('Visite sauvegardÃ©e','success')}

        // === RÃˆGLEMENTS ===
        function saveReglements(){reglements.version=document.getElementById('regVersion').value;reglements.lastUpdate=document.getElementById('regDate').value;save(KEYS.reglements,reglements);toast('OK','success')}

        // === ARTICLES ===
        function renderArticles(){document.getElementById('articlesList').innerHTML=(presse.articles||[]).map(a=>`<div class="item-card"><h4>ğŸ“° ${a.titre}</h4><div class="action-btns"><button class="btn btn-primary btn-small" onclick="editArticle(${a.id})">âœï¸</button><button class="btn btn-danger btn-small" onclick="deleteArticle(${a.id})">ğŸ—‘ï¸</button></div></div>`).join('')||'Aucun'}
        function editArticle(id){const a=presse.articles.find(x=>x.id===id);if(!a)return;document.getElementById('articleId').value=id;document.getElementById('articleTitre').value=a.titre;document.getElementById('articleDate').value=a.date||'';document.getElementById('articleExtrait').value=a.extrait||'';document.getElementById('articleLien').value=a.lien||'';openModal('article')}
        function saveArticle(){const id=document.getElementById('articleId').value;const titre=document.getElementById('articleTitre').value.trim();if(!titre)return toast('Requis','danger');const d={titre,date:document.getElementById('articleDate').value,extrait:document.getElementById('articleExtrait').value,lien:document.getElementById('articleLien').value};if(!presse.articles)presse.articles=[];if(id){const i=presse.articles.findIndex(a=>a.id===parseInt(id));if(i>-1)presse.articles[i]={...presse.articles[i],...d}}else presse.articles.push({id:Date.now(),...d});save(KEYS.presse,presse);renderArticles();closeModal('article');document.getElementById('articleId').value='';document.getElementById('articleTitre').value='';toast('OK','success')}
        function deleteArticle(id){confirm('Supprimer?',()=>{presse.articles=presse.articles.filter(a=>a.id!==id);save(KEYS.presse,presse);renderArticles();toast('OK','success')})}

        // === PODCASTS ===
        function renderPodcasts(){document.getElementById('podcastsList').innerHTML=(presse.podcasts||[]).map(p=>`<div class="item-card"><h4>ğŸ™ï¸ ${p.titre} ${p.episode||''}</h4><div class="action-btns"><button class="btn btn-primary btn-small" onclick="editPodcast(${p.id})">âœï¸</button><button class="btn btn-danger btn-small" onclick="deletePodcast(${p.id})">ğŸ—‘ï¸</button></div></div>`).join('')||'Aucun'}
        function editPodcast(id){const p=presse.podcasts.find(x=>x.id===id);if(!p)return;document.getElementById('podcastId').value=id;document.getElementById('podcastTitre').value=p.titre;document.getElementById('podcastEpisode').value=p.episode||'';document.getElementById('podcastDate').value=p.date||'';document.getElementById('podcastDesc').value=p.description||'';document.getElementById('podcastDuree').value=p.duree||'';document.getElementById('podcastPlateforme').value=p.plateforme||'';document.getElementById('podcastLien').value=p.lien||'';openModal('podcast')}
        function savePodcast(){const id=document.getElementById('podcastId').value;const titre=document.getElementById('podcastTitre').value.trim();if(!titre)return toast('Requis','danger');const d={titre,episode:document.getElementById('podcastEpisode').value,date:document.getElementById('podcastDate').value,description:document.getElementById('podcastDesc').value,duree:document.getElementById('podcastDuree').value,plateforme:document.getElementById('podcastPlateforme').value,lien:document.getElementById('podcastLien').value};if(!presse.podcasts)presse.podcasts=[];if(id){const i=presse.podcasts.findIndex(p=>p.id===parseInt(id));if(i>-1)presse.podcasts[i]={...presse.podcasts[i],...d}}else presse.podcasts.push({id:Date.now(),...d});save(KEYS.presse,presse);renderPodcasts();closeModal('podcast');document.getElementById('podcastId').value='';document.getElementById('podcastTitre').value='';toast('OK','success')}
        function deletePodcast(id){confirm('Supprimer?',()=>{presse.podcasts=presse.podcasts.filter(p=>p.id!==id);save(KEYS.presse,presse);renderPodcasts();toast('OK','success')})}

        // === USERS ===
        function renderUsers(){if(session.role!=='superadmin')return;document.getElementById('usersList').innerHTML=users.map((u,i)=>`<tr><td>${u.username}</td><td>${u.nom}</td><td>${u.role}</td><td class="action-btns"><button class="btn btn-primary btn-small" onclick="editUser(${i})">âœï¸</button>${users.filter(x=>x.role==='superadmin').length>1||u.role!=='superadmin'?`<button class="btn btn-danger btn-small" onclick="deleteUser(${i})">ğŸ—‘ï¸</button>`:''}</td></tr>`).join('')}
        function editUser(idx){const u=users[idx];document.getElementById('userIdx').value=idx;document.getElementById('userUsername').value=u.username;document.getElementById('userPassword').value=u.password;document.getElementById('userNom').value=u.nom;document.getElementById('userRole').value=u.role;openModal('user')}
        function saveUser(){const idx=parseInt(document.getElementById('userIdx').value);const d={username:document.getElementById('userUsername').value.trim().toLowerCase(),password:document.getElementById('userPassword').value,nom:document.getElementById('userNom').value.trim(),role:document.getElementById('userRole').value};if(!d.username||!d.password||d.password.length<6)return toast('Requis (mdp 6+)','danger');if(idx>=0)users[idx]=d;else users.push(d);save(KEYS.users,users);renderUsers();closeModal('user');document.getElementById('userIdx').value='-1';toast('OK','success')}
        function deleteUser(idx){confirm('Supprimer?',()=>{users.splice(idx,1);save(KEYS.users,users);renderUsers();toast('OK','success')})}

        // === JOUEURS LISTE ===
        function renderJoueursList(){
            if(!joueursList || !joueursList.joueurs) return;
            
            const search = (document.getElementById('adminSearchJoueur')?.value || '').toLowerCase();
            const filterCote = document.getElementById('adminFilterCote')?.value || '';
            const filterRole = document.getElementById('adminFilterRole')?.value || '';
            
            let filtered = joueursList.joueurs.filter(j => {
                if(search && !j.nom.toLowerCase().includes(search)) return false;
                if(filterCote && j.cote != filterCote) return false;
                if(filterRole && j.role !== filterRole) return false;
                return true;
            });
            
            // Trier par nom
            filtered.sort((a,b) => a.nom.localeCompare(b.nom));
            
            document.getElementById('joueursCount').textContent = filtered.length;
            
            const tbody = document.getElementById('joueursAdminBody');
            tbody.innerHTML = filtered.map((j, idx) => {
                const realIdx = joueursList.joueurs.findIndex(x => x.nom === j.nom);
                let roleStyle = '';
                let roleBadge = 'Joueur';
                let rowStyle = '';
                
                if (j.role === 'coach') {
                    roleStyle = 'background:#28a745;color:white';
                    roleBadge = 'ğŸ‘” Coach';
                    rowStyle = 'background:rgba(40,167,69,0.1)';
                } else if (j.role === 'admin') {
                    roleStyle = 'background:#ffc107;color:#333';
                    roleBadge = 'âš™ï¸ Admin';
                    rowStyle = 'background:rgba(255,193,7,0.1)';
                } else if (j.role === 'coachadmin') {
                    roleStyle = 'background:linear-gradient(135deg,#28a745 50%,#ffc107 50%);color:white';
                    roleBadge = 'ğŸ‘”âš™ï¸ Coach+Admin';
                    rowStyle = 'background:linear-gradient(90deg,rgba(40,167,69,0.1) 0%,rgba(255,193,7,0.1) 100%)';
                }
                
                return `<tr style="${rowStyle}">
                    <td><strong>${j.nom}</strong></td>
                    <td><span class="cote-badge cote-${j.cote}">${j.cote}</span></td>
                    <td><span style="padding:.2rem .5rem;border-radius:3px;font-size:.75rem;${roleStyle}">${roleBadge}</span></td>
                    <td>${j.telephone1 || 'â€”'}</td>
                    <td style="font-size:.75rem">${j.courriel || 'â€”'}</td>
                    <td>${j.naissance || 'â€”'}</td>
                    <td class="action-btns">
                        <button class="btn btn-primary btn-small" onclick="openJoueurListModal(${realIdx})">âœï¸</button>
                        <button class="btn btn-danger btn-small" onclick="deleteJoueurList(${realIdx})">ğŸ—‘ï¸</button>
                    </td>
                </tr>`;
            }).join('');
        }
        
        function openJoueurListModal(idx){
            document.getElementById('joueurListIdx').value = idx;
            if(idx >= 0 && joueursList.joueurs[idx]){
                const j = joueursList.joueurs[idx];
                document.getElementById('joueurListNom').value = j.nom;
                document.getElementById('joueurListCote').value = j.cote;
                document.getElementById('joueurListRole').value = j.role || 'joueur';
                document.getElementById('joueurListNaissance').value = j.naissance || '';
                document.getElementById('joueurListTel1').value = j.telephone1 || '';
                document.getElementById('joueurListTel2').value = j.telephone2 || '';
                document.getElementById('joueurListCourriel').value = j.courriel || '';
            } else {
                document.getElementById('joueurListNom').value = '';
                document.getElementById('joueurListCote').value = '3';
                document.getElementById('joueurListRole').value = 'joueur';
                document.getElementById('joueurListNaissance').value = '';
                document.getElementById('joueurListTel1').value = '';
                document.getElementById('joueurListTel2').value = '';
                document.getElementById('joueurListCourriel').value = '';
            }
            openModal('joueurList');
        }
        
        function saveJoueurList(){
            const idx = parseInt(document.getElementById('joueurListIdx').value);
            const nom = document.getElementById('joueurListNom').value.trim();
            if(!nom) return toast('Nom requis!', 'danger');
            
            const data = {
                nom: nom.toUpperCase(),
                cote: parseInt(document.getElementById('joueurListCote').value),
                role: document.getElementById('joueurListRole').value,
                naissance: document.getElementById('joueurListNaissance').value.trim(),
                telephone1: document.getElementById('joueurListTel1').value.trim(),
                telephone2: document.getElementById('joueurListTel2').value.trim(),
                courriel: document.getElementById('joueurListCourriel').value.trim()
            };
            
            if(idx >= 0){
                joueursList.joueurs[idx] = data;
            } else {
                joueursList.joueurs.push(data);
            }
            
            save(KEYS.joueurs, joueursList);
            renderJoueursList();
            closeModal('joueurList');
            toast('Joueur sauvegardÃ©!', 'success');
        }
        
        function deleteJoueurList(idx){
            confirm('Supprimer ce joueur de la liste?', () => {
                joueursList.joueurs.splice(idx, 1);
                save(KEYS.joueurs, joueursList);
                renderJoueursList();
                toast('Joueur supprimÃ©!', 'success');
            });
        }
        
        function downloadJoueursJSON(){
            const saison = joueursList.saison || '2025';
            const json = JSON.stringify(joueursList, null, 2);
            const blob = new Blob([json], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `joueurs-${saison}.json`;
            a.click();
            URL.revokeObjectURL(url);
            toast('JSON tÃ©lÃ©chargÃ©!', 'success');
        }
        
        function archiverJoueurs(){
            const saison = joueursList.saison || '2025';
            const existingIdx = archivesJoueurs.saisons.findIndex(a => a.saison === saison);
            
            if(existingIdx >= 0){
                confirm(`La saison ${saison} est dÃ©jÃ  archivÃ©e. Remplacer?`, () => {
                    archivesJoueurs.saisons[existingIdx] = {
                        saison: saison,
                        dateArchive: new Date().toISOString(),
                        joueurs: JSON.parse(JSON.stringify(joueursList.joueurs))
                    };
                    save(KEYS.archivesJoueurs, archivesJoueurs);
                    toast(`Joueurs ${saison} mis Ã  jour!`, 'success');
                });
            } else {
                archivesJoueurs.saisons.push({
                    saison: saison,
                    dateArchive: new Date().toISOString(),
                    joueurs: JSON.parse(JSON.stringify(joueursList.joueurs))
                });
                save(KEYS.archivesJoueurs, archivesJoueurs);
                toast(`Joueurs ${saison} archivÃ©s!`, 'success');
            }
        }
        
        function nouvelleSaisonJoueurs(){
            const saisonActuelle = joueursList.saison || '2025';
            const nouvelleSaison = prompt('AnnÃ©e de la nouvelle saison:', String(parseInt(saisonActuelle) + 1));
            if(!nouvelleSaison || !/^\d{4}$/.test(nouvelleSaison)) return;
            
            const isArchived = archivesJoueurs.saisons.some(a => a.saison === saisonActuelle);
            
            const doCreate = () => {
                joueursList.saison = nouvelleSaison;
                // Garder les joueurs mais permettre les modifications
                save(KEYS.joueurs, joueursList);
                updateJoueursSaisonDisplay();
                renderJoueursList();
                toast(`Saison ${nouvelleSaison} crÃ©Ã©e! Modifiez la liste selon les changements.`, 'success');
            };
            
            if(!isArchived){
                confirm(`Archiver ${saisonActuelle} avant de crÃ©er ${nouvelleSaison}?`, () => {
                    archiverJoueurs();
                    doCreate();
                });
            } else {
                doCreate();
            }
        }
        
        function renderArchivesJoueursList(){
            const container = document.getElementById('archivesJoueursList');
            if(!archivesJoueurs.saisons || archivesJoueurs.saisons.length === 0){
                container.innerHTML = '<p style="text-align:center;color:#666;padding:2rem">Aucune archive</p>';
                return;
            }
            const sorted = [...archivesJoueurs.saisons].sort((a,b) => b.saison.localeCompare(a.saison));
            container.innerHTML = sorted.map(arch => {
                const date = new Date(arch.dateArchive).toLocaleDateString('fr-CA');
                return `<div class="item-card">
                    <div style="flex:1">
                        <h4>ğŸƒ Saison ${arch.saison}</h4>
                        <p style="font-size:.8rem;color:#666">ArchivÃ©e le ${date} â€¢ ${arch.joueurs.length} joueurs</p>
                    </div>
                    <div class="action-btns">
                        <button class="btn btn-warning btn-small" onclick="downloadArchiveJoueurs('${arch.saison}')">ğŸ’¾ JSON</button>
                        <button class="btn btn-danger btn-small" onclick="deleteArchiveJoueurs('${arch.saison}')">ğŸ—‘ï¸</button>
                    </div>
                </div>`;
            }).join('');
        }
        
        function downloadArchiveJoueurs(saison){
            const arch = archivesJoueurs.saisons.find(a => a.saison === saison);
            if(!arch) return;
            const data = {saison: arch.saison, joueurs: arch.joueurs};
            const json = JSON.stringify(data, null, 2);
            const blob = new Blob([json], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `joueurs-${saison}.json`;
            a.click();
            URL.revokeObjectURL(url);
            toast('Archive tÃ©lÃ©chargÃ©e!', 'success');
        }
        
        function deleteArchiveJoueurs(saison){
            confirm(`Supprimer l'archive ${saison}?`, () => {
                archivesJoueurs.saisons = archivesJoueurs.saisons.filter(a => a.saison !== saison);
                save(KEYS.archivesJoueurs, archivesJoueurs);
                renderArchivesJoueursList();
                toast('Archive supprimÃ©e', 'success');
            });
        }
        
        function downloadAllArchivesJoueurs(){
            const json = JSON.stringify(archivesJoueurs, null, 2);
            const blob = new Blob([json], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'lbma-archives-joueurs.json';
            a.click();
            URL.revokeObjectURL(url);
            toast('Toutes les archives tÃ©lÃ©chargÃ©es!', 'success');
        }
        
        // Override openModal pour les archives joueurs
        const _origOpenModal = typeof openModal !== 'undefined' ? openModal : null;
        function openModal(id){
            if(id === 'archivesJoueurs') renderArchivesJoueursList();
            if(id === 'archives') renderArchivesList();
            document.getElementById(id + 'Modal').classList.add('active');
        }

        // === GESTION DES CONTACTS / DIRECTION ===
        const defContacts = {
            titre: "Direction LBMA",
            description: "Membres du comitÃ© de direction de la Ligue de Balle Molle Amicale",
            contacts: []
        };
        
        async function loadContacts(){
            try {
                const saved = localStorage.getItem(KEYS.contacts);
                if(saved){
                    contacts = JSON.parse(saved);
                } else {
                    const response = await fetch('contacts-data.json');
                    contacts = await response.json();
                    save(KEYS.contacts, contacts);
                }
                updateContactsConfig();
                renderContacts();
            } catch(e) {
                console.error('Erreur chargement contacts:', e);
                contacts = JSON.parse(JSON.stringify(defContacts));
            }
        }
        
        async function loadContactsFromServer(){
            try {
                const response = await fetch('contacts-data.json?t=' + Date.now());
                contacts = await response.json();
                save(KEYS.contacts, contacts);
                updateContactsConfig();
                renderContacts();
                toast('Contacts chargÃ©s depuis le serveur!', 'success');
            } catch(e) {
                toast('Erreur de chargement', 'danger');
            }
        }
        
        function updateContactsConfig(){
            document.getElementById('contactsPageTitre').value = contacts.titre || '';
            document.getElementById('contactsPageDesc').value = contacts.description || '';
        }
        
        function saveContactsConfig(){
            contacts.titre = document.getElementById('contactsPageTitre').value;
            contacts.description = document.getElementById('contactsPageDesc').value;
            save(KEYS.contacts, contacts);
            toast('Configuration sauvegardÃ©e!', 'success');
        }
        
        function renderContacts(){
            const list = document.getElementById('contactsList');
            const countEl = document.getElementById('contactsCount');
            
            if(!contacts || !contacts.contacts){
                contacts = JSON.parse(JSON.stringify(defContacts));
            }
            
            countEl.textContent = contacts.contacts.length;
            
            if(contacts.contacts.length === 0){
                list.innerHTML = '<p style="text-align:center;color:#666;padding:2rem">Aucun contact. Cliquez sur "Ajouter" pour commencer.</p>';
                return;
            }
            
            const sorted = [...contacts.contacts].sort((a, b) => (a.ordre || 999) - (b.ordre || 999));
            
            list.innerHTML = sorted.map((c, displayIdx) => {
                const realIdx = contacts.contacts.findIndex(x => x.id === c.id);
                const respText = c.responsabilites && c.responsabilites.length > 0 
                    ? c.responsabilites.slice(0, 2).join(', ') + (c.responsabilites.length > 2 ? '...' : '')
                    : 'Aucune responsabilitÃ©';
                return `
                    <div class="item-card">
                        <div style="flex:1">
                            <h4>${c.nom} ${c.sousTitre ? '<span style="background:var(--gold);color:var(--dark);padding:0 .4rem;font-size:.7rem;border-radius:3px;margin-left:.5rem">' + c.sousTitre + '</span>' : ''}</h4>
                            <p><strong>${c.titre}</strong></p>
                            <p style="font-size:.75rem">ğŸ“ ${c.telephone || 'N/A'} | âœ‰ï¸ ${c.courriel || 'N/A'}</p>
                            <p style="font-size:.7rem;color:#888;margin-top:.25rem">ğŸ“‹ ${respText}</p>
                        </div>
                        <div style="display:flex;flex-direction:column;gap:.25rem;align-items:center">
                            <span style="font-size:.7rem;color:#666">Ordre: ${c.ordre || '-'}</span>
                            <div class="action-btns">
                                <button class="btn btn-primary btn-small" onclick="openContactModal(${realIdx})">âœï¸</button>
                                <button class="btn btn-danger btn-small" onclick="deleteContact(${realIdx})">ğŸ—‘ï¸</button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function openContactModal(idx){
            document.getElementById('contactIdx').value = idx;
            
            if(idx === -1){
                // Nouveau contact
                document.getElementById('contactNom').value = '';
                document.getElementById('contactTitre').value = 'Directeur';
                document.getElementById('contactSousTitre').value = '';
                document.getElementById('contactTelephone').value = '';
                document.getElementById('contactCourriel').value = '';
                document.getElementById('contactResponsabilites').value = '';
                document.getElementById('contactOrdre').value = contacts.contacts.length + 1;
            } else {
                // Ã‰dition
                const c = contacts.contacts[idx];
                document.getElementById('contactNom').value = c.nom || '';
                document.getElementById('contactTitre').value = c.titre || '';
                document.getElementById('contactSousTitre').value = c.sousTitre || '';
                document.getElementById('contactTelephone').value = c.telephone || '';
                document.getElementById('contactCourriel').value = c.courriel || '';
                document.getElementById('contactResponsabilites').value = (c.responsabilites || []).join('\n');
                document.getElementById('contactOrdre').value = c.ordre || 1;
            }
            
            openModal('contact');
        }
        
        function saveContact(){
            const idx = parseInt(document.getElementById('contactIdx').value);
            const nom = document.getElementById('contactNom').value.trim();
            const titre = document.getElementById('contactTitre').value.trim();
            
            if(!nom || !titre){
                toast('Nom et titre sont obligatoires!', 'danger');
                return;
            }
            
            const respText = document.getElementById('contactResponsabilites').value;
            const responsabilites = respText.split('\n').map(r => r.trim()).filter(r => r.length > 0);
            
            const contactData = {
                nom: nom,
                titre: titre,
                sousTitre: document.getElementById('contactSousTitre').value.trim(),
                telephone: document.getElementById('contactTelephone').value.trim(),
                courriel: document.getElementById('contactCourriel').value.trim(),
                responsabilites: responsabilites,
                ordre: parseInt(document.getElementById('contactOrdre').value) || 1
            };
            
            if(idx === -1){
                // Nouveau - gÃ©nÃ©rer un ID unique
                const maxId = contacts.contacts.reduce((max, c) => Math.max(max, c.id || 0), 0);
                contactData.id = maxId + 1;
                contacts.contacts.push(contactData);
                toast('Contact ajoutÃ©!', 'success');
            } else {
                // Mise Ã  jour - garder l'ID existant
                contactData.id = contacts.contacts[idx].id;
                contacts.contacts[idx] = contactData;
                toast('Contact mis Ã  jour!', 'success');
            }
            
            save(KEYS.contacts, contacts);
            renderContacts();
            closeModal('contact');
        }
        
        function deleteContact(idx){
            const c = contacts.contacts[idx];
            confirm(`Supprimer ${c.nom} de la direction?`, () => {
                contacts.contacts.splice(idx, 1);
                save(KEYS.contacts, contacts);
                renderContacts();
                toast('Contact supprimÃ©', 'success');
            });
        }
        
        function downloadContactsJSON(){
            const json = JSON.stringify(contacts, null, 2);
            const blob = new Blob([json], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'contacts-data.json';
            a.click();
            URL.revokeObjectURL(url);
            toast('JSON tÃ©lÃ©chargÃ©!', 'success');
        }

        // ====== STATS LANCEURS (Supabase) ======
        const SB_URL = 'https://xgyskiatppgaeaamjhxr.supabase.co';
        const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhneXNraWF0cHBnYWVhYW1qaHhyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA0OTgxNTQsImV4cCI6MjA4NjA3NDE1NH0.67KCcUWlJij-scDoCUvZpkiCle5-mHVmy-inRk96Tac';
        let lanceurData = [];

        async function sbFetch(path, opts = {}) {
            const res = await fetch(`${SB_URL}/rest/v1/${path}`, {
                ...opts,
                headers: {
                    'apikey': SB_KEY,
                    'Authorization': `Bearer ${SB_KEY}`,
                    'Content-Type': 'application/json',
                    'Prefer': opts.method === 'PATCH' ? 'return=representation' : 'return=minimal',
                    ...(opts.headers || {})
                }
            });
            return res;
        }

        async function initLanceurSaisons() {
            try {
                const res = await sbFetch('lanceurs_saison?select=saison&order=saison.desc', { headers: { 'Range': '0-999' } });
                const rows = await res.json();
                const saisons = [...new Set(rows.map(r => r.saison))].sort((a, b) => b.localeCompare(a));
                const sel = document.getElementById('lanceurSaison');
                sel.innerHTML = '<option value="">-- Choisir --</option>';
                saisons.forEach(s => sel.innerHTML += `<option value="${s}">${s}</option>`);
            } catch (e) {
                console.error('Erreur chargement saisons lanceurs:', e);
            }
        }

        async function loadLanceurStats() {
            const saison = document.getElementById('lanceurSaison').value;
            if (!saison) { document.getElementById('lanceurBody').innerHTML = ''; document.getElementById('lanceurCount').textContent = '0'; return; }
            try {
                const res = await sbFetch(`lanceurs_saison?saison=eq.${saison}&order=moy.asc`, { headers: { 'Range': '0-999' } });
                lanceurData = await res.json();
                renderLanceurTable();
            } catch (e) {
                console.error('Erreur:', e);
                toast('Erreur de chargement', 'danger');
            }
        }

        function filterLanceurTable() { renderLanceurTable(); }

        function renderLanceurTable() {
            const search = (document.getElementById('lanceurSearch').value || '').toLowerCase();
            const filtered = lanceurData.filter(p => !search || p.nom.toLowerCase().includes(search));
            document.getElementById('lanceurCount').textContent = filtered.length;
            const body = document.getElementById('lanceurBody');
            body.innerHTML = filtered.map(p => {
                const moy = p.moy ? parseFloat(p.moy).toFixed(2) : '-';
                const eqClass = p.equipe ? `<span class="team-color">${p.equipe}</span>` : '-';
                const typeStr = p.type_lanceur || '-';
                return `<tr>
                    <td><strong>${p.nom}</strong></td>
                    <td>${eqClass}</td>
                    <td>${p.cote || '-'}</td>
                    <td><strong>${typeStr}</strong></td>
                    <td>${p.pl || 0}</td>
                    <td>${p.v || 0}</td>
                    <td>${p.d || 0}</td>
                    <td>${p.n || 0}</td>
                    <td>${p.pc || 0}</td>
                    <td>${p.cs || 0}</td>
                    <td>${p.bb || 0}</td>
                    <td>${p.rb || 0}</td>
                    <td><strong>${moy}</strong></td>
                    <td><button class="btn btn-primary btn-small" onclick="openLanceurEdit(${p.id})">âœï¸</button></td>
                </tr>`;
            }).join('');
        }

        function openLanceurEdit(id) {
            const p = lanceurData.find(x => x.id === id);
            if (!p) return;
            document.getElementById('lanceurEditId').value = p.id;
            document.getElementById('lanceurEditNom').value = p.nom || '';
            document.getElementById('lanceurEditSaison').value = p.saison || '';
            document.getElementById('lanceurEditEquipe').value = p.equipe || '';
            document.getElementById('lanceurEditCote').value = p.cote || '';
            document.getElementById('lanceurEditType').value = p.type_lanceur || '';
            document.getElementById('lanceurEditPL').value = p.pl || 0;
            document.getElementById('lanceurEditML').value = p.ml || 0;
            document.getElementById('lanceurEditV').value = p.v || 0;
            document.getElementById('lanceurEditD').value = p.d || 0;
            document.getElementById('lanceurEditN').value = p.n || 0;
            document.getElementById('lanceurEditPC').value = p.pc || 0;
            document.getElementById('lanceurEditCS').value = p.cs || 0;
            document.getElementById('lanceurEditBB').value = p.bb || 0;
            document.getElementById('lanceurEditRB').value = p.rb || 0;
            document.getElementById('lanceurEditMOY').value = p.moy || 0;
            openModal('lanceurEdit');
        }

        async function saveLanceurEdit() {
            const id = document.getElementById('lanceurEditId').value;
            const data = {
                nom: document.getElementById('lanceurEditNom').value.trim(),
                equipe: document.getElementById('lanceurEditEquipe').value,
                cote: document.getElementById('lanceurEditCote').value || null,
                type_lanceur: document.getElementById('lanceurEditType').value || null,
                pl: parseInt(document.getElementById('lanceurEditPL').value) || 0,
                ml: parseFloat(document.getElementById('lanceurEditML').value) || 0,
                v: parseInt(document.getElementById('lanceurEditV').value) || 0,
                d: parseInt(document.getElementById('lanceurEditD').value) || 0,
                n: parseInt(document.getElementById('lanceurEditN').value) || 0,
                pc: parseInt(document.getElementById('lanceurEditPC').value) || 0,
                cs: parseInt(document.getElementById('lanceurEditCS').value) || 0,
                bb: parseInt(document.getElementById('lanceurEditBB').value) || 0,
                rb: parseInt(document.getElementById('lanceurEditRB').value) || 0,
                moy: parseFloat(document.getElementById('lanceurEditMOY').value) || 0
            };
            try {
                const res = await sbFetch(`lanceurs_saison?id=eq.${id}`, {
                    method: 'PATCH',
                    body: JSON.stringify(data)
                });
                if (res.ok) {
                    toast('Lanceur mis Ã  jour!', 'success');
                    closeModal('lanceurEdit');
                    loadLanceurStats();
                } else {
                    const err = await res.text();
                    toast('Erreur: ' + err, 'danger');
                }
            } catch (e) {
                toast('Erreur rÃ©seau: ' + e.message, 'danger');
            }
        }

        // ====== JOUEURS REPÃŠCHAGE (Supabase) ======
        let jrData = [];

        async function initJrSaisons() {
            try {
                const res = await sbFetch('joueurs_liste?select=saison&order=saison.desc', { headers: { 'Range': '0-999' } });
                const rows = await res.json();
                const saisons = [...new Set(rows.map(r => r.saison))].sort((a, b) => b.localeCompare(a));
                const sel = document.getElementById('jrSaison');
                sel.innerHTML = '';
                saisons.forEach(s => sel.innerHTML += '<option value="' + s + '">' + s + '</option>');
                if (saisons.length > 0) loadJoueursRepechage();
            } catch (e) { console.error('Erreur saisons JR:', e); }
        }

        async function loadJoueursRepechage() {
            const saison = document.getElementById('jrSaison').value;
            if (!saison) return;
            try {
                const res = await sbFetch('joueurs_liste?saison=eq.' + saison + '&order=nom.asc', { headers: { 'Range': '0-999' } });
                jrData = await res.json();
                renderJrTable();
                const actifs = jrData.filter(j => j.actif !== false).length;
                const totalCote = jrData.filter(j => j.actif !== false).reduce((s, j) => s + j.cote, 0);
                document.getElementById('jrStats').innerHTML = actifs + ' actifs | Î£ ' + totalCote + ' | Cible/Ã©q: ' + (totalCote / 6).toFixed(1);
            } catch (e) { console.error(e); toast('Erreur chargement joueurs', 'danger'); }
        }

        function renderJrTable() {
            const search = (document.getElementById('jrSearch').value || '').toLowerCase();
            const filterCote = document.getElementById('jrFilterCote').value;
            const filterActif = document.getElementById('jrFilterActif').value;
            let filtered = jrData.filter(j => {
                if (search && !j.nom.toLowerCase().includes(search)) return false;
                if (filterCote && j.cote != filterCote) return false;
                if (filterActif === 'true' && j.actif === false) return false;
                if (filterActif === 'false' && j.actif !== false) return false;
                return true;
            });
            document.getElementById('jrCount').textContent = filtered.length;
            document.getElementById('jrBody').innerHTML = filtered.map(j => {
                const actifBadge = j.actif === false
                    ? '<span style="color:var(--danger);font-weight:bold">âŒ</span>'
                    : '<span style="color:var(--success)">âœ…</span>';
                let roleBadge = 'Joueur';
                if (j.role === 'coach') roleBadge = 'ğŸ‘” Coach';
                else if (j.role === 'admin') roleBadge = 'âš™ï¸ Admin';
                else if (j.role === 'coachadmin') roleBadge = 'ğŸ‘”âš™ï¸';
                const rowStyle = j.actif === false ? 'opacity:.5' : '';
                return '<tr style="' + rowStyle + '"><td><strong>' + j.nom + '</strong></td><td><span class="cote-badge cote-' + j.cote + '">' + j.cote + '</span></td><td>' + roleBadge + '</td><td style="font-size:.75rem">' + (j.telephone1 || 'â€”') + '</td><td style="font-size:.75rem">' + (j.courriel || 'â€”') + '</td><td>' + actifBadge + '</td><td class="action-btns"><button class="btn btn-primary btn-small" onclick="openJrModal(' + j.id + ')">âœï¸</button><button class="btn btn-danger btn-small" onclick="deleteJr(' + j.id + ')">ğŸ—‘ï¸</button></td></tr>';
            }).join('');
        }

        function openJrModal(id) {
            document.getElementById('jrEditId').value = id === -1 ? '' : id;
            if (id === -1) {
                document.getElementById('jrEditNom').value = '';
                document.getElementById('jrEditCote').value = '3';
                document.getElementById('jrEditRole').value = 'joueur';
                document.getElementById('jrEditActif').value = 'true';
                document.getElementById('jrEditTel1').value = '';
                document.getElementById('jrEditTel2').value = '';
                document.getElementById('jrEditCourriel').value = '';
                document.getElementById('jrEditNaissance').value = '';
            } else {
                const j = jrData.find(x => x.id === id);
                if (!j) return;
                document.getElementById('jrEditNom').value = j.nom || '';
                document.getElementById('jrEditCote').value = j.cote || 3;
                document.getElementById('jrEditRole').value = j.role || 'joueur';
                document.getElementById('jrEditActif').value = j.actif === false ? 'false' : 'true';
                document.getElementById('jrEditTel1').value = j.telephone1 || '';
                document.getElementById('jrEditTel2').value = j.telephone2 || '';
                document.getElementById('jrEditCourriel').value = j.courriel || '';
                document.getElementById('jrEditNaissance').value = j.naissance || '';
            }
            openModal('jrEdit');
        }

        async function saveJrEdit() {
            const id = document.getElementById('jrEditId').value;
            const nom = document.getElementById('jrEditNom').value.trim();
            if (!nom) { toast('Nom requis!', 'danger'); return; }
            const data = {
                nom: nom,
                cote: parseInt(document.getElementById('jrEditCote').value),
                role: document.getElementById('jrEditRole').value,
                actif: document.getElementById('jrEditActif').value === 'true',
                telephone1: document.getElementById('jrEditTel1').value.trim() || null,
                telephone2: document.getElementById('jrEditTel2').value.trim() || null,
                courriel: document.getElementById('jrEditCourriel').value.trim() || null,
                naissance: document.getElementById('jrEditNaissance').value.trim() || null
            };
            try {
                if (id) {
                    const res = await sbFetch('joueurs_liste?id=eq.' + id, { method: 'PATCH', body: JSON.stringify(data) });
                    if (res.ok) { toast('Joueur mis Ã  jour!', 'success'); }
                    else { toast('Erreur: ' + await res.text(), 'danger'); return; }
                } else {
                    data.saison = document.getElementById('jrSaison').value;
                    const res = await sbFetch('joueurs_liste', {
                        method: 'POST',
                        body: JSON.stringify(data),
                        headers: { 'Prefer': 'return=representation' }
                    });
                    if (res.ok) { toast('Joueur ajoutÃ©!', 'success'); }
                    else { toast('Erreur: ' + await res.text(), 'danger'); return; }
                }
                closeModal('jrEdit');
                loadJoueursRepechage();
            } catch (e) { toast('Erreur: ' + e.message, 'danger'); }
        }

        async function deleteJr(id) {
            const j = jrData.find(x => x.id === id);
            if (!j) return;
            if (!window.confirm('Supprimer ' + j.nom + ' de la liste?')) return;
            try {
                const res = await sbFetch('joueurs_liste?id=eq.' + id, { method: 'DELETE' });
                if (res.ok) { toast('SupprimÃ©!', 'success'); loadJoueursRepechage(); }
                else { toast('Erreur', 'danger'); }
            } catch (e) { toast('Erreur: ' + e.message, 'danger'); }
        }

        async function copierSaisonJr() {
            const saisonActuelle = document.getElementById('jrSaison').value;
            const nouvSaison = prompt('Copier les joueurs ' + saisonActuelle + ' vers quelle saison?', String(parseInt(saisonActuelle) + 1));
            if (!nouvSaison || !/^\d{4}$/.test(nouvSaison)) return;
            const actifs = jrData.filter(j => j.actif !== false);
            if (!window.confirm('Copier ' + actifs.length + ' joueurs actifs de ' + saisonActuelle + ' vers ' + nouvSaison + '?')) return;
            try {
                const rows = actifs.map(j => ({
                    nom: j.nom, cote: j.cote, role: j.role || 'joueur',
                    telephone1: j.telephone1, telephone2: j.telephone2,
                    courriel: j.courriel, naissance: j.naissance,
                    saison: nouvSaison, actif: true
                }));
                const res = await sbFetch('joueurs_liste', {
                    method: 'POST',
                    body: JSON.stringify(rows),
                    headers: { 'Prefer': 'return=representation' }
                });
                if (res.ok) {
                    toast('âœ… ' + actifs.length + ' joueurs copiÃ©s vers ' + nouvSaison + '!', 'success');
                    initJrSaisons();
                } else { toast('Erreur: ' + await res.text(), 'danger'); }
            } catch (e) { toast('Erreur: ' + e.message, 'danger'); }
        }

        init();
    </script>
</body>
</html>
